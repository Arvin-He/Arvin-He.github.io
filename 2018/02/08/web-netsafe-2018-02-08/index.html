<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Learn and live."><title>web常见攻击手段 | Simple &amp; Freedom</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">web常见攻击手段</h1><a id="logo" href="/.">Simple &amp; Freedom</a><p class="description">Learn and live.</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/404.html"><i class="fa fa-heartbeat"> 公益404</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">web常见攻击手段</h1><div class="post-meta">Feb 8, 2018<span> | </span><span class="category"><a href="/categories/web/">web</a></span></div><div class="post-content"><h1 id="CSRF攻击"><a href="#CSRF攻击" class="headerlink" title="CSRF攻击"></a>CSRF攻击</h1><p>CSRF是Cross Site Request Forgery的缩写，翻译过来就是跨站请求伪造。 也被称为 one click attack/session riding，缩写为：CSRF/XSRF。<br>可以这么理解CSRF攻击：从网站A中发起一个到网站B的请求，而这个请求是经过伪装的， 伪装的目的就是让请求看起来像是从网站B中发起的， 也就是说，让B网站所在的服务器端误以为该请求是从自己网站发起的，而不是从A网站发起的。当然，请求一般都是恶意的。</p>
<h2 id="浏览器的跨域访问限制"><a href="#浏览器的跨域访问限制" class="headerlink" title="浏览器的跨域访问限制"></a>浏览器的跨域访问限制</h2><h3 id="Cookie跨域"><a href="#Cookie跨域" class="headerlink" title="Cookie跨域"></a>Cookie跨域</h3><p>cookie可以跨二级域名来访问，例如在www.cmj.com所在的web应用程序创建了一个cookie， 在cs.cmj.com这样的二级域名对应的应用程序中可以访问，当然你在创建cookie的时候需要指出Domain属性为cmj.com。 其他情况下的不同域名就无法访问这个cookie了。</p>
<h3 id="JavaScript跨域"><a href="#JavaScript跨域" class="headerlink" title="JavaScript跨域"></a>JavaScript跨域</h3><p>js跨域是指通过js在不同的域之间进行数据传输或通信，比如用ajax向一个不同的域请求数据， 或者通过js获取页面中不同域的框架中(iframe)的数据。只要协议、域名、端口有任何一个不同，都被当作是不同的域。</p>
<p><img src="/2018/02/08/web-netsafe-2018-02-08/1.png" alt=""></p>
<h3 id="通过jsonp跨域"><a href="#通过jsonp跨域" class="headerlink" title="通过jsonp跨域"></a>通过jsonp跨域</h3><p>在js中，我们直接用XMLHttpRequest请求不同域上的数据时，是不可以的。 但是，在页面上引入不同域上的js脚本文件却是可以的，jsonp正是利用这个特性来实现的。</p>
<p>如果你的页面使用jquery，那么通过它封装的方法就能很方便的来进行jsonp操作了。 普通的jquery的ajax调用方法基本都采用这个方式，所以就可以调用不同域名实现的API了。</p>
<p>$.getJSON方法会自动判断是否跨域，不跨域的话，就调用普通的ajax方法； 跨域的话，则会以异步加载js文件的形式来调用jsonp的回调函数。</p>
<h3 id="通过document-domain来跨子域"><a href="#通过document-domain来跨子域" class="headerlink" title="通过document.domain来跨子域"></a>通过document.domain来跨子域</h3><p>浏览器的同源策略，不能通过ajax的方法去请求不同源中的文档。</p>
<p>我们只要把<code>http://www.example.com/a.html</code> 和 <code>http://example.com/b.html</code>这两个页面的document.domain都设成相同的域名就可以了。</p>
<h3 id="CSRF攻击步骤"><a href="#CSRF攻击步骤" class="headerlink" title="CSRF攻击步骤"></a>CSRF攻击步骤</h3><p>要完成一次CSRF攻击，受害者必须依次完成两个步骤：</p>
<p>登录受信任网站A，并在本地生成Cookie。<br>在不登出A的情况下，访问危险网站B。</p>
<h3 id="CSRF防御"><a href="#CSRF防御" class="headerlink" title="CSRF防御"></a>CSRF防御</h3><p>防御效果是从服务端着手效果比较好，现在一般的CSRF防御也都在服务端进行。</p>
<h4 id="Cookie-Hashing"><a href="#Cookie-Hashing" class="headerlink" title="Cookie Hashing"></a>Cookie Hashing</h4><p><strong>所有表单</strong>都包含<strong>同一个伪随机值</strong>，这可能是最简单的解决方案了， 因为攻击者不能获得第三方的Cookie(理论上)，所以表单中的数据也就构造失败了。</p>
<p>这个方法个人觉得已经可以杜绝99%的CSRF攻击了，那还有1%呢….由于用户的Cookie很容易由于网站的XSS漏洞而被盗取，这就另外的1%。</p>
<h4 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h4><p>每次的用户提交都需要用户在表单中填写一个图片上的随机字符串，这个方案可以完全解决CSRF，但个人觉得在易用性方面似乎不是太好。</p>
<h1 id="XSS攻击"><a href="#XSS攻击" class="headerlink" title="XSS攻击"></a>XSS攻击</h1><p>XSS攻击：跨站脚本攻击(Cross-Site Scripting),XSS是一种常见的web安全漏洞，它允许攻击者将恶意代码植入到提供给其它用户使用的页面中。</p>
<h2 id="XSS分类"><a href="#XSS分类" class="headerlink" title="XSS分类"></a>XSS分类</h2><h3 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h3><p>主要出现在让用户输入数据，供其他浏览此页的用户进行查看的地方，包括留言、评论、博客日志和各类表单等。</p>
<p>应用程序从数据库中查询数据，在页面中显示出来，攻击者在相关页面输入恶意的脚本数据后，用户浏览此类页面时就可能受到攻击。</p>
<p>这个流程简单可以描述为:恶意用户的Html输入Web程序-&gt;进入数据库-&gt;Web程序-&gt;用户浏览器。</p>
<h3 id="反射型XSS"><a href="#反射型XSS" class="headerlink" title="反射型XSS"></a>反射型XSS</h3><p>将脚本代码加入URL地址的请求参数里，请求参数进入程序后在页面直接输出，用户点击类似的恶意链接就可能受到攻击。</p>
<h2 id="XSS攻击主要使用的手段和目的"><a href="#XSS攻击主要使用的手段和目的" class="headerlink" title="XSS攻击主要使用的手段和目的"></a>XSS攻击主要使用的手段和目的</h2><ul>
<li>盗用cookie，获取敏感信息。</li>
<li>利用植入Flash，通过crossdomain权限设置进一步获取更高权限；或者利用Java等得到类似的操作。</li>
<li>利用iframe、frame、XMLHttpRequest或上述Flash等方式，以（被攻击者）用户的身份执行一些管理动作， 或执行一些如:发微博、加好友、发私信等常规操作，前段时间新浪微博就遭遇过一次XSS。</li>
<li>利用可被攻击的域受到其他域信任的特点，以受信任来源的身份请求一些平时不允许的操作，如进行不当的投票活动。</li>
<li>在访问量极大的一些页面上的XSS可以攻击一些小型网站，实现DDoS攻击的效果</li>
</ul>
<h2 id="XSS原理"><a href="#XSS原理" class="headerlink" title="XSS原理"></a>XSS原理</h2><p>Web应用未对用户提交请求的数据做充分的检查过滤，允许用户在提交的数据中掺入HTML代码(最主要的是“&gt;”, “&lt;”)， 并将未经转义的恶意代码输出到第三方用户的浏览器解释执行，是导致XSS漏洞的产生原因。</p>
<h2 id="预防XSS"><a href="#预防XSS" class="headerlink" title="预防XSS"></a>预防XSS</h2><p>答案很简单，坚决不要相信用户的任何输入，并过滤掉输入中的所有特殊字符。这样就能消灭绝大部分的XSS攻击。</p>
<p>目前防御XSS主要有如下几种方式：</p>
<ul>
<li>过滤特殊字符<br>避免XSS的方法之一主要是将用户所提供的内容进行过滤。</li>
<li>使用HTTP头指定类型<br>这样就可以让浏览器解析javascript代码，而不会是html输出。</li>
</ul>
<p>总之, XSS漏洞是相当有危害的，在开发Web应用的时候，一定要记住过滤数据，特别是在输出到客户端之前，这是现在行之有效的防止XSS的手段。</p>
<h1 id="SQL注入攻击"><a href="#SQL注入攻击" class="headerlink" title="SQL注入攻击"></a>SQL注入攻击</h1><p>SQL注入攻击（SQL Injection），简称注入攻击，是Web开发中最常见的一种安全漏洞。 可以用它来从数据库获取敏感信息，或者利用数据库的特性执行添加用户，导出文件等一系列恶意操作， 甚至有可能获取数据库乃至系统用户最高权限。</p>
<p>而造成SQL注入的原因是因为<strong>程序没有有效过滤用户的输入</strong>，使攻击者成功的向服务器<strong>提交恶意的SQL查询代码</strong>， 程序在接收后并错误的将攻击者的输入作为查询语句的一部分执行，导致原始的查询逻辑被改变， 额外的执行了攻击者精心构造的恶意代码。</p>
<h2 id="如何预防SQL注入"><a href="#如何预防SQL注入" class="headerlink" title="如何预防SQL注入"></a>如何预防SQL注入</h2><p>永远不要信任外界输入的数据，特别是来自于用户的数据，包括选择框、表单隐藏域和 cookie。 就如上面的第一个例子那样，就算是正常的查询也有可能造成灾难。</p>
<p>下面这些建议或许对防治SQL注入有一定的帮助：</p>
<ul>
<li>严格限制Web应用的数据库的操作权限，给此用户提供仅仅能够满足其工作的最低权限，从而最大限度的减少注入攻击对数据库的危害。</li>
<li>检查输入的数据是否具有所期望的数据格式，严格限制变量的类型，例如使用regexp包进行一些匹配处理， 或者使用strconv包对字符串转化成其他基本类型的数据进行判断。</li>
<li>对进入数据库的特殊字符（’”\尖括号&amp;*;等）进行转义处理，或编码转换。</li>
<li>所有的查询语句建议使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到SQL语句中， 比如Java中的PrepareStatement。</li>
<li>在应用发布之前建议使用专业的SQL注入检测工具进行检测， 以及时修补被发现的SQL注入漏洞。网上有很多这方面的开源工具，例如sqlmap、SQLninja等。</li>
<li>避免网站打印出SQL错误信息，比如类型错误、字段不匹配等，把代码里的SQL语句暴露出来，以防止攻击者利用这些错误信息进行SQL注入。</li>
</ul>
<p>总之, SQL注入是危害相当大的安全漏洞。所以对于我们平常编写的Web应用，应该对于每一个小细节都要非常重视。</p>
<h1 id="防止表单重复提交"><a href="#防止表单重复提交" class="headerlink" title="防止表单重复提交"></a>防止表单重复提交</h1><p>在平时开发中，如果网速比较慢的情况下，用户提交表单后，发现服务器半天都没有响应， 那么用户可能会以为是自己没有提交表单，就会再点击提交按钮重复提交表单，我们在开发中必须防止表单重复提交。</p>
<h2 id="重复提交的几个场景"><a href="#重复提交的几个场景" class="headerlink" title="重复提交的几个场景"></a>重复提交的几个场景</h2><ul>
<li>场景一<br>在网络延迟的情况下让用户有时间点击多次submit按钮导致表单重复提交</li>
<li>场景二<br>表单提交后用户点击【刷新】按钮导致表单重复提交，点击浏览器的刷新按钮， 就是把浏览器上次做的事情再做一次，因为这样也会导致表单重复提交。</li>
<li>场景三<br>用户提交表单后，使用浏览器【后退】按钮重复之前的操作，导致重复提交表单。</li>
</ul>
<h2 id="表单重复提交解决办法"><a href="#表单重复提交解决办法" class="headerlink" title="表单重复提交解决办法"></a>表单重复提交解决办法</h2><h3 id="JavaScript方案"><a href="#JavaScript方案" class="headerlink" title="JavaScript方案"></a>JavaScript方案</h3><p>可通过javascript来防止表单重复提交，表单提交之后， 将提交按钮设置为不可用，让用户没有机会点击第二次提交按钮</p>
<h3 id="Session方案"><a href="#Session方案" class="headerlink" title="Session方案"></a>Session方案</h3><p>对于【场景二】和【场景三】导致表单重复提交的问题，既然客户端无法解决， 那么就在服务器端解决，在服务器端解决就需要用到session了。</p>
<p>具体的做法：在服务器端生成一个唯一的随机标识号，专业术语称为Token(令牌)，同时在当前用户的Session域中保存这个Token。 然后将Token发送到客户端的Form表单中，在Form表单中使用隐藏域来存储这个Token， 表单提交的时候连同这个Token一起提交到服务器端，然后在服务器端判断客户端提交上来的Token与服务器端生成的Token是否一致， 如果不一致，那就是重复提交了，此时服务器端就可以不处理重复提交的表单。如果相同则处理表单提交， 处理完后清除当前用户的Session域中存储的标识号。</p>
<p>在下列情况下，服务器程序将拒绝处理用户提交的表单请求：</p>
<ol>
<li>存储Session域中的Token(令牌)与表单提交的Token(令牌)不同。</li>
<li>当前用户的Session中不存在Token(令牌)。</li>
<li>用户提交的表单数据中没有Token(令牌)。</li>
</ol>
<h3 id="使用Post-Redirect-Get模式"><a href="#使用Post-Redirect-Get模式" class="headerlink" title="使用Post/Redirect/Get模式"></a>使用Post/Redirect/Get模式</h3><p>针对【场景二】和【场景三】，除了使用Session方案，还有一种方案可以实现。 这就是所谓的 Post-Redirect-Get (PRG)模式。</p>
<p>简言之，当用户提交了表单后，你去执行一个客户端的重定向，转到提交成功信息页面。 这能避免用户按F5导致的重复提交，而其也不会出现浏览器表单重复提交的警告，也能消除按浏览器前进和后退按导致的同样问题。</p>
</div><div class="tags"><a href="/tags/web/">web</a></div><div class="post-nav"><a href="/2018/02/08/py-sqlalchemy-2018-02-08/" class="next">SQLAlchemy学习使用</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/思想/">思想</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/计算机基础/" style="font-size: 15px;">计算机基础</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/OOP/" style="font-size: 15px;">OOP</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/谷歌/" style="font-size: 15px;">谷歌</a> <a href="/tags/flask/" style="font-size: 15px;">flask</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/方法/" style="font-size: 15px;">方法</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/NSIS/" style="font-size: 15px;">NSIS</a> <a href="/tags/scrapy/" style="font-size: 15px;">scrapy</a> <a href="/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/tags/PyQt5/" style="font-size: 15px;">PyQt5</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/RegExp/" style="font-size: 15px;">RegExp</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/SVN/" style="font-size: 15px;">SVN</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/tornado/" style="font-size: 15px;">tornado</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/02/08/web-netsafe-2018-02-08/">web常见攻击手段</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/08/py-sqlalchemy-2018-02-08/">SQLAlchemy学习使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/01/py-asyncio-coroutine-2018-02-01/">关于coroutine</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/01/spiderallsite-2018-02-01/">全站爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/25/linux-crontab-2018-01-25/">linux之crontab使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/16/py-scrapy2-2018-01-16/">scrapy笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/15/py-scrapy1-2018-01-15/">scrapy笔记-安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/15/py-pipcmds-2018-01-15/">python之pip常用命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/11/css-note1-2018-01-11/">css笔记1</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/11/selenium-phatomjs-2017-12-11/">selenium-phatomjs使用</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Simple &amp; Freedom.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>