<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Python,Scrapy," />





  <link rel="alternate" href="/atom.xml" title="Simple & Freedom" type="application/atom+xml" />






<meta name="description" content="Scrapy简介Scrapy是用Python开发的一个快速,高层次的屏幕抓取和web抓取框架，用于抓取web站点并从页面中提取结构化的数据。Scrapy用途广泛，可以用于数据挖掘、监测和自动化测试。Scrapy吸引人的地方在于它是一个框架，任何人都可以根据需求方便的修改。它也提供了多种类型爬虫的基类，如BaseSpider、sitemap爬虫等，最新版本又提供了web2.0爬虫的支持。Scratc">
<meta name="keywords" content="Python,Scrapy">
<meta property="og:type" content="article">
<meta property="og:title" content="Python之Scrapy初识">
<meta property="og:url" content="http://arvin-he.github.io/2017/06/15/python-scrapy1-201-06-15/index.html">
<meta property="og:site_name" content="Simple &amp; Freedom">
<meta property="og:description" content="Scrapy简介Scrapy是用Python开发的一个快速,高层次的屏幕抓取和web抓取框架，用于抓取web站点并从页面中提取结构化的数据。Scrapy用途广泛，可以用于数据挖掘、监测和自动化测试。Scrapy吸引人的地方在于它是一个框架，任何人都可以根据需求方便的修改。它也提供了多种类型爬虫的基类，如BaseSpider、sitemap爬虫等，最新版本又提供了web2.0爬虫的支持。Scratc">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://arvin-he.github.io/2017/06/15/python-scrapy1-201-06-15/1.png">
<meta property="og:updated_time" content="2017-09-08T03:51:40.143Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python之Scrapy初识">
<meta name="twitter:description" content="Scrapy简介Scrapy是用Python开发的一个快速,高层次的屏幕抓取和web抓取框架，用于抓取web站点并从页面中提取结构化的数据。Scrapy用途广泛，可以用于数据挖掘、监测和自动化测试。Scrapy吸引人的地方在于它是一个框架，任何人都可以根据需求方便的修改。它也提供了多种类型爬虫的基类，如BaseSpider、sitemap爬虫等，最新版本又提供了web2.0爬虫的支持。Scratc">
<meta name="twitter:image" content="http://arvin-he.github.io/2017/06/15/python-scrapy1-201-06-15/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://arvin-he.github.io/2017/06/15/python-scrapy1-201-06-15/"/>





  <title>Python之Scrapy初识 | Simple & Freedom</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Simple & Freedom</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Learn and live.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://arvin-he.github.io/2017/06/15/python-scrapy1-201-06-15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arvin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple & Freedom">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Python之Scrapy初识</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-15T13:09:52+08:00">
                2017-06-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Scrapy简介"><a href="#Scrapy简介" class="headerlink" title="Scrapy简介"></a>Scrapy简介</h3><p>Scrapy是用Python开发的一个快速,高层次的屏幕抓取和web抓取框架，用于抓取web站点并从页面中提取结构化的数据。Scrapy用途广泛，可以用于数据挖掘、监测和自动化测试。Scrapy吸引人的地方在于它是一个框架，任何人都可以根据需求方便的修改。它也提供了多种类型爬虫的基类，如BaseSpider、sitemap爬虫等，最新版本又提供了web2.0爬虫的支持。Scratch，是抓取的意思，Scrapy大概是源于Scratch吧.Scrapy 使用了 Twisted异步网络库来处理网络通讯。整体架构大致如下:</p>
<p><img src="/2017/06/15/python-scrapy1-201-06-15/1.png" alt=""></p>
<h3 id="Scrapy框架及组件"><a href="#Scrapy框架及组件" class="headerlink" title="Scrapy框架及组件"></a>Scrapy框架及组件</h3><ul>
<li>引擎(Scrapy)<br>用来处理整个系统的数据流处理, 触发事务(框架核心)</li>
<li>调度器(Scheduler)<br>用来接受引擎发过来的请求, 压入队列中, 并在引擎再次请求的时候返回. 可以想像成一个URL（抓取网页的网址或者说是链接）的优先队列, 由它来决定下一个要抓取的网址是什么, 同时去除重复的网址</li>
<li>下载器(Downloader)<br>用于下载网页内容, 并将网页内容返回给蜘蛛(Scrapy下载器是建立在twisted这个高效的异步模型上的)</li>
<li>爬虫(Spiders)<br>爬虫是主要干活的, 用于从特定的网页中提取自己需要的信息, 即所谓的实体(Item)。用户也可以从中提取出链接,让Scrapy继续抓取下一个页面.</li>
<li>项目管道(Pipeline)<br>负责处理爬虫从网页中抽取的实体，主要的功能是持久化实体、验证实体的有效性、清除不需要的信息。当页面被爬虫解析后，将被发送到项目管道，并经过几个特定的次序处理数据。</li>
<li>下载器中间件(Downloader Middlewares)<br>位于Scrapy引擎和下载器之间的框架，主要是处理Scrapy引擎与下载器之间的请求及响应。</li>
<li>爬虫中间件(Spider Middlewares)<br>介于Scrapy引擎和爬虫之间的框架，主要工作是处理蜘蛛的响应输入和请求输出。</li>
<li>调度中间件(Scheduler Middlewares)<br>介于Scrapy引擎和调度之间的中间件，从Scrapy引擎发送到调度的请求和响应。</li>
</ul>
<p>Scarpy运作流程:</p>
<ol>
<li>引擎从调度器中取出一个链接(URL)用于接下来的抓取</li>
<li>引擎把URL封装成一个请求(Request)传给下载器</li>
<li>下载器把资源下载下来，并封装成应答包(Response)</li>
<li>爬虫解析Response</li>
<li>解析出实体（Item）,则交给实体管道进行进一步的处理</li>
<li>解析出的是链接（URL）,则把URL交给调度器等待抓取</li>
</ol>
<h3 id="Scrapy安装"><a href="#Scrapy安装" class="headerlink" title="Scrapy安装"></a>Scrapy安装</h3><p>Scrapy已经支持python3,使用pip安装, 在命令行窗口输入: <code>pip install scrapy</code>, 回车.<br><strong>注意：</strong> windows平台需要依赖pywin32，请根据自己系统32/64位选择下载安装，<a href="https://sourceforge.net/projects/pywin32/" target="_blank" rel="external">下载地址</a></p>
<h3 id="Scrapy基本使用"><a href="#Scrapy基本使用" class="headerlink" title="Scrapy基本使用"></a>Scrapy基本使用</h3><h4 id="创建爬虫项目"><a href="#创建爬虫项目" class="headerlink" title="创建爬虫项目"></a>创建爬虫项目</h4><p>运行命令: <code>scrapy startproject project_name</code>, 回车, 自动创建的目录如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">λ tree /F .</div><div class="line">C:\USERS\ARON\SCRAPYTEST</div><div class="line">│  scrapy.cfg</div><div class="line">│</div><div class="line">└─scrapytest</div><div class="line">    │  items.py</div><div class="line">    │  middlewares.py</div><div class="line">    │  pipelines.py</div><div class="line">    │  settings.py</div><div class="line">    │  __init__.py</div><div class="line">    │</div><div class="line">    ├─spiders</div><div class="line">       │  __init__.py</div></pre></td></tr></table></figure></p>
<p>文件说明：<br>scrapy.cfg  项目的配置信息,主要为Scrapy命令行工具提供一个基础的配置信息(真正爬虫相关的配置信息在settings.py文件中）<br>items.py    设置数据存储模板，用于结构化数据，如：Django的Model<br>pipelines   数据处理行为，如：一般结构化的数据持久化<br>settings.py 配置文件，如：递归的层数、并发数，延迟下载等<br>spiders     爬虫目录，如：创建文件，编写爬虫规则<br>注意：一般创建爬虫文件时，以网站域名命名</p>
<h4 id="编写爬虫"><a href="#编写爬虫" class="headerlink" title="编写爬虫"></a>编写爬虫</h4><p>编写一个爬取校花网上的校花图片, 在spiders目录中新建 xiaohuar_spider.py 文件<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/python3</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> scrapy</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">XiaoHuarSpider</span><span class="params">(scrapy.spider.Spider)</span>:</span></div><div class="line">    name = <span class="string">"xiaohuar"</span></div><div class="line">    allowed_domains = [<span class="string">"xiaohuar.com"</span>]</div><div class="line">    start_urls = [<span class="string">"http://www.xiaohuar.com/hua/"</span>]</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></div><div class="line">        current_url = response.current_url</div><div class="line">        body = response.body</div><div class="line">        unicode_body = response.body_as_unicode()</div></pre></td></tr></table></figure></p>
<p><strong>注意点:</strong></p>
<ol>
<li>爬虫文件需要定义一个类，并继承scrapy.spiders.Spider</li>
<li>必须定义name，即爬虫名，如果没有name，会报错.</li>
<li>编写函数parse，<strong>注意:</strong>该函数名不能改变，因为Scrapy源码中默认callback函数的函数名就是parse；</li>
<li>定义需要爬取的url，放在list中，因为可以爬取多个url，Scrapy源码是一个For循环，从上到下爬取这些url，使用生成器迭代将url发送给下载器下载url的html。</li>
</ol>
<h4 id="运行爬虫"><a href="#运行爬虫" class="headerlink" title="运行爬虫"></a>运行爬虫</h4><p>进入scarpytest目录, 运行命令:<code>scrapy crawl xiaohau --nolog</code>, 回车<br>格式：scrapy crawl+爬虫名  –nolog即不显示日志</p>
<h3 id="scrapy查询语法"><a href="#scrapy查询语法" class="headerlink" title="scrapy查询语法"></a>scrapy查询语法</h3><p>当爬取大量的网页，如果自己写正则匹配，会很麻烦，也很浪费时间，令人欣慰的是，scrapy内部支持更简单的查询语法，帮助我们去html中查询我们需要的标签和标签内容以及标签属性。下面逐一进行介绍：</p>
<ul>
<li>查询子子孙孙中的某个标签(以div标签为例)：<code>//div</code></li>
<li>查询儿子中的某个标签(以div标签为例)：<code>/div</code></li>
<li>查询标签中带有某个class属性的标签：<code>//div[@class=’c1′]</code>,即子子孙孙中标签是div且class=‘c1’的标签</li>
<li>查询标签中带有某个class=‘c1’并且自定义属性name=‘alex’的标签：<code>//div[@class=’c1′][@name=’alex’]</code></li>
<li>查询某个标签的文本内容：<code>//div/span/text()</code> 即查询子子孙孙中div下面的span标签中的文本内容</li>
<li>查询某个属性的值（例如查询a标签的href属性）：<code>//a/@href</code></li>
</ul>
<p>示例:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></div><div class="line">    <span class="comment"># 分析页面</span></div><div class="line">    <span class="comment"># 找到页面中符合规则的内容（校花图片），保存</span></div><div class="line">    <span class="comment"># 找到所有的a标签，再访问其他a标签，一层一层的搞下去</span></div><div class="line"></div><div class="line">    hxs = HtmlXPathSelector(response)<span class="comment">#创建查询对象</span></div><div class="line"></div><div class="line">    <span class="comment"># 如果url是 http://www.xiaohuar.com/list-1-\d+.html</span></div><div class="line">    <span class="comment">#如果url能够匹配到需要爬取的url，即本站url</span></div><div class="line">    <span class="keyword">if</span> re.match(<span class="string">'http://www.xiaohuar.com/list-1-\d+.html'</span>, response.url): </div><div class="line">        <span class="comment">#select中填写查询目标，按scrapy查询语法书写</span></div><div class="line">        items = hxs.select(<span class="string">'//div[@class="item_list infinite_scroll"]/div'</span>) </div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(items)):</div><div class="line">            <span class="comment">#查询所有img标签的src属性，即获取校花图片地址</span></div><div class="line">            src = hxs.select(<span class="string">'//div[@class="item_list infinite_scroll"]/div[%d]//div[@class="img"]/a/img/@src'</span> % i).extract()</div><div class="line">            <span class="comment">#获取span的文本内容，即校花姓名</span></div><div class="line">            name = hxs.select(<span class="string">'//div[@class="item_list infinite_scroll"]/div[%d]//div[@class="img"]/span/text()'</span> % i).extract() </div><div class="line">            <span class="comment">#校花学校</span></div><div class="line">            school = hxs.select(<span class="string">'//div[@class="item_list infinite_scroll"]/div[%d]//div[@class="img"]/div[@class="btns"]/a/text()'</span> % i).extract() </div><div class="line">            <span class="keyword">if</span> src:</div><div class="line">                <span class="comment">#相对路径拼接</span></div><div class="line">                ab_src = <span class="string">"http://www.xiaohuar.com"</span> + src[<span class="number">0</span>]</div><div class="line">                <span class="comment">#文件名，因为python27默认编码格式是unicode编码，因此我们需要编码成utf-8</span></div><div class="line">                file_name = <span class="string">"%s_%s.jpg"</span> % (school[<span class="number">0</span>].encode(<span class="string">'utf-8'</span>), name[<span class="number">0</span>].encode(<span class="string">'utf-8'</span>)) </div><div class="line">                file_path = os.path.join(<span class="string">"/Users/wupeiqi/PycharmProjects/beauty/pic"</span>, file_name)</div><div class="line">                urllib.urlretrieve(ab_src, file_path)</div></pre></td></tr></table></figure></p>
<p>注：<code>urllib.urlretrieve(ab_src, file_path)</code> ，接收文件路径和需要保存的路径，会自动去文件路径下载并保存到我们指定的本地路径。</p>
<h3 id="递归爬取网页"><a href="#递归爬取网页" class="headerlink" title="递归爬取网页"></a>递归爬取网页</h3><p>上述代码仅仅实现了一个url的爬取，如果该url的爬取的内容中包含了其他url，而我们也想对其进行爬取，那么如何实现递归爬取网页呢？<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 获取所有的url，继续访问，并在其中寻找相同的url</span></div><div class="line">all_urls = hxs.select(<span class="string">'//a/@href'</span>).extract()</div><div class="line"><span class="keyword">for</span> url <span class="keyword">in</span> all_urls:</div><div class="line">    <span class="keyword">if</span> url.startswith(<span class="string">'http://www.xiaohuar.com/list-1-'</span>):</div><div class="line">        <span class="keyword">yield</span> Request(url, callback=self.parse)</div></pre></td></tr></table></figure></p>
<p>通过yield生成器向每一个url发送request请求,并执行返回函数parse,从而递归获取校花图片和校花姓名学校等信息。<br>注：可以修改settings.py 中的配置文件，以此来指定“递归”的层数，如: <code>DEPTH_LIMIT = 1</code></p>
<h3 id="scrapy查询语法中的正则："><a href="#scrapy查询语法中的正则：" class="headerlink" title="scrapy查询语法中的正则："></a>scrapy查询语法中的正则：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> scrapy.selector <span class="keyword">import</span> Selector</div><div class="line"><span class="keyword">from</span> scrapy.http <span class="keyword">import</span> HtmlResponse</div><div class="line">html = <span class="string">"""&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="string">&lt;html&gt;</span></div><div class="line"><span class="string">&lt;head lang="en"&gt;</span></div><div class="line"><span class="string">    &lt;meta charset="UTF-8"&gt;</span></div><div class="line"><span class="string">    &lt;title&gt;&lt;/title&gt;</span></div><div class="line"><span class="string">&lt;/head&gt;</span></div><div class="line"><span class="string">&lt;body&gt;</span></div><div class="line"><span class="string">    &lt;li class="item-"&gt;&lt;a href="link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></div><div class="line"><span class="string">    &lt;li class="item-0"&gt;&lt;a href="link1.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></div><div class="line"><span class="string">    &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;</span></div><div class="line"><span class="string">&lt;/body&gt;</span></div><div class="line"><span class="string">&lt;/html&gt;</span></div><div class="line"><span class="string">"""</span></div><div class="line">response = HtmlResponse(url=<span class="string">'http://example.com'</span>, body=html,encoding=<span class="string">'utf-8'</span>)</div><div class="line">ret = Selector(response=response).xpath(<span class="string">'//li[re:test(@class, "item-\d*")]//@href'</span>).extract()</div><div class="line">print(ret)</div></pre></td></tr></table></figure>
<p>语法规则：<br><code>Selector(response=response查询对象).xpath(‘//li[re:test(@class, “item-d*”)]//@href’).extract()</code>，即根据re正则匹配，test即匹配，属性名是class，匹配的正则表达式是”item-d*”，然后获取该标签的href属性。<br><a href="http://scrapy-chs.readthedocs.io/zh_CN/latest/topics/selectors.html" target="_blank" rel="external">更多选择器规则</a></p>
<p>选择器规则示例:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> scrapy</div><div class="line"><span class="keyword">import</span> hashlib</div><div class="line"><span class="keyword">from</span> tutorial.items <span class="keyword">import</span> JinLuoSiItem</div><div class="line"><span class="keyword">from</span> scrapy.http <span class="keyword">import</span> Request</div><div class="line"><span class="keyword">from</span> scrapy.selector <span class="keyword">import</span> HtmlXPathSelector</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">JinLuoSiSpider</span><span class="params">(scrapy.spiders.Spider)</span>:</span></div><div class="line">    count = <span class="number">0</span></div><div class="line">    url_set = set()</div><div class="line"> </div><div class="line">    name = <span class="string">"jluosi"</span></div><div class="line">    domain = <span class="string">'http://www.jluosi.com'</span></div><div class="line">    allowed_domains = [<span class="string">"jluosi.com"</span>]</div><div class="line"> </div><div class="line">    start_urls = [</div><div class="line">        <span class="string">"http://www.jluosi.com:80/ec/goodsDetail.action?jls=QjRDNEIzMzAzOEZFNEE3NQ=="</span>,</div><div class="line">    ]</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></div><div class="line">        md5_obj = hashlib.md5()</div><div class="line">        md5_obj.update(response.url)</div><div class="line">        md5_url = md5_obj.hexdigest()</div><div class="line">        <span class="keyword">if</span> md5_url <span class="keyword">in</span> JinLuoSiSpider.url_set:</div><div class="line">            <span class="keyword">pass</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            JinLuoSiSpider.url_set.add(md5_url)</div><div class="line">            hxs = HtmlXPathSelector(response)</div><div class="line">            <span class="keyword">if</span> response.url.startswith(<span class="string">'http://www.jluosi.com:80/ec/goodsDetail.action'</span>):</div><div class="line">                item = JinLuoSiItem()</div><div class="line">                item[<span class="string">'company'</span>] = hxs.select(<span class="string">'//div[@class="ShopAddress"]/ul/li[1]/text()'</span>).extract()</div><div class="line">                item[<span class="string">'link'</span>] = hxs.select(<span class="string">'//div[@class="ShopAddress"]/ul/li[2]/text()'</span>).extract()</div><div class="line">                item[<span class="string">'qq'</span>] = hxs.select(<span class="string">'//div[@class="ShopAddress"]//a/@href'</span>).re(<span class="string">'.*uin=(?P&lt;qq&gt;\d*)&amp;'</span>)</div><div class="line">                item[<span class="string">'address'</span>] = hxs.select(<span class="string">'//div[@class="ShopAddress"]/ul/li[4]/text()'</span>).extract()</div><div class="line"> </div><div class="line">                item[<span class="string">'title'</span>] = hxs.select(<span class="string">'//h1[@class="goodsDetail_goodsName"]/text()'</span>).extract()</div><div class="line"> </div><div class="line">                item[<span class="string">'unit'</span>] = hxs.select(<span class="string">'//table[@class="R_WebDetail_content_tab"]//tr[1]//td[3]/text()'</span>).extract()</div><div class="line">                product_list = []</div><div class="line">                product_tr = hxs.select(<span class="string">'//table[@class="R_WebDetail_content_tab"]//tr'</span>)</div><div class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>,len(product_tr)):</div><div class="line">                    temp = &#123;</div><div class="line">                        <span class="string">'standard'</span>:hxs.select(<span class="string">'//table[@class="R_WebDetail_content_tab"]//tr[%d]//td[2]/text()'</span> %i).extract()[<span class="number">0</span>].strip(),</div><div class="line">                        <span class="string">'price'</span>:hxs.select(<span class="string">'//table[@class="R_WebDetail_content_tab"]//tr[%d]//td[3]/text()'</span> %i).extract()[<span class="number">0</span>].strip(),</div><div class="line">                    &#125;</div><div class="line">                    product_list.append(temp)</div><div class="line"> </div><div class="line">                item[<span class="string">'product_list'</span>] = product_list</div><div class="line">                <span class="keyword">yield</span> item</div><div class="line"> </div><div class="line">            current_page_urls = hxs.select(<span class="string">'//a/@href'</span>).extract()</div><div class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(current_page_urls)):</div><div class="line">                url = current_page_urls[i]</div><div class="line">                <span class="keyword">if</span> url.startswith(<span class="string">'http://www.jluosi.com'</span>):</div><div class="line">                    url_ab = url</div><div class="line">                    <span class="keyword">yield</span> Request(url_ab, callback=self.parse)</div></pre></td></tr></table></figure></p>
<p>获取响应cookie<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></div><div class="line">    <span class="keyword">from</span> scrapy.http.cookies <span class="keyword">import</span> CookieJar</div><div class="line">    cookieJar = CookieJar()</div><div class="line">    cookieJar.extract_cookies(response, response.request)</div><div class="line">    print(cookieJar._cookies)</div></pre></td></tr></table></figure></p>
<h3 id="格式化处理"><a href="#格式化处理" class="headerlink" title="格式化处理"></a>格式化处理</h3><p>上述实例只是简单的图片处理，所以在parse方法中直接处理。如果对于想要获取更多的数据（获取页面的价格、商品名称、QQ等），则可以利用Scrapy的items将数据格式化，然后统一交由pipelines来处理。即不同功能用不同文件实现。</p>
<p>items：即用户需要爬取哪些数据，是用来格式化数据，并告诉pipelines哪些数据需要保存。</p>
<p>示例items.py文件：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="comment"># Define here the models for your scraped items</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># See documentation in:</span></div><div class="line"><span class="comment"># http://doc.scrapy.org/en/latest/topics/items.html</span></div><div class="line"><span class="keyword">import</span> scrapy</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">JieYiCaiItem</span><span class="params">(scrapy.Item)</span>:</span></div><div class="line">    company = scrapy.Field()</div><div class="line">    title = scrapy.Field()</div><div class="line">    qq = scrapy.Field()</div><div class="line">    info = scrapy.Field()</div><div class="line">    more = scrapy.Field()</div></pre></td></tr></table></figure></p>
<p>即：需要爬取所有url中的公司名，title，qq，基本信息info，更多信息more。<br>上述定义模板，以后对于从请求的源码中获取的数据同样按照此结构来获取，所以在spider中需要有一下操作：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> scrapy</div><div class="line"><span class="keyword">import</span> hashlib</div><div class="line"><span class="keyword">from</span> beauty.items <span class="keyword">import</span> JieYiCaiItem</div><div class="line"><span class="keyword">from</span> scrapy.http <span class="keyword">import</span> Request</div><div class="line"><span class="keyword">from</span> scrapy.selector <span class="keyword">import</span> HtmlXPathSelector</div><div class="line"><span class="keyword">from</span> scrapy.spiders <span class="keyword">import</span> CrawlSpider, Rule</div><div class="line"><span class="keyword">from</span> scrapy.linkextractors <span class="keyword">import</span> LinkExtractor</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">JieYiCaiSpider</span><span class="params">(scrapy.spiders.Spider)</span>:</span></div><div class="line">    count = <span class="number">0</span></div><div class="line">    url_set = set()</div><div class="line"> </div><div class="line">    name = <span class="string">"jieyicai"</span></div><div class="line">    domain = <span class="string">'http://www.jieyicai.com'</span></div><div class="line">    allowed_domains = [<span class="string">"jieyicai.com"</span>]</div><div class="line"> </div><div class="line">    start_urls = [<span class="string">"http://www.jieyicai.com"</span>,]</div><div class="line"> </div><div class="line">    rules = [</div><div class="line">        <span class="comment">#下面是符合规则的网址,但是不抓取内容,只是提取该页的链接(这里网址是虚构的,实际使用时请替换)</span></div><div class="line">        <span class="comment">#Rule(SgmlLinkExtractor(allow=(r'http://test_url/test?page_index=\d+'))),</span></div><div class="line">        <span class="comment">#下面是符合规则的网址,提取内容,(这里网址是虚构的,实际使用时请替换)</span></div><div class="line">        <span class="comment">#Rule(LinkExtractor(allow=(r'http://www.jieyicai.com/Product/Detail.aspx?pid=\d+')), callback="parse"),</span></div><div class="line">    ]</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></div><div class="line">        md5_obj = hashlib.md5()</div><div class="line">        md5_obj.update(response.url)</div><div class="line">        md5_url = md5_obj.hexdigest()</div><div class="line">        <span class="keyword">if</span> md5_url <span class="keyword">in</span> JieYiCaiSpider.url_set:</div><div class="line">            <span class="keyword">pass</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            JieYiCaiSpider.url_set.add(md5_url)</div><div class="line">            </div><div class="line">            hxs = HtmlXPathSelector(response)</div><div class="line">            <span class="keyword">if</span> response.url.startswith(<span class="string">'http://www.jieyicai.com/Product/Detail.aspx'</span>):</div><div class="line">                item = JieYiCaiItem()</div><div class="line">                item[<span class="string">'company'</span>] = hxs.select(<span class="string">'//span[@class="username g-fs-14"]/text()'</span>).extract()</div><div class="line">                item[<span class="string">'qq'</span>] = hxs.select(<span class="string">'//span[@class="g-left bor1qq"]/a/@href'</span>).re(<span class="string">'.*uin=(?P&lt;qq&gt;\d*)&amp;'</span>)</div><div class="line">                item[<span class="string">'info'</span>] = hxs.select(<span class="string">'//div[@class="padd20 bor1 comard"]/text()'</span>).extract()</div><div class="line">                item[<span class="string">'more'</span>] = hxs.select(<span class="string">'//li[@class="style4"]/a/@href'</span>).extract()</div><div class="line">                item[<span class="string">'title'</span>] = hxs.select(<span class="string">'//div[@class="g-left prodetail-text"]/h2/text()'</span>).extract()</div><div class="line">                <span class="keyword">yield</span> item</div><div class="line"> </div><div class="line">            current_page_urls = hxs.select(<span class="string">'//a/@href'</span>).extract()</div><div class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(current_page_urls)):</div><div class="line">                url = current_page_urls[i]</div><div class="line">                <span class="keyword">if</span> url.startswith(<span class="string">'/'</span>):</div><div class="line">                    url_ab = JieYiCaiSpider.domain + url</div><div class="line">                    <span class="keyword">yield</span> Request(url_ab, callback=self.parse)</div><div class="line">```                    </div><div class="line"></div><div class="line">上述代码中：对url进行md5加密的目的是避免url过长，也方便保存在缓存或数据库中。</div><div class="line">此处代码的关键在于：</div><div class="line">* 将获取的数据封装在了Item对象中</div><div class="line">* <span class="keyword">yield</span> Item对象 （一旦parse中执行<span class="keyword">yield</span> Item对象，则自动将该对象交个pipelines的类来处理）</div><div class="line"></div><div class="line">```python</div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="comment"># Define your item pipelines here</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Don't forget to add your pipeline to the ITEM_PIPELINES setting</span></div><div class="line"><span class="comment"># See: http://doc.scrapy.org/en/latest/topics/item-pipeline.html</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">from</span> twisted.enterprise <span class="keyword">import</span> adbapi</div><div class="line"><span class="keyword">import</span> MySQLdb.cursors</div><div class="line"><span class="keyword">import</span> re</div><div class="line"> </div><div class="line">mobile_re = re.compile(<span class="string">r'(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]&#123;8&#125;'</span>)</div><div class="line">phone_re = re.compile(<span class="string">r'(\d+-\d+|\d+)'</span>)</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">JsonPipeline</span><span class="params">(object)</span>:</span></div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.file = open(<span class="string">'/Users/wupeiqi/PycharmProjects/beauty/beauty/jieyicai.json'</span>, <span class="string">'wb'</span>)</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></div><div class="line">        line = <span class="string">"%s  %s\n"</span> % (item[<span class="string">'company'</span>][<span class="number">0</span>].encode(<span class="string">'utf-8'</span>), item[<span class="string">'title'</span>][<span class="number">0</span>].encode(<span class="string">'utf-8'</span>))</div><div class="line">        self.file.write(line)</div><div class="line">        <span class="keyword">return</span> item</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DBPipeline</span><span class="params">(object)</span>:</span></div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.db_pool = adbapi.ConnectionPool(<span class="string">'MySQLdb'</span>,</div><div class="line">                                             db=<span class="string">'DbCenter'</span>,</div><div class="line">                                             user=<span class="string">'root'</span>,</div><div class="line">                                             passwd=<span class="string">'123'</span>,</div><div class="line">                                             cursorclass=MySQLdb.cursors.DictCursor,</div><div class="line">                                             use_unicode=<span class="keyword">True</span>)</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></div><div class="line">        query = self.db_pool.runInteraction(self._conditional_insert, item)</div><div class="line">        query.addErrback(self.handle_error)</div><div class="line">        <span class="keyword">return</span> item</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_conditional_insert</span><span class="params">(self, tx, item)</span>:</span></div><div class="line">        tx.execute(<span class="string">"select nid from company where company = %s"</span>, (item[<span class="string">'company'</span>][<span class="number">0</span>], ))</div><div class="line">        result = tx.fetchone()</div><div class="line">        <span class="keyword">if</span> result:</div><div class="line">            <span class="keyword">pass</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            phone_obj = phone_re.search(item[<span class="string">'info'</span>][<span class="number">0</span>].strip())</div><div class="line">            phone = phone_obj.group() <span class="keyword">if</span> phone_obj <span class="keyword">else</span> <span class="string">' '</span></div><div class="line"> </div><div class="line">            mobile_obj = mobile_re.search(item[<span class="string">'info'</span>][<span class="number">1</span>].strip())</div><div class="line">            mobile = mobile_obj.group() <span class="keyword">if</span> mobile_obj <span class="keyword">else</span> <span class="string">' '</span></div><div class="line"> </div><div class="line">            values = (</div><div class="line">                item[<span class="string">'company'</span>][<span class="number">0</span>],</div><div class="line">                item[<span class="string">'qq'</span>][<span class="number">0</span>],</div><div class="line">                phone,</div><div class="line">                mobile,</div><div class="line">                item[<span class="string">'info'</span>][<span class="number">2</span>].strip(),</div><div class="line">                item[<span class="string">'more'</span>][<span class="number">0</span>])</div><div class="line">            tx.execute(<span class="string">"insert into company(company,qq,phone,mobile,address,more) values(%s,%s,%s,%s,%s,%s)"</span>, values)</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_error</span><span class="params">(self, e)</span>:</span></div><div class="line">        print(<span class="string">'error'</span>,e)</div></pre></td></tr></table></figure></p>
<p>上述代码中多个类的目的是，可以同时保存在文件和数据库中，保存的优先级可以在配置文件settings中定义。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ITEM_PIPELINES = &#123;</div><div class="line">    &apos;beauty.pipelines.DBPipeline&apos;: 300,</div><div class="line">    &apos;beauty.pipelines.JsonPipeline&apos;: 100,</div><div class="line">&#125;</div><div class="line"># 每行后面的整型值，确定了他们运行的顺序，item按数字从低到高的顺序，通过pipeline，通常将这些数字定义在0-1000范围内。</div></pre></td></tr></table></figure>
<h3 id="设置编码"><a href="#设置编码" class="headerlink" title="设置编码"></a>设置编码</h3><p>自Scrapy1.2 起，增加了<code>FEED_EXPORT_ENCODING</code>属性，用于设置输出编码.在settings.py中添加下面的配置即可.<br><code>FEED_EXPORT_ENCODING = &#39;utf-8&#39;</code></p>
<h3 id="运行爬虫-1"><a href="#运行爬虫-1" class="headerlink" title="运行爬虫"></a>运行爬虫</h3><p>首先需要列出所有可运行的爬虫，输入: <code>scrapy list</code>, 回车, 这会列出所有爬虫类中指定的name属性。<br>然后，我们可以按照name来指定运行爬虫, 如:<code>scrapy crawl &#39;csdn_blog&#39; -o blog.json</code>.</p>
<h3 id="关于ROBOTSTXT-OBEY"><a href="#关于ROBOTSTXT-OBEY" class="headerlink" title="关于ROBOTSTXT_OBEY"></a>关于ROBOTSTXT_OBEY</h3><p>在settings.py文件，ROBOTSTXT_OBEY默认为True，就是要遵守robots.txt 的规则.<br>那么 robots.txt 是什么东西呢？<br>robots.txt 是遵循 Robot 协议的一个文件，它保存在网站的服务器中，它的作用是，告诉<strong>搜索引擎爬虫</strong>，本网站哪些目录下的网页不希望被爬取收录。在Scrapy启动后，会在第一时间访问网站的 robots.txt 文件，然后决定该网站的爬取范围。当然，我们并不是在做搜索引擎，而且在某些情况下我们想要获取的内容恰恰是被 robots.txt 所禁止访问的。所以，某些时候，我们就要将此配置项设置为 False ，拒绝遵守 Robot协议 ！所以在这里设置为False。当然可能本次爬取不一定会被它限制，但一般来说会首先选择禁止它。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://python.jobbole.com/86405/" target="_blank" rel="external">http://python.jobbole.com/86405/</a></li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python/" rel="tag"># Python</a>
          
            <a href="/tags/Scrapy/" rel="tag"># Scrapy</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/06/12/python-process-2017-06-12/" rel="next" title="Python之进程">
                <i class="fa fa-chevron-left"></i> Python之进程
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/06/15/dp-brief-2017-06-15/" rel="prev" title="设计模式简介">
                设计模式简介 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Arvin</p>
              <p class="site-description motion-element" itemprop="description">Learn and live.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">141</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Scrapy简介"><span class="nav-number">1.</span> <span class="nav-text">Scrapy简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scrapy框架及组件"><span class="nav-number">2.</span> <span class="nav-text">Scrapy框架及组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scrapy安装"><span class="nav-number">3.</span> <span class="nav-text">Scrapy安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scrapy基本使用"><span class="nav-number">4.</span> <span class="nav-text">Scrapy基本使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建爬虫项目"><span class="nav-number">4.1.</span> <span class="nav-text">创建爬虫项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编写爬虫"><span class="nav-number">4.2.</span> <span class="nav-text">编写爬虫</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#运行爬虫"><span class="nav-number">4.3.</span> <span class="nav-text">运行爬虫</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scrapy查询语法"><span class="nav-number">5.</span> <span class="nav-text">scrapy查询语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#递归爬取网页"><span class="nav-number">6.</span> <span class="nav-text">递归爬取网页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scrapy查询语法中的正则："><span class="nav-number">7.</span> <span class="nav-text">scrapy查询语法中的正则：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#格式化处理"><span class="nav-number">8.</span> <span class="nav-text">格式化处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置编码"><span class="nav-number">9.</span> <span class="nav-text">设置编码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行爬虫-1"><span class="nav-number">10.</span> <span class="nav-text">运行爬虫</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关于ROBOTSTXT-OBEY"><span class="nav-number">11.</span> <span class="nav-text">关于ROBOTSTXT_OBEY</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考"><span class="nav-number">12.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Arvin</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  

  

  

</body>
</html>
