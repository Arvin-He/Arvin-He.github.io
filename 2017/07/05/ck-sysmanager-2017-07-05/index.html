<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Learn and live."><title>cookbook之脚本编程与系统管理 | Simple &amp; Freedom</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">cookbook之脚本编程与系统管理</h1><a id="logo" href="/.">Simple &amp; Freedom</a><p class="description">Learn and live.</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/404.html"><i class="fa fa-heartbeat"> 公益404</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">cookbook之脚本编程与系统管理</h1><div class="post-meta">Jul 5, 2017<span> | </span><span class="category"><a href="/categories/python/">python</a></span></div><div class="post-content"><h3 id="通过重定向-管道-文件接受输入"><a href="#通过重定向-管道-文件接受输入" class="headerlink" title="通过重定向/管道/文件接受输入"></a>通过重定向/管道/文件接受输入</h3><p>命令行的输出通过管道传递给该脚本、重定向文件到该脚本，在命令行中传递一个文件名或文件名列表给该脚本。<br>Python 内置的 fileinput 模块让这个变得简单</p>
<h3 id="终止程序并给出错误信息"><a href="#终止程序并给出错误信息" class="headerlink" title="终止程序并给出错误信息"></a>终止程序并给出错误信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sys</div><div class="line">sys.stderr.write(<span class="string">'It failed!\n'</span>)</div><div class="line"><span class="keyword">raise</span> SystemExit(<span class="number">1</span>)</div></pre></td></tr></table></figure>
<h3 id="解析命令行选项"><a href="#解析命令行选项" class="headerlink" title="解析命令行选项"></a>解析命令行选项</h3><p>argparse 模块可被用来解析命令行选项, argparse 模块是标准库中最大的模块之一，拥有大量的配置选项。</p>
<h3 id="运行时弹出密码输入提示"><a href="#运行时弹出密码输入提示" class="headerlink" title="运行时弹出密码输入提示"></a>运行时弹出密码输入提示</h3><p>你写了个脚本，运行时需要一个密码。此脚本是交互式的，因此不能将密码在脚本中硬编码，而是需要弹出一个密码输入提示，让用户自己输入.<br>Python 的 getpass 模块正是你所需要的.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> getpass</div><div class="line"></div><div class="line">user = getpass.getuser()</div><div class="line">passwd = getpass.getpass()</div><div class="line"></div><div class="line"><span class="keyword">if</span> svc_login(user, passwd): <span class="comment"># You must write svc_login()</span></div><div class="line">    print(<span class="string">'Yay!'</span>)</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    print(<span class="string">'Boo!'</span>)</div></pre></td></tr></table></figure></p>
<p>注意在前面代码中 getpass.getuser() 不会弹出用户名的输入提示。它会根据该用户的 shell 环境或者会依据本地系统的密码库（支持 pwd 模块的平台）来使用当前用户的登录名，如果你想显示的弹出用户名输入提示，使用内置的 input 函数：<code>user = input(&#39;Enter your username: &#39;)</code><br>还有一点很重要，有些系统可能不支持 getpass() 方法隐藏输入密码。这种情况下，Python 会提前警告你这些问题（例如它会警告你说密码会以明文形式显示）</p>
<h3 id="获取终端的大小"><a href="#获取终端的大小" class="headerlink" title="获取终端的大小"></a>获取终端的大小</h3><p>使用 os.get terminal size() 函数来做到这一点</p>
<h3 id="执行外部命令并获取它的输出"><a href="#执行外部命令并获取它的输出" class="headerlink" title="执行外部命令并获取它的输出"></a>执行外部命令并获取它的输出</h3><p>使用 subprocess.check output() 函数,<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> subprocess</div><div class="line">out_bytes = subprocess.check_output([<span class="string">'netstat'</span>,<span class="string">'-a'</span>])</div></pre></td></tr></table></figure></p>
<p>这段代码执行一个指定的命令并将执行结果以一个字节字符串的形式返回。如果你<br>需要文本形式返回，加一个解码步骤即可。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">out_text = out_bytes.decode(<span class="string">'utf-8'</span>)</div><div class="line"><span class="comment"># 或者直接将输出解码</span></div><div class="line">out_text = subprocess.check_output([<span class="string">'netstat'</span>,<span class="string">'-a'</span>]).decode(<span class="string">'utf-8'</span>)</div></pre></td></tr></table></figure></p>
<p>默认情况下，check output() 仅仅返回输入到标准输出的值。如果你需要同时收集标准输出和错误输出，使用 stderr 参数：<br><code>out_bytes = subprocess.check_output([&#39;cmd&#39;,&#39;arg1&#39;,&#39;arg2&#39;], stderr=subprocess.STDOUT)</code><br>如果你需要用一个超时机制来执行命令，使用 timeout 参数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span>:</div><div class="line">    out_bytes = subprocess.check_output([<span class="string">'cmd'</span>,<span class="string">'arg1'</span>,<span class="string">'arg2'</span>], timeout=<span class="number">5</span>)</div><div class="line"><span class="keyword">except</span> subprocess.TimeoutExpired <span class="keyword">as</span> e:</div><div class="line">    ...</div></pre></td></tr></table></figure></p>
<p>你想让命令被一个shell 执行，传递一个字符串参数，并设置参数 shell=True . 有时候你想要 Python 去执行一个复杂的 shell 命令的时候这个就很有用了，比如管道流、I/O 重定向和其他特<br>性。例如：<code>out_bytes = subprocess.check_output(&#39;grep python | wc &gt; out&#39;, shell=True)</code><br>使用 check output() 函数是执行外部命令并获取其返回值的最简单方式,如果你需要对子进程做更复杂的交互，比如给它发送输入，你得采用另外一种方法。这时候可直接使用 subprocess.Popen 类。</p>
<h3 id="复制或者移动文件和目录"><a href="#复制或者移动文件和目录" class="headerlink" title="复制或者移动文件和目录"></a>复制或者移动文件和目录</h3><p>你想要复制或移动文件和目录，但是又不想调用 shell 命令,shutil 模块有很多便捷的函数可以复制文件和目录.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> shutil</div><div class="line"><span class="comment"># Copy src to dst. (cp src dst)</span></div><div class="line">shutil.copy(src, dst)</div><div class="line"><span class="comment"># Copy files, but preserve metadata (cp -p src dst)</span></div><div class="line">shutil.copy2(src, dst)</div><div class="line"><span class="comment"># Copy directory tree (cp -R src dst)</span></div><div class="line">shutil.copytree(src, dst)</div><div class="line"><span class="comment"># Move src to dst (mv src dst)</span></div><div class="line">shutil.move(src, dst)</div></pre></td></tr></table></figure></p>
<p>如果源文件是一个符号链接，那么目标文件将会是符号链接指向的文件。如果你只想复制符号链接本身，那么需要指定关键字参数 follow symlinks,如果你想保留被复制目录中的符号链接<br><code>shutil.copytree(src, dst, symlinks=True)</code>.<br>copytree() 可以让你在复制过程中选择性的忽略某些文件或目录,<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ignore_pyc_files</span><span class="params">(dirname, filenames)</span>:</span></div><div class="line">    <span class="keyword">return</span> [name <span class="keyword">in</span> filenames <span class="keyword">if</span> name.endswith(<span class="string">'.pyc'</span>)]</div><div class="line"></div><div class="line">shutil.copytree(src, dst, ignore=ignore_pyc_files)</div></pre></td></tr></table></figure></p>
<p>对于文件元数据信息，copy2() 这样的函数只能尽自己最大能力来保留它。访问时间、创建时间和权限这些基本信息会被保留，但是对于所有者、ACLs、资源 fork 和其他更深层次的文件元信息就说不准了，这个还得依赖于底层操作系统类型和用户所拥有的访问权限。你通常不会去使用 shutil.copytree() 函数来执行系统备份。当处理文件名的时候，最好使用 os.path 中的函数来确保最大的可移植性（特别是同时要适用于 Unix 和Windows）。</p>
<p>使用 copytree() 复制文件夹的一个棘手的问题是对于错误的处理。例如，在复制过程中，函数可能会碰到损坏的符号链接，因为权限无法访问文件的问题等等。为了解决这个问题，所有碰到的问题会被收集到一个列表中并打包为一个单独的异常，到了最后再抛出。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span>:</div><div class="line">    shutil.copytree(src, dst)</div><div class="line"><span class="keyword">except</span> shutil.Error <span class="keyword">as</span> e:</div><div class="line">    <span class="keyword">for</span> src, dst, msg <span class="keyword">in</span> e.args[<span class="number">0</span>]:</div><div class="line">        <span class="comment"># src is source name</span></div><div class="line">        <span class="comment"># dst is destination name</span></div><div class="line">        <span class="comment"># msg is error message from exception</span></div><div class="line">        print(dst, src, msg)</div></pre></td></tr></table></figure></p>
<p>如果你提供关键字参数 ignore dangling symlinks=True ，这时候 copytree() 会忽略掉无效符号链接。</p>
<h3 id="创建和解压归档文件"><a href="#创建和解压归档文件" class="headerlink" title="创建和解压归档文件"></a>创建和解压归档文件</h3><p>shutil 模块拥有两个函数—— make archive() 和 unpack archive() 可派上用场.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> shutil</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>shutil.unpack_archive(<span class="string">'Python-3.3.0.tgz'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>shutil.make_archive(<span class="string">'py33'</span>,<span class="string">'zip'</span>,<span class="string">'Python-3.3.0'</span>)</div><div class="line"><span class="string">'/Users/beazley/Downloads/py33.zip'</span></div></pre></td></tr></table></figure></p>
<p><code>make archive()</code> 的第二个参数是期望的输出格式。可以使用<code>get_archive_formats()</code> 获取所有支持的归档格式列表。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>shutil.get_archive_formats()</div><div class="line">[(<span class="string">'bztar'</span>, <span class="string">"bzip2'ed tar-file"</span>), (<span class="string">'gztar'</span>, <span class="string">"gzip'ed tar-file"</span>),</div><div class="line">(<span class="string">'tar'</span>, <span class="string">'uncompressed tar file'</span>), (<span class="string">'zip'</span>, <span class="string">'ZIP file'</span>)]</div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure></p>
<p>Python 还有其他的模块可用来处理多种归档格式（比如 tarfile, zipfile, gzip, bz2）的底层细节。</p>
<h3 id="通过文件名查找文件"><a href="#通过文件名查找文件" class="headerlink" title="通过文件名查找文件"></a>通过文件名查找文件</h3><p>查找文件，可使用 <code>os.walk()</code> 函数，传一个顶级目录名给它.查找特定的文件名并答应所有符合条件的文件全路径<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python3.3</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">findfile</span><span class="params">(start, name)</span>:</span></div><div class="line">    <span class="keyword">for</span> relpath, dirs, files <span class="keyword">in</span> os.walk(start):</div><div class="line">        <span class="keyword">if</span> name <span class="keyword">in</span> files:</div><div class="line">            full_path = os.path.join(start, relpath, name)</div><div class="line">            print(os.path.normpath(os.path.abspath(full_path)))</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    findfile(sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>])</div></pre></td></tr></table></figure></p>
<p><code>os.walk()</code> 方法为我们遍历目录树，每次进入一个目录，它会返回一个三元组，包含相对于查找目录的相对路径，一个该目录下的目录名列表，以及那个目录下面的文件名列表。<br>对于每个元组，只需检测一下目标文件名是否在文件列表中。如果是就使用<code>os.path.join()</code> 合并路径。为了避免奇怪的路径名比如 <code>././foo//bar</code> ，使用了另外两个函数来修正结果。第一个是 <code>os.path.abspath()</code> , 它接受一个路径，可能是相对路径，最后返回绝对路径。第二个是 <code>os.path.normpath()</code> ，用来返回正常路径，可以解决双斜杆、对目录的多重引用的问题等。</p>
<h3 id="读取配置文件"><a href="#读取配置文件" class="headerlink" title="读取配置文件"></a>读取配置文件</h3><p>读取普通.ini 格式的配置文件, configparser 模块能被用来读取配置文件, 使用 <code>cfg.write()</code> 方法将其写回到文件<br><strong>注意:</strong>配置文件中的名字是不区分大小写的. 但可以指定是否对大小写敏感(通过指定configparser示例对象的optionxform属性<code>cf.optionxform = str</code>).<br>配置文件并不是从上而下的顺序执行,是一个整体被读取.如果碰到了变量替换，它实际上已经被替换完成了,<br>在下面这个配置中，prefix 变量在使用它的变量之前后之后定义都是可以的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[installation]</div><div class="line">library=%(prefix)s/lib</div><div class="line">include=%(prefix)s/include</div><div class="line">bin=%(prefix)s/bin</div><div class="line">prefix=/usr/local</div></pre></td></tr></table></figure></p>
<p>ConfigParser 有个容易被忽视的特性是它能一次读取多个配置文件然后合并成一个配置。</p>
<h3 id="给简单脚本增加日志功能"><a href="#给简单脚本增加日志功能" class="headerlink" title="给简单脚本增加日志功能"></a>给简单脚本增加日志功能</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> logging</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># Configure the logging system</span></div><div class="line">    logging.basicConfig(filename=<span class="string">'app.log'</span>, level=logging.ERROR)</div><div class="line">    <span class="comment"># Variables (to make the calls that follow work)</span></div><div class="line">    hostname = <span class="string">'www.python.org'</span></div><div class="line">    item = <span class="string">'spam'</span></div><div class="line">    filename = <span class="string">'data.csv'</span></div><div class="line">    mode = <span class="string">'r'</span></div><div class="line">    <span class="comment"># Example logging calls (insert into your program)</span></div><div class="line">    logging.critical(<span class="string">'Host %s unknown'</span>, hostname)</div><div class="line">    logging.error(<span class="string">"Couldn't find %r"</span>, item)</div><div class="line">    logging.warning(<span class="string">'Feature is deprecated'</span>)</div><div class="line">    logging.info(<span class="string">'Opening file %r, mode=%r'</span>, filename, mode)</div><div class="line">    logging.debug(<span class="string">'Got here'</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure>
<p>上面的日志配置都是硬编码到程序中的。如果你想使用配置文件，可以像下面这样修改 basicConfig() 调用：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> logging</div><div class="line"><span class="keyword">import</span> logging.config</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># Configure the logging system</span></div><div class="line">    logging.config.fileConfig(<span class="string">'logconfig.ini'</span>)</div><div class="line">    ...</div></pre></td></tr></table></figure></p>
<p>创建一个下面这样的文件，名字叫 logconfig.ini ,如果你想修改配置，可以直接编辑文件 logconfig.ini 即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[loggers]</div><div class="line">keys=root</div><div class="line"></div><div class="line">[handlers]</div><div class="line">keys=defaultHandler</div><div class="line"></div><div class="line">[formatters]</div><div class="line">keys=defaultFormatter</div><div class="line"></div><div class="line">[logger_root]</div><div class="line">level=INFO</div><div class="line">handlers=defaultHandler</div><div class="line">qualname=root</div><div class="line"></div><div class="line">[handler_defaultHandler]</div><div class="line">class=FileHandler</div><div class="line">formatter=defaultFormatter</div><div class="line">args=(&apos;app.log&apos;, &apos;a&apos;)</div><div class="line"></div><div class="line">[formatter_defaultFormatter]</div><div class="line">format=%(levelname)s:%(name)s:%(message)s</div></pre></td></tr></table></figure></p>
<h3 id="实现一个计时器记录程序执行多个任务所花费的时间"><a href="#实现一个计时器记录程序执行多个任务所花费的时间" class="headerlink" title="实现一个计时器记录程序执行多个任务所花费的时间"></a>实现一个计时器记录程序执行多个任务所花费的时间</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Timer</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func=time.perf_counter)</span>:</span></div><div class="line">        self.elapsed = <span class="number">0.0</span></div><div class="line">        self._func = func</div><div class="line">        self._start = <span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">if</span> self._start <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">'Already started'</span>)</div><div class="line">        self._start = self._func()</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">stop</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">if</span> self._start <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">'Not started'</span>)</div><div class="line">        end = self._func()</div><div class="line">        self.elapsed += end - self._start</div><div class="line">        self._start = <span class="keyword">None</span></div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset</span><span class="params">(self)</span>:</span></div><div class="line">        self.elapsed = <span class="number">0.0</span></div><div class="line">    </div><div class="line"><span class="meta">    @property</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">running</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self._start <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span></div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></div><div class="line">        self.start()</div><div class="line">        <span class="keyword">return</span> self</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, *args)</span>:</span></div><div class="line">        self.stop()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">countdown</span><span class="params">(n)</span>:</span></div><div class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</div><div class="line">        n -= <span class="number">1</span></div><div class="line"></div><div class="line"><span class="comment"># Use 1: Explicit start/stop</span></div><div class="line">t = Timer()</div><div class="line">t.start()</div><div class="line">countdown(<span class="number">1000000</span>)</div><div class="line">t.stop()</div><div class="line">print(t.elapsed)</div><div class="line"></div><div class="line"><span class="comment"># Use 2: As a context manager</span></div><div class="line"><span class="keyword">with</span> t:</div><div class="line">    countdown(<span class="number">1000000</span>)</div><div class="line">    print(t.elapsed)</div><div class="line"></div><div class="line"><span class="keyword">with</span> Timer() <span class="keyword">as</span> t2:</div><div class="line">    countdown(<span class="number">1000000</span>)</div><div class="line">    print(t2.elapsed)</div></pre></td></tr></table></figure>
<h3 id="限制内存和-CPU-的使用量"><a href="#限制内存和-CPU-的使用量" class="headerlink" title="限制内存和 CPU 的使用量"></a>限制内存和 CPU 的使用量</h3><p>对在 Unix 系统上面运行的程序设置内存或 CPU 的使用限制。resource 模块能同时执行这两个任务</p>
<h3 id="启动一个-WEB-浏览器"><a href="#启动一个-WEB-浏览器" class="headerlink" title="启动一个 WEB 浏览器"></a>启动一个 WEB 浏览器</h3><p>通过脚本启动浏览器并打开指定的 URL 网页,webbrowser 模块能被用来启动一个浏览器，并且与平台无关.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> webbrowser</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>webbrowser.open(<span class="string">'http://www.python.org'</span>)</div><div class="line"><span class="keyword">True</span></div></pre></td></tr></table></figure></p>
<p>它会使用默认浏览器打开指定网页。如果你还想对网页打开方式做更多控制，还可以使用下面这些函数：<br>打开一个新的浏览器窗口或者标签，只要浏览器支持就行。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Open the page in a new browser window</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>webbrowser.open_new(<span class="string">'http://www.python.org'</span>)</div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Open the page in a new browser tab</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>webbrowser.open_new_tab(<span class="string">'http://www.python.org'</span>)</div><div class="line"><span class="keyword">True</span></div></pre></td></tr></table></figure></p>
<p>如果你想指定浏览器类型，可以使用 webbrowser.get() 函数来指定某个特定浏览器。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>c = webbrowser.get(<span class="string">'firefox'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c.open(<span class="string">'http://www.python.org'</span>)</div><div class="line"><span class="keyword">True</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c.open_new_tab(<span class="string">'http://docs.python.org'</span>)</div><div class="line"><span class="keyword">True</span></div></pre></td></tr></table></figure></p>
</div><div class="tags"><a href="/tags/python/">python</a></div><div class="post-nav"><a href="/2017/07/05/ck-testdebugexception-2017-07-05/" class="pre">cookbook之测试,调试和异常</a><a href="/2017/07/05/ck-multi-program-2017-07-05/" class="next">cookbook之并发编程</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/思想/">思想</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/方法/" style="font-size: 15px;">方法</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/计算机基础/" style="font-size: 15px;">计算机基础</a> <a href="/tags/谷歌/" style="font-size: 15px;">谷歌</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/OOP/" style="font-size: 15px;">OOP</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/flask/" style="font-size: 15px;">flask</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/NSIS/" style="font-size: 15px;">NSIS</a> <a href="/tags/scrapy/" style="font-size: 15px;">scrapy</a> <a href="/tags/PyQt5/" style="font-size: 15px;">PyQt5</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/RegExp/" style="font-size: 15px;">RegExp</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/SVN/" style="font-size: 15px;">SVN</a> <a href="/tags/tornado/" style="font-size: 15px;">tornado</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/02/01/spiderallsite-2018-02-01/">全站爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/25/linux-crontab-2018-01-25/">linux之crontab使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/16/py-scrapy2-2018-01-16/">scrapy笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/15/py-scrapy1-2018-01-15/">scrapy笔记-安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/15/py-pipcmds-2018-01-15/">python之pip常用命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/11/css-note1-2018-01-11/">css笔记1</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/11/selenium-phatomjs-2017-12-11/">selenium-phatomjs使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/08/jQuery-notes1-2017-12-08/">jQuery笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/08/js-dom-2017-12-08/">javascript之DOM操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/08/appium-notes1-2017-12-08/">Appium笔记</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Simple &amp; Freedom.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>