<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Learn and live."><title>python之Sip使用 | Simple &amp; Freedom</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">python之Sip使用</h1><a id="logo" href="/.">Simple &amp; Freedom</a><p class="description">Learn and live.</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/404.html"><i class="fa fa-heartbeat"> 公益404</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">python之Sip使用</h1><div class="post-meta">May 13, 2017<span> | </span><span class="category"><a href="/categories/编程/">编程</a></span></div><div class="post-content"><h3 id="Sip使用步骤"><a href="#Sip使用步骤" class="headerlink" title="Sip使用步骤"></a>Sip使用步骤</h3><p>第一步: 编写个C文件，功能是将两个数字相加并输出，命名为add.c，这个将成为在Python中的模块名，如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* File : add.c */</span>  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span>   </span></div><div class="line"><span class="function"></span>&#123;    </div><div class="line">    <span class="keyword">int</span> g;    </div><div class="line">    g = x + y;  </div><div class="line">    <span class="keyword">return</span> g;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>第二步: <strong>手工编写</strong>SIP文件，在使用SIP的过程中，一个C/C++的源码文件尽量对应一个同名的sip文件,这里命名为add.sip，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/* Define the SIP wrapper to the add library. */  </div><div class="line">%Module(name=add, language=&quot;C&quot;)  </div><div class="line">int add(int x, int y);</div></pre></td></tr></table></figure></p>
<p>如果是源程序是用C++写的，那么这里的（name=add, language=”C”）就可以省去。<br>这里的C源码文件没有头文件，所以对应的sip文件很简单。<br>如果C/C++的源码是实现部分，在实现部分还包括接口部分，即头文件。那么在相应的sip文件中需要用下面的代码来包含相应的头文件.<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">%TypeHeaderCode  </div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;word.h&gt;  </span></span></div><div class="line">%End</div></pre></td></tr></table></figure></p>
<p>sip文件与正式的C/C++头文件相似，但与之不同的是：sip文件不包含相应的头文件的私有成员变量（private或protected）。<br>更详细的sip文件编写规范，请参考riverbank官方网站上的说明文档SIP Reference Guide。</p>
<p>第三步:编译C文件。按照官网的说法，是编写configure.py，但先做一些必不可少的工作。<br>在命令行将add.c编译成add.o文件：输入<code>gcc -c add.c</code>, 将这一步生成的add.o文件<br>生产库文件：<code>ar -r libadd.a add.o</code>,这两步在这里是为一个单独的C模块测试的，<br>如果是大量的C模块，可以用一个makefile一并批量完成。<br>记住，需要将libadd.a文件复制到Python文件夹下的libs文件夹中。也可以将源代码直接编译成dll</p>
<p>第四步:手工编写configure.py文件，同样，这个configure文件的编写也不难，看下规范就会了。这里，我们模仿官网的模版写一个自己的configure.py。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os  </div><div class="line"><span class="keyword">import</span> sipconfig  </div><div class="line"><span class="comment"># The name of the SIP build file generated by SIP and used by the build system.  </span></div><div class="line">build_file = <span class="string">"add.sbf"</span>  </div><div class="line">  </div><div class="line"><span class="comment"># Get the SIP configuration information.  </span></div><div class="line">config = sipconfig.Configuration()  </div><div class="line">  </div><div class="line"><span class="comment"># Run SIP to generate the code.  </span></div><div class="line">os.system(<span class="string">" "</span>.join([config.sip_bin, <span class="string">"-c"</span>, <span class="string">"."</span>, <span class="string">"-b"</span>, build_file, <span class="string">"add.sip"</span>]))  </div><div class="line">  </div><div class="line"><span class="comment"># Create the Makefile.  </span></div><div class="line">makefile = sipconfig.SIPModuleMakefile(config, build_file)  </div><div class="line">  </div><div class="line"><span class="comment"># Add the library we are wrapping.  The name doesn't include any platform  </span></div><div class="line"><span class="comment"># specific prefixes or extensions (e.g. the "lib" prefix on UNIX, or the  </span></div><div class="line"><span class="comment"># ".dll" extension on Windows).  </span></div><div class="line">makefile.extra_libs = [<span class="string">"add"</span>]  </div><div class="line">  </div><div class="line"><span class="comment"># Generate the Makefile itself.  </span></div><div class="line">makefile.generate()</div></pre></td></tr></table></figure></p>
<p>第五步:运行configure.py，会生成一个makefile文件（直接用IDLE打开configure.py，按F5运行；或者命令行用python configure.py运行都可以）。<br>这里有个诡异的地方，有的人会在这一步会报错，说找不到add.sbf文件，而add.sbf文件应该是configure.py运行时调用相关函数自动产生的。<br>若出现这个问题，请重新编译SIP。如果是Windows下，最好是在另一台机器上拷贝一个完整的包含能正常的SIP的Python文件夹，到有问题的机器上，将问题Python文件夹覆盖掉。</p>
<p>第六步: 在命令行输入make（这里会生成一个关于函数的警告，不用管它，若有问题请检查前面的步骤），生成add.pyd文件。<br>然后再输入make install（将add.pyd文件装入到Python的Lib文件夹下的sit-packages文件夹中）。</p>
<p>第七步: 打开Python 的命令行，进行测试：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt;<span class="keyword">import</span> add  </div><div class="line">&gt;&gt;&gt;add.add(<span class="number">4</span>, <span class="number">7</span>)  </div><div class="line"><span class="number">11</span>  </div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure></p>
<p>提示：<br>（1）这些文件可以放到Python的文件夹下新建的文件夹中（所有的操作在这个目录下的命令行窗口中使用）。<br>注意，Python的父文件夹名不能有空格，否则会无法读取库文件。<br>（2）使用MinGW，需要把~\MinGW\bin添加的环境变量中（Linux下则不必），这样才能使用gcc、make和ar等工具。</p>
<h3 id="C-中的sip写法"><a href="#C-中的sip写法" class="headerlink" title="C++中的sip写法"></a>C++中的sip写法</h3><p>具体的实现办法和上面介绍的相似，所不同的就是根据相应的C++头文件来写对应的sip文件。详细过程如下。</p>
<p>首先，写好C++类的实现和接口部分（以Geometry类中的方法，输入半径，显示周长或面积为例）：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Geometry.h</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Geometry</span></span></div><div class="line"><span class="class">&#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        Geometry(<span class="keyword">double</span> r); <span class="comment">//构造函数</span></div><div class="line">        <span class="function"><span class="keyword">double</span> <span class="title">calPerimeter</span><span class="params">(<span class="keyword">double</span> radius)</span></span>;  <span class="comment">//参数半径，返回圆周长</span></div><div class="line">        <span class="function"><span class="keyword">double</span> <span class="title">calArea</span><span class="params">(<span class="keyword">double</span> radius)</span></span>;  <span class="comment">//参数半径，返回原面积</span></div><div class="line"> </div><div class="line">    <span class="keyword">private</span>:</div><div class="line">        <span class="keyword">double</span>     perimeter;</div><div class="line">        <span class="keyword">double</span>     radius;</div><div class="line">        <span class="keyword">double</span>     area;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>接着，是C++的实现部分：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Geometry.cpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Geometry.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PI 3.141592 </span></div><div class="line"> </div><div class="line">Geometry::Geometry(<span class="keyword">double</span> r) <span class="comment">//构造函数</span></div><div class="line">&#123;</div><div class="line">    radius = r;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">double</span> Geometry::calPerimeter(<span class="keyword">double</span> radius)  <span class="comment">//参数半径，返回圆周长</span></div><div class="line">&#123;</div><div class="line">    perimeter = radius * <span class="number">2</span>* PI;</div><div class="line">    <span class="keyword">return</span> perimeter;</div><div class="line">&#125;</div><div class="line"><span class="keyword">double</span> Geometry::calArea(<span class="keyword">double</span> radius)  <span class="comment">//参数半径，返回原面积</span></div><div class="line">&#123;</div><div class="line">    area = radius * radius * PI;</div><div class="line">    <span class="keyword">return</span> perimeter;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>第三步：如同上文中介绍的，在命令行中用g++ -c Geometry.cpp和ar -r libGeometry.a Geometry.o来编译出库文件，并把库文件添加到Python文件夹下的libs文件夹中。</p>
<p>第四步：编写C++文件对应的sip文件，再次提示，sip文件是基于C++的头文件的。本例中的sip文件内容为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">//Geometry.sip</div><div class="line">%Module Geometry</div><div class="line"> </div><div class="line">class Geometry &#123;</div><div class="line">%TypeHeaderCode</div><div class="line">#include &lt;Geometry.h&gt;</div><div class="line">%End</div><div class="line"> </div><div class="line">public:</div><div class="line">    Geometry(double r);   </div><div class="line">    double calPerimeter(double radius);</div><div class="line">    double calArea(double radius);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>第五步：在命令行中使用Python configure.py命令，注意，configure.py文件是自己写的，configure的模板在上文中有，只需将上文中的模板中的add改为对应的Geometry，也就是类名就可以了。</p>
<p>第六步：在命令行中依次使用mingw32-make和ming32-make install将编译出的Geometry.pyd复制到Python文件夹下的Libs/site-packages文件夹中。</p>
<p>若不出意外，上述步骤可以执行成功。注：这里所有的命令都是在Geometry类的文件所在目录下完成的。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://blog.csdn.net/sunny2038/article/details/7237630" target="_blank" rel="external">http://blog.csdn.net/sunny2038/article/details/7237630</a></li>
</ul>
</div><div class="tags"><a href="/tags/Python/">Python</a></div><div class="post-nav"><a href="/2017/05/24/python-decorator-2017-05-24/" class="pre">Python之装饰器</a><a href="/2017/05/13/nsis-2017-05-13/" class="next">NSIS打包发布Windows可执行文件</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/思想/">思想</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Javascript/" style="font-size: 15px;">Javascript</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/计算机基础/" style="font-size: 15px;">计算机基础</a> <a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/谷歌/" style="font-size: 15px;">谷歌</a> <a href="/tags/OOP/" style="font-size: 15px;">OOP</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/Flask/" style="font-size: 15px;">Flask</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/HTML/" style="font-size: 15px;">HTML</a> <a href="/tags/方法/" style="font-size: 15px;">方法</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/NodeJS/" style="font-size: 15px;">NodeJS</a> <a href="/tags/NSIS/" style="font-size: 15px;">NSIS</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/PyQt5/" style="font-size: 15px;">PyQt5</a> <a href="/tags/Scrapy/" style="font-size: 15px;">Scrapy</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/RegExp/" style="font-size: 15px;">RegExp</a> <a href="/tags/tornado/" style="font-size: 15px;">tornado</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/SVN/" style="font-size: 15px;">SVN</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/11/25/redis-note1-2017-11-25/">redis笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/16/tornado-note2-2017-11-16/">tornado学习笔记(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/16/howtoreadsource-2017-11-16/">如何去阅读源码</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/16/tornado-note1-2017-11-16/">tornado学习笔记(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/06/someconcept-2017-11-06/">Linux IO模式及 select、poll、epoll详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/05/mongodb-aggregate-pipeline/">MongoDB之aggregate, pipeline及map_reduce</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/31/libuv-libev-epoll-select-2017-10-31/">libuv与libev,epoll与select</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/py-errors-2017-10-29/">python中的一些errors</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/18/py-psutil-2017-10-18/">Python之psutil模块使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/18/linux-note1-2017-10-18/">Linux笔记</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">Simple &amp; Freedom.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>