---
title: PyQt笔记一
date: 2017-04-14 14:17:42
tags: [Python,PyQt]
categories: 编程
---
### 1. 关于pyqt中翻译
pyqt的翻译文件有ts和qm文件
ts文件保存翻译的条目,qm文件是将ts文件编译成二进制文件.
最后使用的二进制的qm文件.

ts文件格式
```
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE TS>
<TS version="2.1" language="zh_CN">
<context>
    <name>MACRO</name>
    <message>
        <location filename="../common/APP_END" line="6"/>
        <source>Do you want to do machine lubration?</source>
        <translation>是否执行润滑?</translation>
    </message>
</context>
</TS>
```
其中file_name的相对路径是相对于ts文件的路径.

虽然最后程序加载使用的是qm文件,但是ts文件不能丢,
这是因为以后要是有翻译更新了,就要更新ts文件, 然后根据ts文件重新编译生成qm文件.

有了ts和qm文件,后要在程序中加载翻译qm文件
```
_macro_translator = QtCore.QTranslator()
_macro_translator.load(
    QtCore.QLocale(), "", "", os.path.join(basic.baseDir, "macro/translations"))
QtWidgets.qApp.installTranslator(_macro_translator)
```
只有加载了翻译文件,翻译才会器作用.


假如你要翻译的文件不是标准的py或者ui文件,而你又想将里面的内容添加翻译?
解决方案:自己生成ts文件,再编译生成qm文件,最后在程序中加载翻译文件就可以了.

如何生成ts文件?
分析ts文件格式,使用正则表达式匹配要翻译的源文本,然后通过xmltodict包将要翻译的内容写到ts文件中,然后打开pyqt的linguist工具翻译好对应的翻译.然后生成qm文件.

qm文件的生成可以通过linguist生成,也可以通过lrelease命令生成.