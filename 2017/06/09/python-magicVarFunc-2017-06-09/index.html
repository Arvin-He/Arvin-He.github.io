<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Learn and live."><title>Python之_magic变量和函数 | Simple &amp; Freedom</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Python之_magic变量和函数</h1><a id="logo" href="/.">Simple &amp; Freedom</a><p class="description">Learn and live.</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/404.html"><i class="fa fa-heartbeat"> 公益404</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Python之_magic变量和函数</h1><div class="post-meta">Jun 9, 2017<span> | </span><span class="category"><a href="/categories/编程/">编程</a></span></div><div class="post-content"><h3 id="关于下划线-的说明"><a href="#关于下划线-的说明" class="headerlink" title="关于下划线(_)的说明"></a>关于下划线(_)的说明</h3><ul>
<li>单下划线开头：弱内部使用标识，无法被from M import *所引用</li>
<li>单下划线结尾：避免和python关键字冲突，可以加个后置下划线,如exec_()</li>
<li>双下划线开头：类成员变量中的私有变量，</li>
<li>双下划线开头，双下划线结尾：这是magic对象或属性的名字，永远不要将这样的命名方式应用于自己的变量和函数</li>
</ul>
<h3 id="magic变量和magic函数"><a href="#magic变量和magic函数" class="headerlink" title="magic变量和magic函数"></a>magic变量和magic函数</h3><h4 id="1-name-变量"><a href="#1-name-变量" class="headerlink" title="1. __name__ 变量"></a>1. <code>__name__</code> 变量</h4><p>   <code>__name__</code>属性是直接内置在.py文件中的, 这个属性经常用来当做一个使用模式的标识.</p>
<pre><code>* 如果.py文件是在命令行运行的文件, 即被执行的文件，则`__name__`将被设置为`__main__`。
* 如果.py文件是被import，`__name__`将被设置为.py文件的名字
</code></pre><h4 id="2-file-变量"><a href="#2-file-变量" class="headerlink" title="2. __file__ 变量"></a>2. <code>__file__</code> 变量</h4><p><code>__file__</code>可以用来获取python脚本的“路径+脚本名称”，这可能是一个相对路径也可能是一个绝对路径，取决按照什么路径来执行的脚本，一般来说<code>__file__</code>变量和os.path配合，可以用来获取python脚本的绝对路径：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">5</span>]: <span class="keyword">import</span> os</div><div class="line">In [<span class="number">7</span>]: print(os.path.realpath(test1.__file__))</div><div class="line">C:\Users\aron\Desktop\test1.py</div></pre></td></tr></table></figure></p>
<h4 id="3-import-函数"><a href="#3-import-函数" class="headerlink" title="3. __import__ 函数"></a>3. <code>__import__</code> 函数</h4><p>python导入模块时，一般使用import，而import语句其实也是调用builtin函数,即<code>__import__()</code>函数实现的导入，直接使用<code>__import__</code>比较少见，除非导入的模块是不确定的，需要在运行时才能确定导入哪些模块，可以使用<code>__import__</code>，默认接收需要导入的模块名的字符串：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">9</span>]: model = __import__(<span class="string">'test'</span>)</div><div class="line">[<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">21</span>, <span class="number">34</span>, <span class="number">55</span>]</div><div class="line"></div><div class="line">In [<span class="number">11</span>]: model.Fib(<span class="number">5</span>)</div><div class="line">Out[<span class="number">11</span>]: &lt;test.Fib at <span class="number">0x49ea9b0</span>&gt;</div></pre></td></tr></table></figure></p>
<h4 id="4-str-函数"><a href="#4-str-函数" class="headerlink" title="4. __str__ 函数"></a>4. <code>__str__</code> 函数</h4><p><code>__str__</code>是一个比较常用的内置函数，在定义类的时候经常使用，<code>__str__</code>函数返回一个字符串，这个字符串就是此对象被print时显示的内容，如果不定义这个函数，将会显示默认的格式：<code>&lt;__main__.A object at 0x0000000001FB7C50&gt;</code>.这个函数在django的model类中如果定义的话，print一条数据库中的数据，可以指定显示任何的值.<br><strong>注意：</strong>在python3.x中<code>__str__</code>被废弃，使用<code>__repr__</code></p>
<h4 id="5-init-函数"><a href="#5-init-函数" class="headerlink" title="5. __init__ 函数"></a>5. <code>__init__</code> 函数</h4><p><code>__init__</code>比较常见，是对象的初始化函数</p>
<h4 id="6-new-函数"><a href="#6-new-函数" class="headerlink" title="6. __new__ 函数"></a>6. <code>__new__</code> 函数</h4><p><code>__new__()</code>函数是类创建对象时调用的内置函数，必须返回一个生成的对象，<br><code>__new__()</code>函数在<code>__init__()</code>函数之前执行。一般来说没有必要重载这个函数，除非需要更改new对象的流程,有一种场景“单例模式”要求只能存在一个class A的对象，如果重复创建，那么返回的已经创建过的对象的引用。可以这样使用<code>__new__</code>函数.<br>单例模式<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls)</span>:</span></div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="string">"_instance"</span> <span class="keyword">in</span> vars(cls):</div><div class="line">            cls._instance=super(A,cls).__new__(cls)</div><div class="line">        <span class="keyword">return</span> cls._instance</div><div class="line">a=A()</div><div class="line">b=A()</div><div class="line"><span class="keyword">print</span> id(a)==id(b)</div><div class="line">out&gt;&gt;<span class="keyword">True</span></div></pre></td></tr></table></figure></p>
<h4 id="7-class-变量"><a href="#7-class-变量" class="headerlink" title="7. __class__ 变量"></a>7. <code>__class__</code> 变量</h4><p><code>instance.__class__</code>表示这个对象的类对象，但在python中，类也是一个对象,例：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">12</span>]: <span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    ...:     <span class="keyword">pass</span></div><div class="line">    ...:</div><div class="line"></div><div class="line">In [<span class="number">13</span>]: a = A()</div><div class="line"></div><div class="line">In [<span class="number">14</span>]: B = a.__class__</div><div class="line"></div><div class="line">In [<span class="number">15</span>]: B</div><div class="line">Out[<span class="number">15</span>]: __main__.A</div><div class="line"></div><div class="line">In [<span class="number">16</span>]: b = B()</div><div class="line"></div><div class="line">In [<span class="number">17</span>]: print(type(b))</div><div class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">__main__</span>.<span class="title">A</span>'&gt;</span></div></pre></td></tr></table></figure></p>
<p>可以看出，a是A类的一个对象，<code>a.__class__</code>就是A类，将这个类赋值给B，使用B()又可以创建出一个对象b，这个对象b也是A类的对象，这个<code>__class__</code>有什么用呢？请看下面的例子</p>
<h4 id="8-add-函数"><a href="#8-add-函数" class="headerlink" title="8. __add__ 函数"></a>8. <code>__add__</code> 函数</h4><p>这里其实包含一系列函数，包括<code>__sub__</code>，<code>__mul__</code>，<code>__mod__</code>，<code>__pow__</code>，<code>__xor__</code>,<br>这些函数是对加、减、乘、除、乘方、异或、等运算的重载，重写这些函数, 则我们自定义的对象可以具备运算功能.<br>下面我们就自定义了一个加法操作1+2=1+2*2=5<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,v)</span>:</span></div><div class="line">        self.v=v</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add__</span><span class="params">(self,other)</span>:</span></div><div class="line">        <span class="comment">#创建创建一个新的对象</span></div><div class="line">        x=self.__class__(self.v + <span class="number">2</span>*other.v)</div><div class="line">        <span class="keyword">return</span> x</div><div class="line"></div><div class="line">a=A(<span class="number">1</span>)</div><div class="line">b=A(<span class="number">2</span>)</div><div class="line">c=a+b</div><div class="line"><span class="keyword">print</span> c.v</div><div class="line">ouot&gt;&gt;<span class="number">5</span></div></pre></td></tr></table></figure></p>
<h4 id="9-doc-文档字符串变量"><a href="#9-doc-文档字符串变量" class="headerlink" title="9. __doc__ 文档字符串变量"></a>9. <code>__doc__</code> 文档字符串变量</h4><p>python建议在定义一个类、模块、函数的时候定义一段说明文字，以便提取这些变量字符串,方便做成说明文档,例子如下：<br>调用别的模块、函数时如果不清楚使用方法，也可以直接查看doc文档字符串.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#c.py</span></div><div class="line"><span class="string">"""</span></div><div class="line"><span class="string">script c's doc</span></div><div class="line"><span class="string">"""</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    class A's doc</span></div><div class="line"><span class="string">    """</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">B</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    function B's doc</span></div><div class="line"><span class="string">    """</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="keyword">print</span> __doc__</div><div class="line"><span class="keyword">print</span> A.__doc__</div><div class="line"><span class="keyword">print</span> B.__doc__</div><div class="line">out&gt;&gt;script c<span class="string">'s doc</span></div><div class="line"><span class="string">out&gt;&gt;class A'</span>s doc</div><div class="line">out&gt;&gt;function B<span class="string">'s doc</span></div></pre></td></tr></table></figure></p>
<h4 id="10-iter-函数-和-next-函数"><a href="#10-iter-函数-和-next-函数" class="headerlink" title="10. __iter__ 函数 和 __next__ 函数"></a>10. <code>__iter__</code> 函数 和 <code>__next__</code> 函数</h4><p>凡是可以被<code>for...in</code>的循环调用的对象，我们称之为可以被迭代的对象，list，str，tuple都可以被迭代，它们都实现了内部的迭代器函数，比如说list，tuple，字符串这些数据结构的迭代器如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">a=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</div><div class="line">b=(<span class="string">'i'</span>,<span class="number">1</span>,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</div><div class="line"><span class="keyword">print</span> a.__iter__()</div><div class="line"><span class="keyword">print</span> b.__iter__()</div><div class="line">out&gt;&gt;&lt;listiterator object at <span class="number">0x0000000001CC7C50</span>&gt;</div><div class="line">out&gt;&gt;&lt;tupleiterator object at <span class="number">0x0000000001CC7B00</span>&gt;</div></pre></td></tr></table></figure></p>
<p>如果我们要实现一个我们自己的迭代器对象，那么我们必须实现两个默认的方法:<code>__iter__</code>和<code>__next__</code>。<br><code>__iter__()</code>函数将会返回一个迭代器对象，<code>__next__()</code>函数每次被调用都返回一个值，如果迭代完毕，则raise一个StopIteration的错误，用来终止迭代。<br>下面的例子将实现一个可以迭代的对象，输出a~z的26个字母，该对象接收一个int参数用来表示输出字母的数量，如果该参数超过字母表的长度，则循环从‘a-z’再次进行循环输出：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,n)</span>:</span></div><div class="line">        self.stop=n</div><div class="line">        self.value=<span class="number">0</span></div><div class="line">        <span class="comment">#字母列表</span></div><div class="line">        self.alph=[chr(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">97</span>,<span class="number">123</span>)]</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="comment">#如果超过长度超过26则重置</span></div><div class="line">        <span class="keyword">if</span> self.value==len(self.alph):</div><div class="line">            self.value=<span class="number">0</span></div><div class="line">            self.stop=self.stop-len(self.alph)</div><div class="line">        <span class="comment">#最终，已完成n个字符的输出，则结束迭代</span></div><div class="line">        <span class="keyword">if</span> self.value&gt;self.stop:</div><div class="line">            <span class="keyword">raise</span> StopIteration    </div><div class="line">        x=self.alph[self.value]</div><div class="line">        self.value+=<span class="number">1</span></div><div class="line">        <span class="keyword">return</span> x</div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> A(<span class="number">1000</span>):</div><div class="line">    <span class="keyword">print</span> i,</div><div class="line">out&gt;&gt;a b c d e f g h i j k l m n o p q r s t u v w x y z a b c d e f</div><div class="line"> g h i j k l m n o p q r s t u v w x y z a b c d e f g h i j k .....</div></pre></td></tr></table></figure></p>
<p><strong>注意:</strong> <code>__next__</code>是python3中的, python2的是next()</p>
<h4 id="11-dict-变量-slot-变量-和-all-变量"><a href="#11-dict-变量-slot-变量-和-all-变量" class="headerlink" title="11. __dict__ 变量, __slot__ 变量 和 __all__ 变量"></a>11. <code>__dict__</code> 变量, <code>__slot__</code> 变量 和 <code>__all__</code> 变量</h4><p>这三个变量有一些关系，<code>__dict__</code>在类和对象中都存在，它是一个包含变量名和变量的字典，见以下的例子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#a.py</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    c=<span class="number">3</span></div><div class="line">    d=<span class="number">4</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.a=<span class="number">1</span></div><div class="line">        self.b=<span class="number">2</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="keyword">print</span> A().__dict__</div><div class="line"><span class="keyword">print</span> A.__dict__</div><div class="line"></div><div class="line">out&gt;&gt;&#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</div><div class="line">out&gt;&gt;&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'d'</span>: <span class="number">4</span>, <span class="string">'c'</span>: <span class="number">3</span>, <span class="string">'func'</span>: &lt;function func at <span class="number">0x00000000021F2BA8</span>&gt;, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'A'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'A'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="keyword">None</span>, <span class="string">'__init__'</span>: &lt;function __init__ at <span class="number">0x00000000021F2AC8</span>&gt;&#125;</div></pre></td></tr></table></figure></p>
<p>一个对象的<code>__dict__</code>只包含self定义的变量，<br>一个类的<code>__dict__</code>包含了类里面的函数（func函数）、类变量，以及很多隐性的变量，包括<code>__dict__</code>变量本身也是隐性的。</p>
<p><code>__slot__</code>变量的用法理解起来比较要难一点，正常的情况下，我们实例化一个对象，可以给这个对象增加任意的成员变量，即使不在类里面定义的变量都可以.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#a.py</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.a=<span class="number">1</span></div><div class="line">        self.b=<span class="number">2</span></div><div class="line"></div><div class="line">a=A()</div><div class="line"><span class="comment">#给a增加一个x变量</span></div><div class="line">a.x=<span class="number">1</span></div><div class="line"><span class="comment">#也可以给a增加一个匿名函数</span></div><div class="line">a.y=<span class="keyword">lambda</span> x,y:x*y</div><div class="line"><span class="keyword">print</span> a.x</div><div class="line"><span class="keyword">print</span> a.y(<span class="number">3</span>,<span class="number">5</span>)</div><div class="line">out&gt;&gt;<span class="number">1</span></div><div class="line">out&gt;&gt;<span class="number">15</span></div></pre></td></tr></table></figure></p>
<p>但如果我们想限制一下对象绑定的变量，我们可以在类定义的时候增加一个slots变量，这个变量是一个<strong>字符串元组</strong>，例子如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    __slots__=(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'x'</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.a=<span class="number">1</span></div><div class="line">        self.b=<span class="number">2</span></div><div class="line"></div><div class="line">    <span class="comment">#__slots__=('a','b',)</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line">a=A()</div><div class="line">a.x=<span class="number">1</span></div><div class="line"><span class="comment">#执行到a.y时会报错：AttributeError: 'A' object has no attribute 'y'</span></div><div class="line">a.y=<span class="keyword">lambda</span> x,y:x*y</div><div class="line"><span class="keyword">print</span> a.y(<span class="number">3</span>,<span class="number">5</span>)</div></pre></td></tr></table></figure></p>
<p><code>__all__</code>变量是一个字符串列表，<br>它定义了每一个模块会被<code>from module_name import *</code>这样的语句可以被import的内容（变量，类，函数）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#a.py 不定义__all__</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.a=<span class="number">1</span></div><div class="line">        self.b=<span class="number">2</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">B</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"></div><div class="line">c=<span class="number">10</span></div><div class="line"></div><div class="line"><span class="comment">#b.py</span></div><div class="line"><span class="keyword">from</span> a <span class="keyword">import</span> *</div><div class="line"><span class="keyword">print</span> A</div><div class="line"><span class="keyword">print</span> B</div><div class="line"><span class="keyword">print</span> c</div><div class="line">out&gt;&gt;&lt;<span class="class"><span class="keyword">class</span> '<span class="title">learn_draft</span>.<span class="title">A</span>'&gt;</span></div><div class="line"><span class="class"><span class="title">out</span>&gt;&gt;&lt;<span class="title">function</span> <span class="title">B</span> <span class="title">at</span> 0<span class="title">x00000000021D1438</span>&gt;</span></div><div class="line"><span class="class"><span class="title">out</span>&gt;&gt;10</span></div></pre></td></tr></table></figure></p>
<p>如果在a.py中定义<code>__all__=[&#39;A&#39;,&#39;c&#39;]</code>,则B函数对于b.py来说是不可见的</p>
<h4 id="12-hash-函数"><a href="#12-hash-函数" class="headerlink" title="12. __hash__ 函数"></a>12. <code>__hash__</code> 函数</h4><p>哈希函数，在python中的对象有一个hashable（可哈希）的概念.<br>对于数字、字符串、元组来说，是不可变的，也就是可哈希的，因此这些对象也可以作为字典的key值。<br>对于列表、字典等，是可变对象，因此是不可哈希的，也就不能作为字典的key值。<br>是否可哈希，可以调用内置函数<code>hash()</code>进行计算，<code>hash()</code>函数返回计算的到的hash值。<br>完全相同的变量，调用哈希算法的到的hash值一定是相同的</p>
<p>当然一般来说，我们不会去重新定义一个对象的<code>__hash__</code>函数，除非我们想实现一个自定义的需求，<br>在stackoverflow有人提出这样一个需求，需要判断有相同词频的字符串是相等的，也就是说“abb”和“bab”这样的字符串是相等的，这个时候我们可以继承字符串类，然后重写哈希函数，如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> collections</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrequencyString</span><span class="params">(str)</span>:</span></div><div class="line"><span class="meta">    @property</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">normalized</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">return</span> self._normalized</div><div class="line">        <span class="keyword">except</span> AttributeError:</div><div class="line">            self._normalized = normalized = <span class="string">''</span>.join(sorted(collections.Counter(self).elements()))</div><div class="line">            <span class="keyword">return</span> normalized</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.normalized == other.normalized</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> hash(self.normalized)</div></pre></td></tr></table></figure></p>
<h4 id="13-getattr-函数和-setattr-函数，-delattr-函数"><a href="#13-getattr-函数和-setattr-函数，-delattr-函数" class="headerlink" title="13. __getattr__ 函数和__setattr__ 函数，__delattr__ 函数"></a>13. <code>__getattr__</code> 函数和<code>__setattr__</code> 函数，<code>__delattr__</code> 函数</h4><p>先介绍两个内置函数，<code>getattr()</code>和<code>setattr()</code>,使用这两个函数可以获取对象的属性，或者给对象的属性赋值：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#a.py</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.a=<span class="number">1</span></div><div class="line">        self.b=<span class="number">2</span></div><div class="line">a=A()</div><div class="line">setattr(a,<span class="string">'a'</span>,<span class="number">3</span>)</div><div class="line"><span class="keyword">print</span> a.a</div><div class="line"><span class="keyword">print</span> getattr(a,<span class="string">'b'</span>)</div><div class="line">out&gt;&gt;<span class="number">3</span></div><div class="line">out&gt;&gt;<span class="number">2</span></div></pre></td></tr></table></figure></p>
<p>其实使用这两个函数和直接访问<code>a.a</code>, <code>a.b</code>没有任何区别，但好处是setattr和getattr接受两个字符串去确定访问对象a的哪一个属性，和<code>__import__</code>一样，可以在运行时在决定去访问对象变量的名字，在实际工作中经常会使用这两个函数。</p>
<p><code>__getattr__()</code>这个函数是在访问对象不存在的成员变量是才会访问的，见下面的例子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.a=<span class="number">1</span></div><div class="line">        self.b=<span class="number">2</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self,name)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">'getattr'</span></div><div class="line">        <span class="keyword">return</span> self.a</div><div class="line"></div><div class="line">a=A()</div><div class="line"><span class="keyword">print</span> a.d</div><div class="line">out&gt;&gt;getattr</div><div class="line">out&gt;&gt;<span class="number">1</span></div></pre></td></tr></table></figure></p>
<p>在调用a.d时，d不是a的成员变量，则python会去查找对象是否存在<code>__getattr__()</code>函数，如果存在，则返回<code>__getattr__()</code>函数的返回值，我们这里返回的是self.a的值1。</p>
<p>由于<code>__getattr__()</code>的特性，我们可以将<code>__getattr__()</code>设计成一个公共的接口函数，在autotest的<code>proxy.py</code>中就看到了这样的用法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServiceProxy</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, serviceURL, serviceName=None, headers=None)</span>:</span></div><div class="line">    self.__serviceURL = serviceURL</div><div class="line">    self.__serviceName = serviceName</div><div class="line">    self.__headers = headers <span class="keyword">or</span> &#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, name)</span>:</span></div><div class="line">    <span class="keyword">if</span> self.__serviceName <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">        name = <span class="string">"%s.%s"</span> % (self.__serviceName, name)</div><div class="line">    <span class="keyword">return</span> ServiceProxy(self.__serviceURL, name, self.__headers)</div><div class="line"></div><div class="line"><span class="comment">#调用的时候，op是执行的特定操作的字符串，op传入__getattr__将会把ServiceProxy对象重新的内部变量重新赋值，然后返回一个更新之后的对象</span></div><div class="line">function = getattr(self.proxy, op)</div></pre></td></tr></table></figure></p>
<p><code>__setattr__</code>和<code>__getattr__</code>不一样，对象的所有属性赋值，都会经过<code>__setattr__()</code>函数，看下面的例子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.a=<span class="number">1</span></div><div class="line">        self.b=<span class="number">2</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self,name)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">'getattr'</span></div><div class="line">        <span class="keyword">return</span> self.a</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, name, value)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">'setattr %s'</span> % name</div><div class="line">        <span class="keyword">if</span> name == <span class="string">'f'</span>:</div><div class="line">            <span class="keyword">return</span> object.__setattr__(self,name,value+<span class="number">1000</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">return</span> object.__setattr__(self,  name, value)</div><div class="line"></div><div class="line">a=A()</div><div class="line">a.f=<span class="number">1000</span></div><div class="line"><span class="keyword">print</span> a.f</div><div class="line">out&gt;&gt;setattr a</div><div class="line">out&gt;&gt;setattr b</div><div class="line">out&gt;&gt;setattr f</div><div class="line">out&gt;&gt;<span class="number">2000</span></div></pre></td></tr></table></figure></p>
<p>从输出可以看到init函数的self.a和self.b的赋值也经过了<code>__setattr__</code>，而且在赋值的时候我们自定义了一个if逻辑，如果name是‘f’，那么value会增加1000，最终的a.f是2000</p>
<p><code>__delattr__</code>是删除一个对象属性用的。</p>
<h4 id="14-call-函数"><a href="#14-call-函数" class="headerlink" title="14. __call__ 函数"></a>14. <code>__call__</code> 函数</h4><p>如果一个对象实现了<code>__call__()</code>函数，那么这个对象可以认为是一个函数对象，使用加括号的方法就可以调用，见下面例子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.li=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>]</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self,n)</span>:</span></div><div class="line">        <span class="comment">#返回li列表的第n个元素</span></div><div class="line">        <span class="keyword">return</span> self.li[n]</div><div class="line"></div><div class="line">a=A()</div><div class="line"><span class="comment">#a可以当做函数一样调用</span></div><div class="line"><span class="keyword">print</span> a(<span class="number">0</span>),a(<span class="number">1</span>),a(<span class="number">2</span>)</div><div class="line">out&gt;&gt;a b c</div></pre></td></tr></table></figure></p>
<p>在实际工作中<code>__call__</code>函数非常有用，可以把一个对象变成callable的对象.</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://www.jianshu.com/p/1112320c5784" target="_blank" rel="external">http://www.jianshu.com/p/1112320c5784</a></li>
</ul>
</div><div class="tags"><a href="/tags/Python/">Python</a></div><div class="post-nav"><a href="/2017/06/12/python-thread-2017-06-12/" class="pre">Python之线程</a><a href="/2017/06/08/python-pandas-2017-06-08/" class="next">Python之Pandas入门</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/思想/">思想</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/计算机基础/" style="font-size: 15px;">计算机基础</a> <a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/谷歌/" style="font-size: 15px;">谷歌</a> <a href="/tags/OOP/" style="font-size: 15px;">OOP</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/Flask/" style="font-size: 15px;">Flask</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/HTML/" style="font-size: 15px;">HTML</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/方法/" style="font-size: 15px;">方法</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/NodeJS/" style="font-size: 15px;">NodeJS</a> <a href="/tags/NSIS/" style="font-size: 15px;">NSIS</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/PyQt5/" style="font-size: 15px;">PyQt5</a> <a href="/tags/Scrapy/" style="font-size: 15px;">Scrapy</a> <a href="/tags/RegExp/" style="font-size: 15px;">RegExp</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/SVN/" style="font-size: 15px;">SVN</a> <a href="/tags/tornado/" style="font-size: 15px;">tornado</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/12/04/js-notes2-2017-12-04/">javascript笔记(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/28/proxy-2017-11-28/">proxy一些知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/25/redis-note1-2017-11-25/">redis笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/16/tornado-note2-2017-11-16/">tornado学习笔记(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/16/howtoreadsource-2017-11-16/">如何去阅读源码</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/16/tornado-note1-2017-11-16/">tornado学习笔记(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/06/someconcept-2017-11-06/">Linux IO模式及 select、poll、epoll详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/05/mongodb-aggregate-pipeline/">MongoDB之aggregate, pipeline及map_reduce</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/31/libuv-libev-epoll-select-2017-10-31/">libuv与libev,epoll与select</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/py-errors-2017-10-29/">python中的一些errors</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">Simple &amp; Freedom.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>