<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Simple & Freedom" type="application/atom+xml" />






<meta name="description" content="Learn and live.">
<meta property="og:type" content="website">
<meta property="og:title" content="Simple &amp; Freedom">
<meta property="og:url" content="http://arvin-he.github.io/page/16/index.html">
<meta property="og:site_name" content="Simple &amp; Freedom">
<meta property="og:description" content="Learn and live.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Simple &amp; Freedom">
<meta name="twitter:description" content="Learn and live.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://arvin-he.github.io/page/16/"/>





  <title>Simple & Freedom</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Simple & Freedom</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Learn and live.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://arvin-he.github.io/2017/06/08/python-pandas-2017-06-08/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arvin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple & Freedom">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/08/python-pandas-2017-06-08/" itemprop="url">Python之Pandas入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-08T14:41:30+08:00">
                2017-06-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这是一个简短的为新手入门的pandas教程,更高级的用法请查看<a href="http://pandas.pydata.org/pandas-docs/stable/cookbook.html#cookbook" target="_blank" rel="external">ccokbook</a><br>这里安装numpy, mayplotlit 和 pandas省略.首先导入如下包<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"></div><div class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">In [<span class="number">3</span>]: <span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div></pre></td></tr></table></figure></p>
<h3 id="对象创建"><a href="#对象创建" class="headerlink" title="对象创建"></a>对象创建</h3><p>传递一个list来创建一个 Series 对象, pandas会自动创建索引<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">4</span>]: s = pd.Series([<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,np.nan, <span class="number">6</span>, <span class="number">8</span>])</div><div class="line"></div><div class="line">In [<span class="number">5</span>]: s</div><div class="line">Out[<span class="number">5</span>]:</div><div class="line"><span class="number">0</span>    <span class="number">1.0</span></div><div class="line"><span class="number">1</span>    <span class="number">3.0</span></div><div class="line"><span class="number">2</span>    <span class="number">5.0</span></div><div class="line"><span class="number">3</span>    NaN</div><div class="line"><span class="number">4</span>    <span class="number">6.0</span></div><div class="line"><span class="number">5</span>    <span class="number">8.0</span></div><div class="line">dtype: float64</div></pre></td></tr></table></figure></p>
<p>传递一个numpy的array创建一个DataFrame对象, 同时以datetime为索引和带label的列<br>DataFrame 是有多个列的数据表，每个列拥有一个 label，当然，DataFrame 也有索引<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 创建datetime索引</span></div><div class="line">In [<span class="number">6</span>]: dates = pd.date_range(<span class="string">'20170608'</span>, periods=<span class="number">6</span>)</div><div class="line"></div><div class="line">In [<span class="number">7</span>]: dates</div><div class="line">Out[<span class="number">7</span>]:</div><div class="line">DatetimeIndex([<span class="string">'2017-06-08'</span>, <span class="string">'2017-06-09'</span>, <span class="string">'2017-06-10'</span>, <span class="string">'2017-06-11'</span>,</div><div class="line">               <span class="string">'2017-06-12'</span>, <span class="string">'2017-06-13'</span>],</div><div class="line">              dtype=<span class="string">'datetime64[ns]'</span>, freq=<span class="string">'D'</span>)</div><div class="line"></div><div class="line">In [<span class="number">8</span>]: df = pd.DataFrame(np.random.randn(<span class="number">6</span>,<span class="number">4</span>), index=dates, columns=list(<span class="string">'ABCD'</span>))</div><div class="line"></div><div class="line">In [<span class="number">9</span>]: df</div><div class="line">Out[<span class="number">9</span>]:</div><div class="line">                   A         B         C         D</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span> <span class="number">-0.561773</span>  <span class="number">0.881191</span> <span class="number">-2.697783</span> <span class="number">-0.034672</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.053409</span>  <span class="number">0.814811</span>  <span class="number">0.294231</span> <span class="number">-1.753744</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.699722</span>  <span class="number">0.971518</span> <span class="number">-2.592852</span>  <span class="number">1.088473</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.411028</span>  <span class="number">0.312229</span> <span class="number">-1.879164</span>  <span class="number">1.388484</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-0.173929</span> <span class="number">-0.572149</span>  <span class="number">2.044024</span> <span class="number">-0.101223</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span> <span class="number">-0.906777</span> <span class="number">-0.207889</span> <span class="number">-0.776134</span>  <span class="number">2.327599</span></div></pre></td></tr></table></figure></p>
<p>传递一个dict来创建一个DataFrame, 每个 dict 的 value 会被转化成一个 Series,<br>可以认为，DataFrame 是由多个 Series 组成的<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">10</span>]: df2 = pd.DataFrame(&#123;</div><div class="line">    ...: <span class="string">'A'</span>: <span class="number">1.</span>,</div><div class="line">    ...: <span class="string">'B'</span>: pd.Timestamp(<span class="string">'20170608'</span>),</div><div class="line">    ...: <span class="string">'C'</span>: pd.Series(<span class="number">1</span>, index=list(range(<span class="number">4</span>)), dtype=<span class="string">'float32'</span>),</div><div class="line">    ...: <span class="string">'D'</span>: np.array([<span class="number">3</span>]*<span class="number">4</span>, dtype=<span class="string">'int32'</span>),</div><div class="line">    ...: <span class="string">'E'</span>: pd.Categorical([<span class="string">'test'</span>, <span class="string">'train'</span>, <span class="string">'test'</span>, <span class="string">'train'</span>]),</div><div class="line">    ...: <span class="string">'F'</span>: <span class="string">'foo'</span>&#125;)</div><div class="line"></div><div class="line">In [<span class="number">11</span>]: df2</div><div class="line">Out[<span class="number">11</span>]:</div><div class="line">     A          B    C  D      E    F</div><div class="line"><span class="number">0</span>  <span class="number">1.0</span> <span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>  <span class="number">1.0</span>  <span class="number">3</span>   test  foo</div><div class="line"><span class="number">1</span>  <span class="number">1.0</span> <span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>  <span class="number">1.0</span>  <span class="number">3</span>  train  foo</div><div class="line"><span class="number">2</span>  <span class="number">1.0</span> <span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>  <span class="number">1.0</span>  <span class="number">3</span>   test  foo</div><div class="line"><span class="number">3</span>  <span class="number">1.0</span> <span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>  <span class="number">1.0</span>  <span class="number">3</span>  train  foo</div></pre></td></tr></table></figure></p>
<p>每列数据的格式用 dtypes 查看<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">12</span>]: df2.dtypes</div><div class="line">Out[<span class="number">12</span>]:</div><div class="line">A           float64</div><div class="line">B    datetime64[ns]</div><div class="line">C           float32</div><div class="line">D             int32</div><div class="line">E          category</div><div class="line">F            object</div><div class="line">dtype: object</div></pre></td></tr></table></figure></p>
<h3 id="数据查看"><a href="#数据查看" class="headerlink" title="数据查看"></a>数据查看</h3><p>查看指定列的数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">15</span>]: df2.A</div><div class="line">Out[<span class="number">15</span>]:</div><div class="line"><span class="number">0</span>    <span class="number">1.0</span></div><div class="line"><span class="number">1</span>    <span class="number">1.0</span></div><div class="line"><span class="number">2</span>    <span class="number">1.0</span></div><div class="line"><span class="number">3</span>    <span class="number">1.0</span></div><div class="line">Name: A, dtype: float64</div></pre></td></tr></table></figure></p>
<p>用 head 和 tail 查看顶端和底端的几列, <code>head()</code>和<code>tail()</code>函数默认值都是5<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">16</span>]: df.head()                                 </div><div class="line">Out[<span class="number">16</span>]:                                           </div><div class="line">                   A         B         C         D </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span> <span class="number">-0.561773</span>  <span class="number">0.881191</span> <span class="number">-2.697783</span> <span class="number">-0.034672</span> </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.053409</span>  <span class="number">0.814811</span>  <span class="number">0.294231</span> <span class="number">-1.753744</span> </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.699722</span>  <span class="number">0.971518</span> <span class="number">-2.592852</span>  <span class="number">1.088473</span> </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.411028</span>  <span class="number">0.312229</span> <span class="number">-1.879164</span>  <span class="number">1.388484</span> </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-0.173929</span> <span class="number">-0.572149</span>  <span class="number">2.044024</span> <span class="number">-0.101223</span> </div><div class="line">                                                   </div><div class="line">In [<span class="number">17</span>]: df.tail(<span class="number">3</span>)                                </div><div class="line">Out[<span class="number">17</span>]:                                           </div><div class="line">                   A         B         C         D </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.411028</span>  <span class="number">0.312229</span> <span class="number">-1.879164</span>  <span class="number">1.388484</span> </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-0.173929</span> <span class="number">-0.572149</span>  <span class="number">2.044024</span> <span class="number">-0.101223</span> </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span> <span class="number">-0.906777</span> <span class="number">-0.207889</span> <span class="number">-0.776134</span>  <span class="number">2.327599</span> </div><div class="line">                                                   </div><div class="line">In [<span class="number">18</span>]: df.head(<span class="number">2</span>)                                </div><div class="line">Out[<span class="number">18</span>]:                                           </div><div class="line">                   A         B         C         D </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span> <span class="number">-0.561773</span>  <span class="number">0.881191</span> <span class="number">-2.697783</span> <span class="number">-0.034672</span> </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.053409</span>  <span class="number">0.814811</span>  <span class="number">0.294231</span> <span class="number">-1.753744</span> </div><div class="line">                                                   </div><div class="line">In [<span class="number">19</span>]: df.tail()                                 </div><div class="line">Out[<span class="number">19</span>]:                                           </div><div class="line">                   A         B         C         D </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.053409</span>  <span class="number">0.814811</span>  <span class="number">0.294231</span> <span class="number">-1.753744</span> </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.699722</span>  <span class="number">0.971518</span> <span class="number">-2.592852</span>  <span class="number">1.088473</span> </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.411028</span>  <span class="number">0.312229</span> <span class="number">-1.879164</span>  <span class="number">1.388484</span> </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-0.173929</span> <span class="number">-0.572149</span>  <span class="number">2.044024</span> <span class="number">-0.101223</span> </div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span> <span class="number">-0.906777</span> <span class="number">-0.207889</span> <span class="number">-0.776134</span>  <span class="number">2.327599</span></div></pre></td></tr></table></figure></p>
<p>单独查看 index 和 columns 和 数据, DataFrame 内部用 numpy 格式存储数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">20</span>]: df.index</div><div class="line">Out[<span class="number">20</span>]:</div><div class="line">DatetimeIndex([<span class="string">'2017-06-08'</span>, <span class="string">'2017-06-09'</span>, <span class="string">'2017-06-10'</span>, <span class="string">'2017-06-11'</span>,</div><div class="line">               <span class="string">'2017-06-12'</span>, <span class="string">'2017-06-13'</span>],</div><div class="line">              dtype=<span class="string">'datetime64[ns]'</span>, freq=<span class="string">'D'</span>)</div><div class="line"></div><div class="line">In [<span class="number">21</span>]: df.columns</div><div class="line">Out[<span class="number">21</span>]: Index([<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>], dtype=<span class="string">'object'</span>)</div><div class="line"></div><div class="line">In [<span class="number">22</span>]: df.values</div><div class="line">Out[<span class="number">22</span>]:</div><div class="line">array([[<span class="number">-0.56177253</span>,  <span class="number">0.88119144</span>, <span class="number">-2.6977834</span> , <span class="number">-0.03467225</span>],</div><div class="line">       [<span class="number">-0.05340873</span>,  <span class="number">0.81481114</span>,  <span class="number">0.29423114</span>, <span class="number">-1.75374372</span>],</div><div class="line">       [<span class="number">-1.69972161</span>,  <span class="number">0.97151768</span>, <span class="number">-2.59285248</span>,  <span class="number">1.08847275</span>],</div><div class="line">       [<span class="number">-2.41102846</span>,  <span class="number">0.3122287</span> , <span class="number">-1.87916396</span>,  <span class="number">1.38848363</span>],</div><div class="line">       [<span class="number">-0.17392908</span>, <span class="number">-0.57214913</span>,  <span class="number">2.04402398</span>, <span class="number">-0.10122313</span>],</div><div class="line">       [<span class="number">-0.90677665</span>, <span class="number">-0.20788934</span>, <span class="number">-0.77613381</span>,  <span class="number">2.32759919</span>]])</div></pre></td></tr></table></figure></p>
<p>describe() 显示数据的概要。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">23</span>]: df.describe()</div><div class="line">Out[<span class="number">23</span>]:</div><div class="line">              A         B         C         D</div><div class="line">count  <span class="number">6.000000</span>  <span class="number">6.000000</span>  <span class="number">6.000000</span>  <span class="number">6.000000</span></div><div class="line">mean  <span class="number">-0.967773</span>  <span class="number">0.366618</span> <span class="number">-0.934613</span>  <span class="number">0.485819</span></div><div class="line">std    <span class="number">0.922339</span>  <span class="number">0.639667</span>  <span class="number">1.852466</span>  <span class="number">1.428378</span></div><div class="line">min   <span class="number">-2.411028</span> <span class="number">-0.572149</span> <span class="number">-2.697783</span> <span class="number">-1.753744</span></div><div class="line"><span class="number">25</span>%   <span class="number">-1.501485</span> <span class="number">-0.077860</span> <span class="number">-2.414430</span> <span class="number">-0.084585</span></div><div class="line"><span class="number">50</span>%   <span class="number">-0.734275</span>  <span class="number">0.563520</span> <span class="number">-1.327649</span>  <span class="number">0.526900</span></div><div class="line"><span class="number">75</span>%   <span class="number">-0.270890</span>  <span class="number">0.864596</span>  <span class="number">0.026640</span>  <span class="number">1.313481</span></div><div class="line">max   <span class="number">-0.053409</span>  <span class="number">0.971518</span>  <span class="number">2.044024</span>  <span class="number">2.327599</span></div></pre></td></tr></table></figure></p>
<p>和 numpy 一样，可以方便的得到转置,就是行列转换<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">24</span>]: df.T</div><div class="line">Out[<span class="number">24</span>]:</div><div class="line">   <span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>  <span class="number">2017</span><span class="number">-06</span><span class="number">-09</span>  <span class="number">2017</span><span class="number">-06</span><span class="number">-10</span>  <span class="number">2017</span><span class="number">-06</span><span class="number">-11</span>  <span class="number">2017</span><span class="number">-06</span><span class="number">-12</span>  <span class="number">2017</span><span class="number">-06</span><span class="number">-13</span></div><div class="line">A   <span class="number">-0.561773</span>   <span class="number">-0.053409</span>   <span class="number">-1.699722</span>   <span class="number">-2.411028</span>   <span class="number">-0.173929</span>   <span class="number">-0.906777</span></div><div class="line">B    <span class="number">0.881191</span>    <span class="number">0.814811</span>    <span class="number">0.971518</span>    <span class="number">0.312229</span>   <span class="number">-0.572149</span>   <span class="number">-0.207889</span></div><div class="line">C   <span class="number">-2.697783</span>    <span class="number">0.294231</span>   <span class="number">-2.592852</span>   <span class="number">-1.879164</span>    <span class="number">2.044024</span>   <span class="number">-0.776134</span></div><div class="line">D   <span class="number">-0.034672</span>   <span class="number">-1.753744</span>    <span class="number">1.088473</span>    <span class="number">1.388484</span>   <span class="number">-0.101223</span>    <span class="number">2.327599</span></div></pre></td></tr></table></figure></p>
<p>对 axis 按照 index 排序（axis=1 是指根据列名来排序, axis=0 是根据行名来排序）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">26</span>]: df.sort_index(axis=<span class="number">1</span>, ascending=<span class="keyword">False</span>)</div><div class="line">Out[<span class="number">26</span>]:</div><div class="line">                   D         C         B         A</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span> <span class="number">-0.034672</span> <span class="number">-2.697783</span>  <span class="number">0.881191</span> <span class="number">-0.561773</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-1.753744</span>  <span class="number">0.294231</span>  <span class="number">0.814811</span> <span class="number">-0.053409</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span>  <span class="number">1.088473</span> <span class="number">-2.592852</span>  <span class="number">0.971518</span> <span class="number">-1.699722</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span>  <span class="number">1.388484</span> <span class="number">-1.879164</span>  <span class="number">0.312229</span> <span class="number">-2.411028</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-0.101223</span>  <span class="number">2.044024</span> <span class="number">-0.572149</span> <span class="number">-0.173929</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span>  <span class="number">2.327599</span> <span class="number">-0.776134</span> <span class="number">-0.207889</span> <span class="number">-0.906777</span></div></pre></td></tr></table></figure></p>
<p>按值排序<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">30</span>]: df.sort_values(by=<span class="string">'B'</span>)</div><div class="line">Out[<span class="number">30</span>]:</div><div class="line">                   A         B         C         D</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-0.173929</span> <span class="number">-0.572149</span>  <span class="number">2.044024</span> <span class="number">-0.101223</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span> <span class="number">-0.906777</span> <span class="number">-0.207889</span> <span class="number">-0.776134</span>  <span class="number">2.327599</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.411028</span>  <span class="number">0.312229</span> <span class="number">-1.879164</span>  <span class="number">1.388484</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.053409</span>  <span class="number">0.814811</span>  <span class="number">0.294231</span> <span class="number">-1.753744</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span> <span class="number">-0.561773</span>  <span class="number">0.881191</span> <span class="number">-2.697783</span> <span class="number">-0.034672</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.699722</span>  <span class="number">0.971518</span> <span class="number">-2.592852</span>  <span class="number">1.088473</span></div></pre></td></tr></table></figure></p>
<h3 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h3><p><strong>注意:</strong> 以下这些对交互式环境很友好，但是作为 production code 请用优化过的 <code>.at, .iat, .loc, .iloc, .ix</code>等.</p>
<p>获取行/列<br>从 DataFrame 选择一个列，就得到了 Series<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">31</span>]: df[<span class="string">'A'</span>]</div><div class="line">Out[<span class="number">31</span>]:</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>   <span class="number">-0.561773</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span>   <span class="number">-0.053409</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span>   <span class="number">-1.699722</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span>   <span class="number">-2.411028</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span>   <span class="number">-0.173929</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span>   <span class="number">-0.906777</span></div><div class="line">Freq: D, Name: A, dtype: float64</div></pre></td></tr></table></figure></p>
<p>使用[] 对行切片<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">35</span>]: df[<span class="number">0</span>:<span class="number">3</span>]</div><div class="line">Out[<span class="number">35</span>]:</div><div class="line">                   A         B         C         D</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span> <span class="number">-0.561773</span>  <span class="number">0.881191</span> <span class="number">-2.697783</span> <span class="number">-0.034672</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.053409</span>  <span class="number">0.814811</span>  <span class="number">0.294231</span> <span class="number">-1.753744</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.699722</span>  <span class="number">0.971518</span> <span class="number">-2.592852</span>  <span class="number">1.088473</span></div></pre></td></tr></table></figure></p>
<p>通过标签选择<br>通过时间戳的下标（dates[0] = Timestamp(‘20130101’)）来访问<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">36</span>]: df.loc[dates[<span class="number">1</span>]]</div><div class="line">Out[<span class="number">36</span>]:</div><div class="line">A   <span class="number">-0.053409</span></div><div class="line">B    <span class="number">0.814811</span></div><div class="line">C    <span class="number">0.294231</span></div><div class="line">D   <span class="number">-1.753744</span></div><div class="line">Name: <span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>, dtype: float64</div></pre></td></tr></table></figure></p>
<p>选择多个标签<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">38</span>]: df.loc[:,[<span class="string">'A'</span>, <span class="string">'B'</span>]]</div><div class="line">Out[<span class="number">38</span>]:</div><div class="line">                   A         B</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span> <span class="number">-0.561773</span>  <span class="number">0.881191</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.053409</span>  <span class="number">0.814811</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.699722</span>  <span class="number">0.971518</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.411028</span>  <span class="number">0.312229</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-0.173929</span> <span class="number">-0.572149</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span> <span class="number">-0.906777</span> <span class="number">-0.207889</span></div></pre></td></tr></table></figure></p>
<p>注意那个冒号，用法和 MATLAB 或 NumPy 是一样的！所以也可以这样<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">39</span>]: df.loc[dates[<span class="number">0</span>]:dates[<span class="number">2</span>], [<span class="string">'A'</span>, <span class="string">'B'</span>]]</div><div class="line">Out[<span class="number">39</span>]:</div><div class="line">                   A         B</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span> <span class="number">-0.561773</span>  <span class="number">0.881191</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.053409</span>  <span class="number">0.814811</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.699722</span>  <span class="number">0.971518</span></div></pre></td></tr></table></figure></p>
<p>依旧和 MATLAB 一样，当有一个维度是标量（而不是范围或序列）的时候，选择出的矩阵维度会减少<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">40</span>]: df.loc[dates[<span class="number">0</span>], [<span class="string">'A'</span>, <span class="string">'B'</span>]]</div><div class="line">Out[<span class="number">40</span>]:</div><div class="line">A   <span class="number">-0.561773</span></div><div class="line">B    <span class="number">0.881191</span></div><div class="line">Name: <span class="number">2017</span><span class="number">-06</span><span class="number">-08</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>, dtype: float64</div></pre></td></tr></table></figure></p>
<p>如果对所有的维度都写了标量，不就是选出一个元素吗？<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">41</span>]: df.loc[dates[<span class="number">0</span>], <span class="string">'A'</span>]</div><div class="line">Out[<span class="number">41</span>]: <span class="number">-0.56177252662051747</span></div></pre></td></tr></table></figure></p>
<p>这种情况通常用 at ，速度更快<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">42</span>]: df.at[dates[<span class="number">0</span>], <span class="string">'A'</span>]</div><div class="line">Out[<span class="number">42</span>]: <span class="number">-0.56177252662051747</span></div></pre></td></tr></table></figure></p>
<p>通过位置选择,即整数下标选择, 和 MATLAB 完全一样<br>这个就和数组类似啦，直接看例子。选出第4行：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">43</span>]: df.iloc[<span class="number">3</span>]</div><div class="line">Out[<span class="number">43</span>]:</div><div class="line">A   <span class="number">-2.411028</span></div><div class="line">B    <span class="number">0.312229</span></div><div class="line">C   <span class="number">-1.879164</span></div><div class="line">D    <span class="number">1.388484</span></div><div class="line">Name: <span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>, dtype: float64</div></pre></td></tr></table></figure></p>
<p>选出3~4行，0~1列：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">45</span>]: df.iloc[<span class="number">3</span>:<span class="number">5</span>, <span class="number">0</span>:<span class="number">2</span>]</div><div class="line">Out[<span class="number">45</span>]:</div><div class="line">                   A         B</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.411028</span>  <span class="number">0.312229</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-0.173929</span> <span class="number">-0.572149</span></div></pre></td></tr></table></figure></p>
<p>也能用 list 选择, 挑出指定行和列<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">46</span>]: df.iloc[[<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>], [<span class="number">0</span>, <span class="number">3</span>]]</div><div class="line">Out[<span class="number">46</span>]:</div><div class="line">                   A         D</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.053409</span> <span class="number">-1.753744</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.699722</span>  <span class="number">1.088473</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-0.173929</span> <span class="number">-0.101223</span></div></pre></td></tr></table></figure></p>
<p>也可以用slice<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">47</span>]: df.iloc[<span class="number">1</span>:<span class="number">3</span>, <span class="number">1</span>:<span class="number">3</span>]</div><div class="line">Out[<span class="number">47</span>]:</div><div class="line">                   B         C</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span>  <span class="number">0.814811</span>  <span class="number">0.294231</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span>  <span class="number">0.971518</span> <span class="number">-2.592852</span></div></pre></td></tr></table></figure></p>
<p>选择单个元素<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">48</span>]: df.iloc[<span class="number">0</span>,<span class="number">0</span>]</div><div class="line">Out[<span class="number">48</span>]: <span class="number">-0.56177252662051747</span></div><div class="line"></div><div class="line">In [<span class="number">49</span>]: df.iat[<span class="number">0</span>,<span class="number">0</span>]</div><div class="line">Out[<span class="number">49</span>]: <span class="number">-0.56177252662051747</span></div></pre></td></tr></table></figure></p>
<h3 id="布尔值索引"><a href="#布尔值索引" class="headerlink" title="布尔值索引"></a>布尔值索引</h3><p>根据单列的值来选择数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">7</span>]: df[df.A &gt; <span class="number">0</span>]</div><div class="line">Out[<span class="number">7</span>]:</div><div class="line">                   A         B         C        D</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span>  <span class="number">0.909448</span> <span class="number">-0.302722</span> <span class="number">-2.198783</span> <span class="number">-0.47542</span></div></pre></td></tr></table></figure></p>
<p>从DataFrame中选择符合条件的值, 其中不符合条件的用NaN填充<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">8</span>]: df[df &gt; <span class="number">0</span>]</div><div class="line">Out[<span class="number">8</span>]:</div><div class="line">                   A         B         C         D</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>       NaN       NaN       NaN       NaN</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span>       NaN  <span class="number">1.297100</span>       NaN  <span class="number">0.231742</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span>       NaN  <span class="number">2.380203</span>       NaN       NaN</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span>       NaN  <span class="number">2.262221</span>  <span class="number">1.135382</span>  <span class="number">1.166144</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span>       NaN       NaN       NaN       NaN</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span>  <span class="number">0.909448</span>       NaN       NaN       NaN</div></pre></td></tr></table></figure></p>
<p>isin() 函数：是否在集合中, 用来过滤数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">9</span>]: df2 = df.copy()</div><div class="line"></div><div class="line">In [<span class="number">10</span>]: df2[<span class="string">'E'</span>] = [<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>, <span class="string">'three'</span>, <span class="string">'one'</span>]</div><div class="line"></div><div class="line">In [<span class="number">11</span>]: df2</div><div class="line">Out[<span class="number">11</span>]:</div><div class="line">                   A         B         C         D      E</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span> <span class="number">-0.993188</span> <span class="number">-0.098497</span> <span class="number">-0.898984</span> <span class="number">-0.060261</span>    one</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.262396</span>  <span class="number">1.297100</span> <span class="number">-0.161798</span>  <span class="number">0.231742</span>    two</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.792578</span>  <span class="number">2.380203</span> <span class="number">-0.116943</span> <span class="number">-1.486425</span>  three</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.126554</span>  <span class="number">2.262221</span>  <span class="number">1.135382</span>  <span class="number">1.166144</span>   four</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-0.421283</span> <span class="number">-1.725798</span> <span class="number">-0.588929</span> <span class="number">-0.191101</span>  three</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span>  <span class="number">0.909448</span> <span class="number">-0.302722</span> <span class="number">-2.198783</span> <span class="number">-0.475420</span>    one</div><div class="line"></div><div class="line">In [<span class="number">12</span>]: df2[df2[<span class="string">'E'</span>].isin([<span class="string">'two'</span>, <span class="string">'four'</span>])]</div><div class="line">Out[<span class="number">12</span>]:</div><div class="line">                   A         B         C         D     E</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.262396</span>  <span class="number">1.297100</span> <span class="number">-0.161798</span>  <span class="number">0.231742</span>   two</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.126554</span>  <span class="number">2.262221</span>  <span class="number">1.135382</span>  <span class="number">1.166144</span>  four</div></pre></td></tr></table></figure></p>
<h3 id="设置-setting"><a href="#设置-setting" class="headerlink" title="设置 setting"></a>设置 setting</h3><p>为 DataFrame 增加新的列，按 index 对应<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">13</span>]: s1 = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>], index=pd.date_range(<span class="string">'20170608'</span>, periods=<span class="number">6</span>))</div><div class="line"></div><div class="line">In [<span class="number">14</span>]: s1</div><div class="line">Out[<span class="number">14</span>]:</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>    <span class="number">1</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span>    <span class="number">2</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span>    <span class="number">3</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span>    <span class="number">4</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span>    <span class="number">5</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span>    <span class="number">6</span></div><div class="line">Freq: D, dtype: int64</div><div class="line"></div><div class="line">In [<span class="number">15</span>]: df[<span class="string">'F'</span>] = s1</div><div class="line"></div><div class="line">In [<span class="number">16</span>]: df</div><div class="line">Out[<span class="number">16</span>]:</div><div class="line">                   A         B         C         D  F</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span> <span class="number">-0.993188</span> <span class="number">-0.098497</span> <span class="number">-0.898984</span> <span class="number">-0.060261</span>  <span class="number">1</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.262396</span>  <span class="number">1.297100</span> <span class="number">-0.161798</span>  <span class="number">0.231742</span>  <span class="number">2</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.792578</span>  <span class="number">2.380203</span> <span class="number">-0.116943</span> <span class="number">-1.486425</span>  <span class="number">3</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.126554</span>  <span class="number">2.262221</span>  <span class="number">1.135382</span>  <span class="number">1.166144</span>  <span class="number">4</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-0.421283</span> <span class="number">-1.725798</span> <span class="number">-0.588929</span> <span class="number">-0.191101</span>  <span class="number">5</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span>  <span class="number">0.909448</span> <span class="number">-0.302722</span> <span class="number">-2.198783</span> <span class="number">-0.475420</span>  <span class="number">6</span></div></pre></td></tr></table></figure></p>
<p>通过label, 下标和numpy数组设置值<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 通过label设置值</span></div><div class="line">In [<span class="number">17</span>]: df.at[dates[<span class="number">0</span>], <span class="string">'A'</span>] = <span class="number">0</span></div><div class="line"><span class="comment"># 通过下标设置值</span></div><div class="line">In [<span class="number">19</span>]: df.iat[<span class="number">0</span>,<span class="number">1</span>] = <span class="number">0</span></div><div class="line"><span class="comment"># 用 numpy 数组设置值</span></div><div class="line">In [<span class="number">21</span>]: df.loc[:, <span class="string">'D'</span>] = np.array([<span class="number">5</span>] * len(df))</div><div class="line">In [<span class="number">23</span>]: df</div><div class="line"></div><div class="line">Out[<span class="number">23</span>]:</div><div class="line">                   A         B         C  D  F</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span> <span class="number">-0.898984</span>  <span class="number">5</span>  <span class="number">1</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.262396</span>  <span class="number">1.297100</span> <span class="number">-0.161798</span>  <span class="number">5</span>  <span class="number">2</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.792578</span>  <span class="number">2.380203</span> <span class="number">-0.116943</span>  <span class="number">5</span>  <span class="number">3</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.126554</span>  <span class="number">2.262221</span>  <span class="number">1.135382</span>  <span class="number">5</span>  <span class="number">4</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-0.421283</span> <span class="number">-1.725798</span> <span class="number">-0.588929</span>  <span class="number">5</span>  <span class="number">5</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span>  <span class="number">0.909448</span> <span class="number">-0.302722</span> <span class="number">-2.198783</span>  <span class="number">5</span>  <span class="number">6</span></div></pre></td></tr></table></figure></p>
<p>通过布尔值设置值<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">28</span>]: df[df&gt;<span class="number">0</span>] = -df</div><div class="line"></div><div class="line">In [<span class="number">29</span>]: df</div><div class="line">Out[<span class="number">29</span>]:</div><div class="line">                   A         B         C  D  F</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span> <span class="number">-0.898984</span> <span class="number">-5</span> <span class="number">-1</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.262396</span> <span class="number">-1.297100</span> <span class="number">-0.161798</span> <span class="number">-5</span> <span class="number">-2</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.792578</span> <span class="number">-2.380203</span> <span class="number">-0.116943</span> <span class="number">-5</span> <span class="number">-3</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.126554</span> <span class="number">-2.262221</span> <span class="number">-1.135382</span> <span class="number">-5</span> <span class="number">-4</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-0.421283</span> <span class="number">-1.725798</span> <span class="number">-0.588929</span> <span class="number">-5</span> <span class="number">-5</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span> <span class="number">-0.909448</span> <span class="number">-0.302722</span> <span class="number">-2.198783</span> <span class="number">-5</span> <span class="number">-6</span></div></pre></td></tr></table></figure></p>
<h3 id="缺失值"><a href="#缺失值" class="headerlink" title="缺失值"></a>缺失值</h3><p>pandas 用 np.nan 表示缺失值。通常它不会被计算。<br>Reindexing 允许你改变/增加/删除 指定轴的index, 并返回数据的拷贝<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">30</span>]: df1 = df.reindex(index=dates[<span class="number">0</span>:<span class="number">4</span>], columns=list(df.columns) + [<span class="string">'E'</span>])</div><div class="line"></div><div class="line">In [<span class="number">31</span>]: df1.loc[dates[<span class="number">0</span>]:dates[<span class="number">1</span>], <span class="string">'E'</span>] = <span class="number">1</span></div><div class="line"></div><div class="line">In [<span class="number">32</span>]: df1</div><div class="line">Out[<span class="number">32</span>]:</div><div class="line">                   A         B         C  D  F    E</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span> <span class="number">-0.898984</span> <span class="number">-5</span> <span class="number">-1</span>  <span class="number">1.0</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.262396</span> <span class="number">-1.297100</span> <span class="number">-0.161798</span> <span class="number">-5</span> <span class="number">-2</span>  <span class="number">1.0</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.792578</span> <span class="number">-2.380203</span> <span class="number">-0.116943</span> <span class="number">-5</span> <span class="number">-3</span>  NaN</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.126554</span> <span class="number">-2.262221</span> <span class="number">-1.135382</span> <span class="number">-5</span> <span class="number">-4</span>  NaN</div></pre></td></tr></table></figure></p>
<p>丢弃有NaN的行<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">33</span>]: df1.dropna()  <span class="comment"># 或者 df1.dropna(how='any')</span></div><div class="line">Out[<span class="number">33</span>]:</div><div class="line">                   A       B         C  D  F    E</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>  <span class="number">0.000000</span>  <span class="number">0.0000</span> <span class="number">-0.898984</span> <span class="number">-5</span> <span class="number">-1</span>  <span class="number">1.0</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.262396</span> <span class="number">-1.2971</span> <span class="number">-0.161798</span> <span class="number">-5</span> <span class="number">-2</span>  <span class="number">1.0</span></div></pre></td></tr></table></figure></p>
<p>填充缺失值<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">35</span>]: df1.fillna(value=<span class="number">5</span>)</div><div class="line">Out[<span class="number">35</span>]:</div><div class="line">                   A         B         C  D  F    E</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span> <span class="number">-0.898984</span> <span class="number">-5</span> <span class="number">-1</span>  <span class="number">1.0</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.262396</span> <span class="number">-1.297100</span> <span class="number">-0.161798</span> <span class="number">-5</span> <span class="number">-2</span>  <span class="number">1.0</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.792578</span> <span class="number">-2.380203</span> <span class="number">-0.116943</span> <span class="number">-5</span> <span class="number">-3</span>  <span class="number">5.0</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.126554</span> <span class="number">-2.262221</span> <span class="number">-1.135382</span> <span class="number">-5</span> <span class="number">-4</span>  <span class="number">5.0</span></div></pre></td></tr></table></figure></p>
<p>获取布尔值的 mask：哪些值是 NaN, 则为true,否则为false<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">36</span>]: pd.isnull(df1)</div><div class="line">Out[<span class="number">36</span>]:</div><div class="line">                A      B      C      D      F      E</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>   <span class="keyword">True</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>  <span class="keyword">False</span>   <span class="keyword">True</span></div><div class="line"></div><div class="line">In [<span class="number">37</span>]: df1</div><div class="line">Out[<span class="number">37</span>]:</div><div class="line">                   A         B         C  D  F    E</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span> <span class="number">-0.898984</span> <span class="number">-5</span> <span class="number">-1</span>  <span class="number">1.0</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.262396</span> <span class="number">-1.297100</span> <span class="number">-0.161798</span> <span class="number">-5</span> <span class="number">-2</span>  <span class="number">1.0</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.792578</span> <span class="number">-2.380203</span> <span class="number">-0.116943</span> <span class="number">-5</span> <span class="number">-3</span>  NaN</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.126554</span> <span class="number">-2.262221</span> <span class="number">-1.135382</span> <span class="number">-5</span> <span class="number">-4</span>  NaN</div></pre></td></tr></table></figure></p>
<p><strong>注意:</strong> 这里的df1数据其实没有改变, 返回的是运算后的数据拷贝</p>
<h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><p>说明: 操作都会把NaN(缺失值)排除在外</p>
<h4 id="统计"><a href="#统计" class="headerlink" title="统计"></a>统计</h4><p>平均值<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 对每一列做平均值</span></div><div class="line">In [<span class="number">38</span>]: df.mean() <span class="comment"># df.mean(0)</span></div><div class="line">Out[<span class="number">38</span>]:</div><div class="line">A   <span class="number">-0.918710</span></div><div class="line">B   <span class="number">-1.328007</span></div><div class="line">C   <span class="number">-0.850137</span></div><div class="line">D   <span class="number">-5.000000</span></div><div class="line">F   <span class="number">-3.500000</span></div><div class="line">dtype: float64</div><div class="line"></div><div class="line"><span class="comment"># 对每一行做平均值</span></div><div class="line">In [<span class="number">40</span>]: df.mean(<span class="number">1</span>)</div><div class="line">Out[<span class="number">40</span>]:</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>   <span class="number">-1.379797</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span>   <span class="number">-1.744259</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span>   <span class="number">-2.457945</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span>   <span class="number">-2.904831</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span>   <span class="number">-2.547202</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span>   <span class="number">-2.882190</span></div><div class="line">Freq: D, dtype: float64</div></pre></td></tr></table></figure></p>
<p>操作具有不同维度的对象需要对齐。pandas会沿着指定的维度自动广播<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">42</span>]: s = pd.Series([<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, np.nan, <span class="number">6</span>, <span class="number">8</span>], index=dates).shift(<span class="number">2</span>)</div><div class="line"></div><div class="line">In [<span class="number">43</span>]: s</div><div class="line">Out[<span class="number">43</span>]:</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>    NaN</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span>    NaN</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span>    <span class="number">1.0</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span>    <span class="number">3.0</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span>    <span class="number">5.0</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span>    NaN</div><div class="line">Freq: D, dtype: float64</div><div class="line"></div><div class="line">In [<span class="number">45</span>]: df.sub(s, axis=<span class="string">'index'</span>)</div><div class="line">Out[<span class="number">45</span>]:</div><div class="line">                   A         B         C     D     F</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>       NaN       NaN       NaN   NaN   NaN</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span>       NaN       NaN       NaN   NaN   NaN</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-2.792578</span> <span class="number">-3.380203</span> <span class="number">-1.116943</span>  <span class="number">-6.0</span>  <span class="number">-4.0</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-5.126554</span> <span class="number">-5.262221</span> <span class="number">-4.135382</span>  <span class="number">-8.0</span>  <span class="number">-7.0</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-5.421283</span> <span class="number">-6.725798</span> <span class="number">-5.588929</span> <span class="number">-10.0</span> <span class="number">-10.0</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span>       NaN       NaN       NaN   NaN   NaN</div><div class="line"></div><div class="line">In [<span class="number">46</span>]: df</div><div class="line">Out[<span class="number">46</span>]:</div><div class="line">                   A         B         C  D  F</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span> <span class="number">-0.898984</span> <span class="number">-5</span> <span class="number">-1</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.262396</span> <span class="number">-1.297100</span> <span class="number">-0.161798</span> <span class="number">-5</span> <span class="number">-2</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-1.792578</span> <span class="number">-2.380203</span> <span class="number">-0.116943</span> <span class="number">-5</span> <span class="number">-3</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-2.126554</span> <span class="number">-2.262221</span> <span class="number">-1.135382</span> <span class="number">-5</span> <span class="number">-4</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-0.421283</span> <span class="number">-1.725798</span> <span class="number">-0.588929</span> <span class="number">-5</span> <span class="number">-5</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span> <span class="number">-0.909448</span> <span class="number">-0.302722</span> <span class="number">-2.198783</span> <span class="number">-5</span> <span class="number">-6</span></div></pre></td></tr></table></figure></p>
<h3 id="Apply"><a href="#Apply" class="headerlink" title="Apply"></a>Apply</h3><p>对数据（行或列） Apply 函数<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">47</span>]: df.apply(np.cumsum)</div><div class="line">Out[<span class="number">47</span>]:</div><div class="line">                   A         B         C   D   F</div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-08</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span> <span class="number">-0.898984</span>  <span class="number">-5</span>  <span class="number">-1</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-09</span> <span class="number">-0.262396</span> <span class="number">-1.297100</span> <span class="number">-1.060782</span> <span class="number">-10</span>  <span class="number">-3</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-10</span> <span class="number">-2.054974</span> <span class="number">-3.677303</span> <span class="number">-1.177726</span> <span class="number">-15</span>  <span class="number">-6</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-11</span> <span class="number">-4.181527</span> <span class="number">-5.939523</span> <span class="number">-2.313108</span> <span class="number">-20</span> <span class="number">-10</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-12</span> <span class="number">-4.602811</span> <span class="number">-7.665321</span> <span class="number">-2.902037</span> <span class="number">-25</span> <span class="number">-15</span></div><div class="line"><span class="number">2017</span><span class="number">-06</span><span class="number">-13</span> <span class="number">-5.512259</span> <span class="number">-7.968043</span> <span class="number">-5.100820</span> <span class="number">-30</span> <span class="number">-21</span></div><div class="line"></div><div class="line">In [<span class="number">48</span>]: df.apply(<span class="keyword">lambda</span> x: x.max() -x.min())</div><div class="line">Out[<span class="number">48</span>]:</div><div class="line">A    <span class="number">2.126554</span></div><div class="line">B    <span class="number">2.380203</span></div><div class="line">C    <span class="number">2.081839</span></div><div class="line">D    <span class="number">0.000000</span></div><div class="line">F    <span class="number">5.000000</span></div><div class="line">dtype: float64</div></pre></td></tr></table></figure></p>
<h3 id="直方图"><a href="#直方图" class="headerlink" title="直方图"></a>直方图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">49</span>]: s = pd.Series(np.random.randint(<span class="number">0</span>, <span class="number">7</span>, size=<span class="number">10</span>))</div><div class="line"></div><div class="line">In [<span class="number">50</span>]: s</div><div class="line">Out[<span class="number">50</span>]:</div><div class="line"><span class="number">0</span>    <span class="number">0</span></div><div class="line"><span class="number">1</span>    <span class="number">4</span></div><div class="line"><span class="number">2</span>    <span class="number">6</span></div><div class="line"><span class="number">3</span>    <span class="number">2</span></div><div class="line"><span class="number">4</span>    <span class="number">6</span></div><div class="line"><span class="number">5</span>    <span class="number">6</span></div><div class="line"><span class="number">6</span>    <span class="number">0</span></div><div class="line"><span class="number">7</span>    <span class="number">0</span></div><div class="line"><span class="number">8</span>    <span class="number">3</span></div><div class="line"><span class="number">9</span>    <span class="number">1</span></div><div class="line">dtype: int32</div><div class="line"></div><div class="line">In [<span class="number">52</span>]: s.value_counts()     </div><div class="line">Out[<span class="number">52</span>]:                      </div><div class="line"><span class="number">6</span>    <span class="number">3</span>                        </div><div class="line"><span class="number">0</span>    <span class="number">3</span>                        </div><div class="line"><span class="number">4</span>    <span class="number">1</span>                        </div><div class="line"><span class="number">3</span>    <span class="number">1</span>                        </div><div class="line"><span class="number">2</span>    <span class="number">1</span>                        </div><div class="line"><span class="number">1</span>    <span class="number">1</span>                        </div><div class="line">dtype: int64</div></pre></td></tr></table></figure>
<h3 id="字符串方法"><a href="#字符串方法" class="headerlink" title="字符串方法"></a>字符串方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">53</span>]: s = pd.Series([<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'Aaba'</span>, <span class="string">'Baca'</span>, np.nan, <span class="string">'CABA'</span>, <span class="string">'dog'</span>, <span class="string">'cat'</span>])</div><div class="line"></div><div class="line">In [<span class="number">54</span>]: s.str.lower()</div><div class="line">Out[<span class="number">54</span>]:</div><div class="line"><span class="number">0</span>       a</div><div class="line"><span class="number">1</span>       b</div><div class="line"><span class="number">2</span>       c</div><div class="line"><span class="number">3</span>    aaba</div><div class="line"><span class="number">4</span>    baca</div><div class="line"><span class="number">5</span>     NaN</div><div class="line"><span class="number">6</span>    caba</div><div class="line"><span class="number">7</span>     dog</div><div class="line"><span class="number">8</span>     cat</div><div class="line">dtype: object</div></pre></td></tr></table></figure>
<h3 id="Merge"><a href="#Merge" class="headerlink" title="Merge"></a>Merge</h3><h4 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h4><p>简单地按行拼接<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">55</span>]: df = pd.DataFrame(np.random.randn(<span class="number">10</span>, <span class="number">4</span>))</div><div class="line"></div><div class="line">In [<span class="number">56</span>]: df</div><div class="line">Out[<span class="number">56</span>]:</div><div class="line">          <span class="number">0</span>         <span class="number">1</span>         <span class="number">2</span>         <span class="number">3</span></div><div class="line"><span class="number">0</span>  <span class="number">1.279835</span>  <span class="number">0.488299</span>  <span class="number">0.122145</span>  <span class="number">1.066159</span></div><div class="line"><span class="number">1</span> <span class="number">-0.566047</span> <span class="number">-0.625790</span> <span class="number">-0.941786</span> <span class="number">-0.209994</span></div><div class="line"><span class="number">2</span>  <span class="number">0.364785</span>  <span class="number">1.185549</span> <span class="number">-0.381762</span>  <span class="number">1.752895</span></div><div class="line"><span class="number">3</span> <span class="number">-0.568627</span> <span class="number">-0.235160</span> <span class="number">-1.602423</span>  <span class="number">0.603979</span></div><div class="line"><span class="number">4</span>  <span class="number">0.698751</span> <span class="number">-1.656823</span> <span class="number">-0.306150</span>  <span class="number">2.019342</span></div><div class="line"><span class="number">5</span> <span class="number">-0.423725</span>  <span class="number">1.321606</span>  <span class="number">0.894416</span> <span class="number">-0.249282</span></div><div class="line"><span class="number">6</span> <span class="number">-0.125866</span> <span class="number">-2.315650</span>  <span class="number">0.376551</span>  <span class="number">1.050506</span></div><div class="line"><span class="number">7</span> <span class="number">-0.189071</span> <span class="number">-0.933617</span> <span class="number">-0.051930</span> <span class="number">-0.375252</span></div><div class="line"><span class="number">8</span>  <span class="number">0.478909</span> <span class="number">-2.041329</span>  <span class="number">1.217890</span> <span class="number">-1.020701</span></div><div class="line"><span class="number">9</span> <span class="number">-1.287622</span> <span class="number">-0.173968</span>  <span class="number">0.387218</span> <span class="number">-0.004477</span></div><div class="line"></div><div class="line"><span class="comment"># 拆分成piece</span></div><div class="line">In [<span class="number">57</span>]: pieces = [df[:<span class="number">3</span>], df[<span class="number">3</span>:<span class="number">7</span>], df[<span class="number">7</span>:]]</div><div class="line"></div><div class="line">In [<span class="number">58</span>]: pieces</div><div class="line">Out[<span class="number">58</span>]:</div><div class="line">[          <span class="number">0</span>         <span class="number">1</span>         <span class="number">2</span>         <span class="number">3</span></div><div class="line"> <span class="number">0</span>  <span class="number">1.279835</span>  <span class="number">0.488299</span>  <span class="number">0.122145</span>  <span class="number">1.066159</span></div><div class="line"> <span class="number">1</span> <span class="number">-0.566047</span> <span class="number">-0.625790</span> <span class="number">-0.941786</span> <span class="number">-0.209994</span></div><div class="line"> <span class="number">2</span>  <span class="number">0.364785</span>  <span class="number">1.185549</span> <span class="number">-0.381762</span>  <span class="number">1.752895</span>,</div><div class="line">           <span class="number">0</span>         <span class="number">1</span>         <span class="number">2</span>         <span class="number">3</span></div><div class="line"> <span class="number">3</span> <span class="number">-0.568627</span> <span class="number">-0.235160</span> <span class="number">-1.602423</span>  <span class="number">0.603979</span></div><div class="line"> <span class="number">4</span>  <span class="number">0.698751</span> <span class="number">-1.656823</span> <span class="number">-0.306150</span>  <span class="number">2.019342</span></div><div class="line"> <span class="number">5</span> <span class="number">-0.423725</span>  <span class="number">1.321606</span>  <span class="number">0.894416</span> <span class="number">-0.249282</span></div><div class="line"> <span class="number">6</span> <span class="number">-0.125866</span> <span class="number">-2.315650</span>  <span class="number">0.376551</span>  <span class="number">1.050506</span>,</div><div class="line">           <span class="number">0</span>         <span class="number">1</span>         <span class="number">2</span>         <span class="number">3</span></div><div class="line"> <span class="number">7</span> <span class="number">-0.189071</span> <span class="number">-0.933617</span> <span class="number">-0.051930</span> <span class="number">-0.375252</span></div><div class="line"> <span class="number">8</span>  <span class="number">0.478909</span> <span class="number">-2.041329</span>  <span class="number">1.217890</span> <span class="number">-1.020701</span></div><div class="line"> <span class="number">9</span> <span class="number">-1.287622</span> <span class="number">-0.173968</span>  <span class="number">0.387218</span> <span class="number">-0.004477</span>]</div><div class="line"></div><div class="line">In [<span class="number">59</span>]: pd.concat(pieces)</div><div class="line">Out[<span class="number">59</span>]:</div><div class="line">          <span class="number">0</span>         <span class="number">1</span>         <span class="number">2</span>         <span class="number">3</span></div><div class="line"><span class="number">0</span>  <span class="number">1.279835</span>  <span class="number">0.488299</span>  <span class="number">0.122145</span>  <span class="number">1.066159</span></div><div class="line"><span class="number">1</span> <span class="number">-0.566047</span> <span class="number">-0.625790</span> <span class="number">-0.941786</span> <span class="number">-0.209994</span></div><div class="line"><span class="number">2</span>  <span class="number">0.364785</span>  <span class="number">1.185549</span> <span class="number">-0.381762</span>  <span class="number">1.752895</span></div><div class="line"><span class="number">3</span> <span class="number">-0.568627</span> <span class="number">-0.235160</span> <span class="number">-1.602423</span>  <span class="number">0.603979</span></div><div class="line"><span class="number">4</span>  <span class="number">0.698751</span> <span class="number">-1.656823</span> <span class="number">-0.306150</span>  <span class="number">2.019342</span></div><div class="line"><span class="number">5</span> <span class="number">-0.423725</span>  <span class="number">1.321606</span>  <span class="number">0.894416</span> <span class="number">-0.249282</span></div><div class="line"><span class="number">6</span> <span class="number">-0.125866</span> <span class="number">-2.315650</span>  <span class="number">0.376551</span>  <span class="number">1.050506</span></div><div class="line"><span class="number">7</span> <span class="number">-0.189071</span> <span class="number">-0.933617</span> <span class="number">-0.051930</span> <span class="number">-0.375252</span></div><div class="line"><span class="number">8</span>  <span class="number">0.478909</span> <span class="number">-2.041329</span>  <span class="number">1.217890</span> <span class="number">-1.020701</span></div><div class="line"><span class="number">9</span> <span class="number">-1.287622</span> <span class="number">-0.173968</span>  <span class="number">0.387218</span> <span class="number">-0.004477</span></div></pre></td></tr></table></figure></p>
<h4 id="join"><a href="#join" class="headerlink" title="join"></a>join</h4><p>和 SQL 的 join 是一个意思<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">60</span>]: left = pd.DataFrame(&#123;<span class="string">'key'</span>: [<span class="string">'foo'</span>, <span class="string">'foo'</span>], <span class="string">'lval'</span>: [<span class="number">1</span>, <span class="number">2</span>]&#125;)</div><div class="line"></div><div class="line">In [<span class="number">61</span>]: right = pd.DataFrame(&#123;<span class="string">'key'</span>: [<span class="string">'foo'</span>, <span class="string">'foo'</span>], <span class="string">'rval'</span>: [<span class="number">4</span>, <span class="number">5</span>]&#125;)</div><div class="line"></div><div class="line">In [<span class="number">62</span>]: left</div><div class="line">Out[<span class="number">62</span>]:</div><div class="line">   key  lval</div><div class="line"><span class="number">0</span>  foo     <span class="number">1</span></div><div class="line"><span class="number">1</span>  foo     <span class="number">2</span></div><div class="line"></div><div class="line">In [<span class="number">63</span>]: right</div><div class="line">Out[<span class="number">63</span>]:</div><div class="line">   key  rval</div><div class="line"><span class="number">0</span>  foo     <span class="number">4</span></div><div class="line"><span class="number">1</span>  foo     <span class="number">5</span></div><div class="line"></div><div class="line">In [<span class="number">64</span>]: pd.merge(left, right, on=<span class="string">'key'</span>)</div><div class="line">Out[<span class="number">64</span>]:</div><div class="line">   key  lval  rval</div><div class="line"><span class="number">0</span>  foo     <span class="number">1</span>     <span class="number">4</span></div><div class="line"><span class="number">1</span>  foo     <span class="number">1</span>     <span class="number">5</span></div><div class="line"><span class="number">2</span>  foo     <span class="number">2</span>     <span class="number">4</span></div><div class="line"><span class="number">3</span>  foo     <span class="number">2</span>     <span class="number">5</span></div></pre></td></tr></table></figure></p>
<h4 id="Append"><a href="#Append" class="headerlink" title="Append"></a>Append</h4><p>向 DataFrame 增加新的<strong>数据行</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">65</span>]: df = pd.DataFrame(np.random.randn(<span class="number">8</span>, <span class="number">4</span>), columns=[<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>])</div><div class="line"></div><div class="line">In [<span class="number">66</span>]: df</div><div class="line">Out[<span class="number">66</span>]:</div><div class="line">          A         B         C         D</div><div class="line"><span class="number">0</span> <span class="number">-0.303120</span>  <span class="number">0.419378</span>  <span class="number">0.111816</span> <span class="number">-0.160104</span></div><div class="line"><span class="number">1</span>  <span class="number">0.924466</span>  <span class="number">2.385372</span> <span class="number">-1.575671</span> <span class="number">-1.789283</span></div><div class="line"><span class="number">2</span>  <span class="number">1.106048</span> <span class="number">-0.087699</span>  <span class="number">1.714677</span> <span class="number">-0.058831</span></div><div class="line"><span class="number">3</span>  <span class="number">0.765727</span>  <span class="number">0.101523</span> <span class="number">-1.204472</span>  <span class="number">0.011180</span></div><div class="line"><span class="number">4</span> <span class="number">-2.084695</span> <span class="number">-0.517287</span> <span class="number">-0.497699</span>  <span class="number">0.153516</span></div><div class="line"><span class="number">5</span> <span class="number">-0.252460</span>  <span class="number">0.044590</span> <span class="number">-0.481047</span>  <span class="number">0.617817</span></div><div class="line"><span class="number">6</span> <span class="number">-0.121789</span> <span class="number">-1.663595</span> <span class="number">-0.464836</span> <span class="number">-0.858457</span></div><div class="line"><span class="number">7</span> <span class="number">-0.246298</span>  <span class="number">0.687569</span> <span class="number">-2.081519</span> <span class="number">-1.529134</span></div><div class="line"></div><div class="line">In [<span class="number">67</span>]: s = df.iloc[<span class="number">3</span>]</div><div class="line"></div><div class="line">In [<span class="number">68</span>]: df.append(s, ignore_index=<span class="keyword">True</span>)</div><div class="line">Out[<span class="number">68</span>]:</div><div class="line">          A         B         C         D</div><div class="line"><span class="number">0</span> <span class="number">-0.303120</span>  <span class="number">0.419378</span>  <span class="number">0.111816</span> <span class="number">-0.160104</span></div><div class="line"><span class="number">1</span>  <span class="number">0.924466</span>  <span class="number">2.385372</span> <span class="number">-1.575671</span> <span class="number">-1.789283</span></div><div class="line"><span class="number">2</span>  <span class="number">1.106048</span> <span class="number">-0.087699</span>  <span class="number">1.714677</span> <span class="number">-0.058831</span></div><div class="line"><span class="number">3</span>  <span class="number">0.765727</span>  <span class="number">0.101523</span> <span class="number">-1.204472</span>  <span class="number">0.011180</span></div><div class="line"><span class="number">4</span> <span class="number">-2.084695</span> <span class="number">-0.517287</span> <span class="number">-0.497699</span>  <span class="number">0.153516</span></div><div class="line"><span class="number">5</span> <span class="number">-0.252460</span>  <span class="number">0.044590</span> <span class="number">-0.481047</span>  <span class="number">0.617817</span></div><div class="line"><span class="number">6</span> <span class="number">-0.121789</span> <span class="number">-1.663595</span> <span class="number">-0.464836</span> <span class="number">-0.858457</span></div><div class="line"><span class="number">7</span> <span class="number">-0.246298</span>  <span class="number">0.687569</span> <span class="number">-2.081519</span> <span class="number">-1.529134</span></div><div class="line"><span class="number">8</span>  <span class="number">0.765727</span>  <span class="number">0.101523</span> <span class="number">-1.204472</span>  <span class="number">0.011180</span></div></pre></td></tr></table></figure></p>
<h4 id="Grouping"><a href="#Grouping" class="headerlink" title="Grouping"></a>Grouping</h4><p>和 SQL 中的 GROUP BY 类似，包括以下这几步：</p>
<ul>
<li>根据某些规则，把数据分组</li>
<li>对每组应用一个函数</li>
<li>合并结果到一个数据结构中</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">69</span>]: df = pd.DataFrame(&#123;</div><div class="line">    ...: <span class="string">'A'</span> : [<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'foo'</span>, <span class="string">'bar'</span>,<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'foo'</span>, <span class="string">'foo'</span>],</div><div class="line">    ...: <span class="string">'B'</span> : [<span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>,<span class="string">'two'</span>, <span class="string">'two'</span>, <span class="string">'one'</span>, <span class="string">'three'</span>],</div><div class="line">    ...: <span class="string">'C'</span> : np.random.randn(<span class="number">8</span>),</div><div class="line">    ...: <span class="string">'D'</span> : np.random.randn(<span class="number">8</span>)&#125;)</div><div class="line"></div><div class="line">In [<span class="number">70</span>]: df</div><div class="line">Out[<span class="number">70</span>]:</div><div class="line">     A      B         C         D</div><div class="line"><span class="number">0</span>  foo    one <span class="number">-1.203566</span> <span class="number">-1.199038</span></div><div class="line"><span class="number">1</span>  bar    one  <span class="number">2.368016</span> <span class="number">-1.059656</span></div><div class="line"><span class="number">2</span>  foo    two <span class="number">-0.704544</span> <span class="number">-1.047794</span></div><div class="line"><span class="number">3</span>  bar  three <span class="number">-0.511092</span>  <span class="number">1.121859</span></div><div class="line"><span class="number">4</span>  foo    two <span class="number">-0.723414</span> <span class="number">-1.225536</span></div><div class="line"><span class="number">5</span>  bar    two <span class="number">-0.363631</span>  <span class="number">0.111177</span></div><div class="line"><span class="number">6</span>  foo    one  <span class="number">0.271759</span>  <span class="number">0.500798</span></div><div class="line"><span class="number">7</span>  foo  three <span class="number">-0.248960</span>  <span class="number">2.035166</span></div><div class="line"></div><div class="line"><span class="comment"># 做 Group 操作并对每组求和</span></div><div class="line">In [<span class="number">71</span>]: df.groupby(<span class="string">'A'</span>).sum()</div><div class="line">Out[<span class="number">71</span>]:</div><div class="line">            C         D</div><div class="line">A</div><div class="line">bar  <span class="number">1.493293</span>  <span class="number">0.173380</span></div><div class="line">foo <span class="number">-2.608725</span> <span class="number">-0.936404</span></div><div class="line"></div><div class="line"><span class="comment"># 可以对两列进行 Group by 并求和</span></div><div class="line">In [<span class="number">72</span>]: df.groupby([<span class="string">'A'</span>, <span class="string">'B'</span>]).sum()</div><div class="line">Out[<span class="number">72</span>]:</div><div class="line">                  C         D</div><div class="line">A   B</div><div class="line">bar one    <span class="number">2.368016</span> <span class="number">-1.059656</span></div><div class="line">    three <span class="number">-0.511092</span>  <span class="number">1.121859</span></div><div class="line">    two   <span class="number">-0.363631</span>  <span class="number">0.111177</span></div><div class="line">foo one   <span class="number">-0.931807</span> <span class="number">-0.698240</span></div><div class="line">    three <span class="number">-0.248960</span>  <span class="number">2.035166</span></div><div class="line">    two   <span class="number">-1.427958</span> <span class="number">-2.273330</span></div></pre></td></tr></table></figure>
<h3 id="Reshape"><a href="#Reshape" class="headerlink" title="Reshape"></a>Reshape</h3><h4 id="Stack-叠层"><a href="#Stack-叠层" class="headerlink" title="Stack 叠层"></a>Stack 叠层</h4><p>准备数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">73</span>]: tuples = list(zip(*[[<span class="string">'bar'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>, <span class="string">'baz'</span>,</div><div class="line">    ...: <span class="string">'foo'</span>, <span class="string">'foo'</span>, <span class="string">'qux'</span>, <span class="string">'qux'</span>],</div><div class="line">    ...: [<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>,</div><div class="line">    ...: <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>]]))</div><div class="line"></div><div class="line">In [<span class="number">75</span>]: index = pd.MultiIndex.from_tuples(tuples, names=[<span class="string">'first'</span>, <span class="string">'second'</span>])</div><div class="line"></div><div class="line">In [<span class="number">76</span>]: df = pd.DataFrame(np.random.randn(<span class="number">8</span>, <span class="number">2</span>), index=index, columns=[<span class="string">'A'</span>,<span class="string">'B'</span>])</div><div class="line"></div><div class="line">In [<span class="number">77</span>]: df2 = df[:<span class="number">4</span>]</div><div class="line"></div><div class="line">In [<span class="number">78</span>]: df2</div><div class="line">Out[<span class="number">78</span>]:</div><div class="line">                     A         B</div><div class="line">first second</div><div class="line">bar   one     <span class="number">0.181096</span> <span class="number">-0.610853</span></div><div class="line">      two    <span class="number">-1.326709</span>  <span class="number">0.269153</span></div><div class="line">baz   one    <span class="number">-0.455180</span> <span class="number">-0.070055</span></div><div class="line">      two    <span class="number">-0.953993</span> <span class="number">-0.235160</span></div><div class="line">```      </div><div class="line"></div><div class="line">stack() 把 DataFrame 的所有列“压缩”到 index 里去</div><div class="line">```python</div><div class="line">In [<span class="number">79</span>]: stacked = df2.stack()</div><div class="line"></div><div class="line">In [<span class="number">80</span>]: stacked</div><div class="line">Out[<span class="number">80</span>]:</div><div class="line">first  second</div><div class="line">bar    one     A    <span class="number">0.181096</span></div><div class="line">               B   <span class="number">-0.610853</span></div><div class="line">       two     A   <span class="number">-1.326709</span></div><div class="line">               B    <span class="number">0.269153</span></div><div class="line">baz    one     A   <span class="number">-0.455180</span></div><div class="line">               B   <span class="number">-0.070055</span></div><div class="line">       two     A   <span class="number">-0.953993</span></div><div class="line">               B   <span class="number">-0.235160</span></div><div class="line">dtype: float64</div></pre></td></tr></table></figure></p>
<p>反之，只要是 MultiIndex 都可以用 unstack() 恢复出列，默认把最后一个 index 解开<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">81</span>]: stacked.unstack()</div><div class="line">Out[<span class="number">81</span>]:</div><div class="line">                     A         B</div><div class="line">first second</div><div class="line">bar   one     <span class="number">0.181096</span> <span class="number">-0.610853</span></div><div class="line">      two    <span class="number">-1.326709</span>  <span class="number">0.269153</span></div><div class="line">baz   one    <span class="number">-0.455180</span> <span class="number">-0.070055</span></div><div class="line">      two    <span class="number">-0.953993</span> <span class="number">-0.235160</span></div><div class="line"></div><div class="line">In [<span class="number">82</span>]: stacked.unstack(<span class="number">1</span>)</div><div class="line">Out[<span class="number">82</span>]:</div><div class="line">second        one       two</div><div class="line">first</div><div class="line">bar   A  <span class="number">0.181096</span> <span class="number">-1.326709</span></div><div class="line">      B <span class="number">-0.610853</span>  <span class="number">0.269153</span></div><div class="line">baz   A <span class="number">-0.455180</span> <span class="number">-0.953993</span></div><div class="line">      B <span class="number">-0.070055</span> <span class="number">-0.235160</span></div><div class="line"></div><div class="line">In [<span class="number">83</span>]: stacked.unstack(<span class="number">0</span>)</div><div class="line">Out[<span class="number">83</span>]:</div><div class="line">first          bar       baz</div><div class="line">second</div><div class="line">one    A  <span class="number">0.181096</span> <span class="number">-0.455180</span></div><div class="line">       B <span class="number">-0.610853</span> <span class="number">-0.070055</span></div><div class="line">two    A <span class="number">-1.326709</span> <span class="number">-0.953993</span></div><div class="line">       B  <span class="number">0.269153</span> <span class="number">-0.235160</span></div></pre></td></tr></table></figure></p>
<h3 id="Pivot-Table-旋转"><a href="#Pivot-Table-旋转" class="headerlink" title="Pivot Table 旋转"></a>Pivot Table 旋转</h3><p>准备数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">84</span>]: df = pd.DataFrame(&#123;<span class="string">'A'</span> : [<span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>] * <span class="number">3</span>,</div><div class="line">    ...:  <span class="string">'B'</span> : [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>] * <span class="number">4</span>,</div><div class="line">    ...: <span class="string">'C'</span> : [<span class="string">'foo'</span>, <span class="string">'foo'</span>, <span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'bar'</span>, <span class="string">'bar'</span>] * <span class="number">2</span>,</div><div class="line">    ...: <span class="string">'D'</span> : np.random.randn(<span class="number">12</span>),</div><div class="line">    ...: <span class="string">'E'</span> : np.random.randn(<span class="number">12</span>)&#125;)</div><div class="line"></div><div class="line">In [<span class="number">85</span>]: df</div><div class="line">Out[<span class="number">85</span>]:</div><div class="line">        A  B    C         D         E</div><div class="line"><span class="number">0</span>     one  A  foo <span class="number">-0.379428</span> <span class="number">-0.050681</span></div><div class="line"><span class="number">1</span>     one  B  foo  <span class="number">1.650807</span>  <span class="number">0.024530</span></div><div class="line"><span class="number">2</span>     two  C  foo  <span class="number">0.349554</span>  <span class="number">1.202692</span></div><div class="line"><span class="number">3</span>   three  A  bar <span class="number">-1.516381</span> <span class="number">-0.163382</span></div><div class="line"><span class="number">4</span>     one  B  bar  <span class="number">0.360722</span> <span class="number">-0.241622</span></div><div class="line"><span class="number">5</span>     one  C  bar <span class="number">-0.276398</span>  <span class="number">0.581192</span></div><div class="line"><span class="number">6</span>     two  A  foo  <span class="number">0.304563</span> <span class="number">-0.663271</span></div><div class="line"><span class="number">7</span>   three  B  foo  <span class="number">1.328499</span>  <span class="number">0.485223</span></div><div class="line"><span class="number">8</span>     one  C  foo  <span class="number">1.665213</span> <span class="number">-0.577843</span></div><div class="line"><span class="number">9</span>     one  A  bar <span class="number">-0.229248</span> <span class="number">-0.335329</span></div><div class="line"><span class="number">10</span>    two  B  bar <span class="number">-0.133112</span>  <span class="number">1.119350</span></div><div class="line"><span class="number">11</span>  three  C  bar <span class="number">-0.383992</span>  <span class="number">0.787800</span></div></pre></td></tr></table></figure></p>
<p>pivot 是把原来的数据(values)作为新表的行(index)、列(columns)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">86</span>]: pd.pivot_table(df, values=<span class="string">'D'</span>, index=[<span class="string">'A'</span>, <span class="string">'B'</span>], columns=[<span class="string">'C'</span>])</div><div class="line">Out[<span class="number">86</span>]:</div><div class="line">C             bar       foo</div><div class="line">A     B</div><div class="line">one   A <span class="number">-0.229248</span> <span class="number">-0.379428</span></div><div class="line">      B  <span class="number">0.360722</span>  <span class="number">1.650807</span></div><div class="line">      C <span class="number">-0.276398</span>  <span class="number">1.665213</span></div><div class="line">three A <span class="number">-1.516381</span>       NaN</div><div class="line">      B       NaN  <span class="number">1.328499</span></div><div class="line">      C <span class="number">-0.383992</span>       NaN</div><div class="line">two   A       NaN  <span class="number">0.304563</span></div><div class="line">      B <span class="number">-0.133112</span>       NaN</div><div class="line">      C       NaN  <span class="number">0.349554</span></div></pre></td></tr></table></figure></p>
<h3 id="时间序列"><a href="#时间序列" class="headerlink" title="时间序列"></a>时间序列</h3><p>pandas 的时间序列功能在金融应用中很有用。</p>
<p>resample功能<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">88</span>]: rng = pd.date_range(<span class="string">'9/6/2017'</span>, periods=<span class="number">100</span>, freq=<span class="string">'S'</span>)</div><div class="line"></div><div class="line">In [<span class="number">89</span>]: ts = pd.Series(np.random.randint(<span class="number">0</span>, <span class="number">500</span>, len(rng)), index=rng)</div><div class="line"></div><div class="line">In [<span class="number">90</span>]: ts.resample(<span class="string">'5Min'</span>).sum()</div><div class="line">Out[<span class="number">90</span>]:</div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-06</span>    <span class="number">26085</span></div><div class="line">Freq: <span class="number">5</span>T, dtype: int32</div></pre></td></tr></table></figure></p>
<p>时区表示<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">94</span>]: rng = pd.date_range(<span class="string">'9/6/2017 00:00'</span>, periods=<span class="number">5</span>, freq=<span class="string">'D'</span>)</div><div class="line"></div><div class="line">In [<span class="number">95</span>]: ts = pd.Series(np.random.randn(len(rng)), rng)</div><div class="line"></div><div class="line">In [<span class="number">96</span>]: ts</div><div class="line">Out[<span class="number">96</span>]:</div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-06</span>   <span class="number">-0.715837</span></div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-07</span>    <span class="number">1.021448</span></div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-08</span>    <span class="number">1.186508</span></div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-09</span>    <span class="number">0.606852</span></div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-10</span>    <span class="number">0.566530</span></div><div class="line">Freq: D, dtype: float64</div><div class="line"></div><div class="line">In [<span class="number">97</span>]: ts_utc = ts.tz_localize(<span class="string">'UTC'</span>)</div><div class="line"></div><div class="line">In [<span class="number">98</span>]: ts_utc</div><div class="line">Out[<span class="number">98</span>]:</div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-06</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>+<span class="number">00</span>:<span class="number">00</span>   <span class="number">-0.715837</span></div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-07</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>+<span class="number">00</span>:<span class="number">00</span>    <span class="number">1.021448</span></div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-08</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>+<span class="number">00</span>:<span class="number">00</span>    <span class="number">1.186508</span></div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-09</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>+<span class="number">00</span>:<span class="number">00</span>    <span class="number">0.606852</span></div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>+<span class="number">00</span>:<span class="number">00</span>    <span class="number">0.566530</span></div><div class="line">Freq: D, dtype: float64</div></pre></td></tr></table></figure></p>
<p>时区转换<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">100</span>]: ts_utc.tz_convert(<span class="string">'US/Eastern'</span>)</div><div class="line">Out[<span class="number">100</span>]:</div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-05</span> <span class="number">20</span>:<span class="number">00</span>:<span class="number">00</span><span class="number">-04</span>:<span class="number">00</span>   <span class="number">-0.715837</span></div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-06</span> <span class="number">20</span>:<span class="number">00</span>:<span class="number">00</span><span class="number">-04</span>:<span class="number">00</span>    <span class="number">1.021448</span></div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-07</span> <span class="number">20</span>:<span class="number">00</span>:<span class="number">00</span><span class="number">-04</span>:<span class="number">00</span>    <span class="number">1.186508</span></div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-08</span> <span class="number">20</span>:<span class="number">00</span>:<span class="number">00</span><span class="number">-04</span>:<span class="number">00</span>    <span class="number">0.606852</span></div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-09</span> <span class="number">20</span>:<span class="number">00</span>:<span class="number">00</span><span class="number">-04</span>:<span class="number">00</span>    <span class="number">0.566530</span></div><div class="line">Freq: D, dtype: float64</div></pre></td></tr></table></figure></p>
<p>在时间跨度表示之间进行转换<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">101</span>]: rng = pd.date_range(<span class="string">'9/6/2017'</span>, periods=<span class="number">5</span>, freq=<span class="string">'M'</span>)</div><div class="line"></div><div class="line">In [<span class="number">102</span>]: ts = pd.Series(np.random.randn(len(rng)), index=rng)</div><div class="line"></div><div class="line">In [<span class="number">103</span>]: ts</div><div class="line">Out[<span class="number">103</span>]:</div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-30</span>   <span class="number">-0.337867</span></div><div class="line"><span class="number">2017</span><span class="number">-10</span><span class="number">-31</span>    <span class="number">0.546883</span></div><div class="line"><span class="number">2017</span><span class="number">-11</span><span class="number">-30</span>    <span class="number">0.063004</span></div><div class="line"><span class="number">2017</span><span class="number">-12</span><span class="number">-31</span>    <span class="number">0.419636</span></div><div class="line"><span class="number">2018</span><span class="number">-01</span><span class="number">-31</span>    <span class="number">2.562404</span></div><div class="line">Freq: M, dtype: float64</div><div class="line"></div><div class="line">In [<span class="number">104</span>]: ps = ts.to_period()</div><div class="line"></div><div class="line">In [<span class="number">105</span>]: ps</div><div class="line">Out[<span class="number">105</span>]:</div><div class="line"><span class="number">2017</span><span class="number">-09</span>   <span class="number">-0.337867</span></div><div class="line"><span class="number">2017</span><span class="number">-10</span>    <span class="number">0.546883</span></div><div class="line"><span class="number">2017</span><span class="number">-11</span>    <span class="number">0.063004</span></div><div class="line"><span class="number">2017</span><span class="number">-12</span>    <span class="number">0.419636</span></div><div class="line"><span class="number">2018</span><span class="number">-01</span>    <span class="number">2.562404</span></div><div class="line">Freq: M, dtype: float64</div><div class="line"></div><div class="line">In [<span class="number">106</span>]: ps.to_timestamp()</div><div class="line">Out[<span class="number">106</span>]:</div><div class="line"><span class="number">2017</span><span class="number">-09</span><span class="number">-01</span>   <span class="number">-0.337867</span></div><div class="line"><span class="number">2017</span><span class="number">-10</span><span class="number">-01</span>    <span class="number">0.546883</span></div><div class="line"><span class="number">2017</span><span class="number">-11</span><span class="number">-01</span>    <span class="number">0.063004</span></div><div class="line"><span class="number">2017</span><span class="number">-12</span><span class="number">-01</span>    <span class="number">0.419636</span></div><div class="line"><span class="number">2018</span><span class="number">-01</span><span class="number">-01</span>    <span class="number">2.562404</span></div><div class="line">Freq: MS, dtype: float64</div><div class="line"></div><div class="line">In [<span class="number">107</span>]: prng = pd.period_range(<span class="string">'1990Q1'</span>, <span class="string">'2000Q4'</span>, freq=<span class="string">'Q-NOV'</span>)</div><div class="line"></div><div class="line">In [<span class="number">108</span>]: ts = pd.Series(np.random.randn(len(prng)), prng)</div><div class="line"></div><div class="line">In [<span class="number">109</span>]: ts.index = (prng.asfreq(<span class="string">'M'</span>, <span class="string">'e'</span>) + <span class="number">1</span>).asfreq(<span class="string">'H'</span>, <span class="string">'s'</span>) + <span class="number">9</span></div><div class="line"></div><div class="line">In [<span class="number">110</span>]: ts.head()</div><div class="line">Out[<span class="number">110</span>]:</div><div class="line"><span class="number">1990</span><span class="number">-03</span><span class="number">-01</span> <span class="number">09</span>:<span class="number">00</span>   <span class="number">-0.315663</span></div><div class="line"><span class="number">1990</span><span class="number">-06</span><span class="number">-01</span> <span class="number">09</span>:<span class="number">00</span>    <span class="number">2.092510</span></div><div class="line"><span class="number">1990</span><span class="number">-09</span><span class="number">-01</span> <span class="number">09</span>:<span class="number">00</span>    <span class="number">0.337302</span></div><div class="line"><span class="number">1990</span><span class="number">-12</span><span class="number">-01</span> <span class="number">09</span>:<span class="number">00</span>    <span class="number">0.037893</span></div><div class="line"><span class="number">1991</span><span class="number">-03</span><span class="number">-01</span> <span class="number">09</span>:<span class="number">00</span>    <span class="number">0.463572</span></div><div class="line">Freq: H, dtype: float64</div></pre></td></tr></table></figure></p>
<h3 id="类别"><a href="#类别" class="headerlink" title="类别"></a>类别</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">111</span>]: df = pd.DataFrame(&#123;<span class="string">"id"</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>], <span class="string">"raw_grade"</span>:[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'e'</span>]&#125;)</div><div class="line"></div><div class="line">In [<span class="number">112</span>]: df</div><div class="line">Out[<span class="number">112</span>]:</div><div class="line">   id raw_grade</div><div class="line"><span class="number">0</span>   <span class="number">1</span>         a</div><div class="line"><span class="number">1</span>   <span class="number">2</span>         b</div><div class="line"><span class="number">2</span>   <span class="number">3</span>         b</div><div class="line"><span class="number">3</span>   <span class="number">4</span>         a</div><div class="line"><span class="number">4</span>   <span class="number">5</span>         a</div><div class="line"><span class="number">5</span>   <span class="number">6</span>         e</div><div class="line"></div><div class="line">In [<span class="number">113</span>]: df[<span class="string">'grade'</span>] = df[<span class="string">'raw_grade'</span>].astype(<span class="string">'category'</span>)</div><div class="line"></div><div class="line">In [<span class="number">114</span>]: df[<span class="string">'grade'</span>]</div><div class="line">Out[<span class="number">114</span>]:</div><div class="line"><span class="number">0</span>    a</div><div class="line"><span class="number">1</span>    b</div><div class="line"><span class="number">2</span>    b</div><div class="line"><span class="number">3</span>    a</div><div class="line"><span class="number">4</span>    a</div><div class="line"><span class="number">5</span>    e</div><div class="line">Name: grade, dtype: category</div><div class="line">Categories (<span class="number">3</span>, object): [a, b, e]</div></pre></td></tr></table></figure>
<p>类别可以 inplace 地赋值：（只是改一下对应的字符串嘛，类别是用 Index 对象存储的）<br><code>In [115]: df[&#39;grade&#39;].cat.categories = [&quot;very good&quot;, &quot;good&quot;, &quot;very bad&quot;]</code><br>修改类别时，如果有新的类别，会自动加进去<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">117</span>]: df[<span class="string">'grade'</span>] = df[<span class="string">'grade'</span>].cat.set_categories([<span class="string">"very bad"</span>, <span class="string">"bad"</span>, <span class="string">"medium"</span>, <span class="string">"good"</span>, <span class="string">"very good"</span>])</div><div class="line"></div><div class="line">In [<span class="number">118</span>]: df[<span class="string">'grade'</span>]</div><div class="line">Out[<span class="number">118</span>]:</div><div class="line"><span class="number">0</span>    very good</div><div class="line"><span class="number">1</span>         good</div><div class="line"><span class="number">2</span>         good</div><div class="line"><span class="number">3</span>    very good</div><div class="line"><span class="number">4</span>    very good</div><div class="line"><span class="number">5</span>     very bad</div><div class="line">Name: grade, dtype: category</div><div class="line">Categories (<span class="number">5</span>, object): [very bad, bad, medium, good, very good]</div></pre></td></tr></table></figure></p>
<p>根据类别排序<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">119</span>]: df.sort_values(by=<span class="string">'grade'</span>)</div><div class="line">Out[<span class="number">119</span>]:</div><div class="line">   id raw_grade      grade</div><div class="line"><span class="number">5</span>   <span class="number">6</span>         e   very bad</div><div class="line"><span class="number">1</span>   <span class="number">2</span>         b       good</div><div class="line"><span class="number">2</span>   <span class="number">3</span>         b       good</div><div class="line"><span class="number">0</span>   <span class="number">1</span>         a  very good</div><div class="line"><span class="number">3</span>   <span class="number">4</span>         a  very good</div><div class="line"><span class="number">4</span>   <span class="number">5</span>         a  very good</div></pre></td></tr></table></figure></p>
<p>做 group by 的时候，空的类别也会被呈现出来<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">120</span>]: df.groupby(<span class="string">'grade'</span>).size()</div><div class="line">Out[<span class="number">120</span>]:</div><div class="line">grade</div><div class="line">very bad     <span class="number">1</span></div><div class="line">bad          <span class="number">0</span></div><div class="line">medium       <span class="number">0</span></div><div class="line">good         <span class="number">2</span></div><div class="line">very good    <span class="number">3</span></div><div class="line">dtype: int64</div></pre></td></tr></table></figure></p>
<h3 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">121</span>]: ts = pd.Series(np.random.randn(<span class="number">1000</span>), index=pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">1000</span>))</div><div class="line"></div><div class="line">In [<span class="number">122</span>]: ts = ts.cumsum()</div><div class="line"></div><div class="line">In [<span class="number">123</span>]: ts.plot()</div><div class="line">Out[<span class="number">123</span>]: &lt;matplotlib.axes._subplots.AxesSubplot at <span class="number">0x6a0be10</span>&gt;</div></pre></td></tr></table></figure>
<p><img src="/2017/06/08/python-pandas-2017-06-08/1.png" alt=""></p>
<p>对于DtaFrame,可以直接plot<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">124</span>]: df = pd.DataFrame(np.random.randn(<span class="number">1000</span>, <span class="number">4</span>), index=ts.index, columns=[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>])</div><div class="line"></div><div class="line">In [<span class="number">125</span>]: df = df.cumsum()</div><div class="line"></div><div class="line">In [<span class="number">126</span>]: plt.figure(); df.plot(); plt.legend(loc=<span class="string">'best'</span>)</div><div class="line">Out[<span class="number">126</span>]: &lt;matplotlib.legend.Legend at <span class="number">0x6c3e8f0</span>&gt;</div></pre></td></tr></table></figure></p>
<p><img src="/2017/06/08/python-pandas-2017-06-08/2.png" alt=""></p>
<h3 id="读写数据"><a href="#读写数据" class="headerlink" title="读写数据"></a>读写数据</h3><h4 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">127</span>]: df.to_csv(<span class="string">'foo.csv'</span>)                            </div><div class="line">                                                          </div><div class="line">In [<span class="number">128</span>]: pd.read_csv(<span class="string">'foo.csv'</span>)                          </div><div class="line">Out[<span class="number">128</span>]:                                                 </div><div class="line">     Unnamed: <span class="number">0</span>         A         B          C          D </div><div class="line"><span class="number">0</span>    <span class="number">2000</span><span class="number">-01</span><span class="number">-01</span>  <span class="number">1.239452</span>  <span class="number">1.983851</span>   <span class="number">0.578987</span>   <span class="number">1.155658</span> </div><div class="line"><span class="number">1</span>    <span class="number">2000</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">0.295568</span>  <span class="number">3.704782</span>   <span class="number">1.962402</span>   <span class="number">0.885559</span> </div><div class="line"><span class="number">2</span>    <span class="number">2000</span><span class="number">-01</span><span class="number">-03</span> <span class="number">-0.139800</span>  <span class="number">3.872238</span>   <span class="number">2.793025</span>   <span class="number">0.972079</span> </div><div class="line"><span class="number">3</span>    <span class="number">2000</span><span class="number">-01</span><span class="number">-04</span> <span class="number">-0.804336</span>  <span class="number">3.259410</span>   <span class="number">2.159552</span>   <span class="number">1.785479</span> </div><div class="line"><span class="number">4</span>    <span class="number">2000</span><span class="number">-01</span><span class="number">-05</span>  <span class="number">0.171984</span>  <span class="number">3.027446</span>   <span class="number">2.253854</span>   <span class="number">0.779544</span> </div><div class="line"><span class="number">5</span>    <span class="number">2000</span><span class="number">-01</span><span class="number">-06</span>  <span class="number">1.781807</span>  <span class="number">1.836517</span>   <span class="number">4.558960</span>   <span class="number">1.999731</span> </div><div class="line"><span class="number">6</span>    <span class="number">2000</span><span class="number">-01</span><span class="number">-07</span>  <span class="number">0.650927</span>  <span class="number">0.154262</span>   <span class="number">3.650160</span>   <span class="number">0.685396</span> </div><div class="line"><span class="number">7</span>    <span class="number">2000</span><span class="number">-01</span><span class="number">-08</span>  <span class="number">0.492898</span> <span class="number">-0.198763</span>   <span class="number">3.646034</span>  <span class="number">-0.073848</span> </div><div class="line"><span class="number">8</span>    <span class="number">2000</span><span class="number">-01</span><span class="number">-09</span> <span class="number">-0.100468</span> <span class="number">-0.623716</span>   <span class="number">3.217366</span>   <span class="number">0.220008</span> </div><div class="line"><span class="number">9</span>    <span class="number">2000</span><span class="number">-01</span><span class="number">-10</span> <span class="number">-0.905394</span>  <span class="number">0.282200</span>   <span class="number">3.153474</span>  <span class="number">-0.189584</span> </div><div class="line"><span class="number">10</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-11</span> <span class="number">-0.962155</span> <span class="number">-1.147225</span>   <span class="number">3.353251</span>   <span class="number">1.283288</span> </div><div class="line"><span class="number">11</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-12</span> <span class="number">-1.853063</span> <span class="number">-1.539308</span>   <span class="number">5.246351</span>   <span class="number">0.222400</span> </div><div class="line"><span class="number">12</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-13</span> <span class="number">-3.385665</span> <span class="number">-2.982384</span>   <span class="number">3.952838</span>   <span class="number">0.319281</span> </div><div class="line"><span class="number">13</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-14</span> <span class="number">-4.411986</span> <span class="number">-2.914887</span>   <span class="number">4.775386</span>   <span class="number">0.597495</span> </div><div class="line"><span class="number">14</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-15</span> <span class="number">-5.938706</span> <span class="number">-3.437068</span>   <span class="number">6.882886</span>   <span class="number">1.105879</span> </div><div class="line"><span class="number">15</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-16</span> <span class="number">-6.537699</span> <span class="number">-1.947668</span>   <span class="number">8.142251</span>   <span class="number">0.948407</span> </div><div class="line"><span class="number">16</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-17</span> <span class="number">-6.786304</span> <span class="number">-2.735740</span>   <span class="number">8.484593</span>   <span class="number">1.034685</span> </div><div class="line"><span class="number">17</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-18</span> <span class="number">-7.145344</span> <span class="number">-1.666703</span>   <span class="number">9.420653</span>  <span class="number">-0.919941</span> </div><div class="line"><span class="number">18</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-19</span> <span class="number">-8.283291</span>  <span class="number">0.101307</span>  <span class="number">10.654933</span>  <span class="number">-0.936284</span> </div><div class="line"><span class="number">19</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-20</span> <span class="number">-8.330414</span>  <span class="number">0.820054</span>  <span class="number">11.207165</span>  <span class="number">-2.622354</span> </div><div class="line"><span class="number">20</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-21</span> <span class="number">-7.942291</span>  <span class="number">1.559753</span>   <span class="number">9.201008</span>  <span class="number">-2.923220</span> </div><div class="line"><span class="number">21</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-22</span> <span class="number">-4.675543</span>  <span class="number">2.337827</span>  <span class="number">10.364670</span>  <span class="number">-3.112916</span> </div><div class="line"><span class="number">22</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-23</span> <span class="number">-5.774614</span>  <span class="number">0.408297</span>   <span class="number">9.441821</span>  <span class="number">-2.040018</span> </div><div class="line"><span class="number">23</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-24</span> <span class="number">-5.993547</span> <span class="number">-0.480329</span>  <span class="number">10.311053</span>   <span class="number">0.852373</span> </div><div class="line"><span class="number">24</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-25</span> <span class="number">-4.137167</span>  <span class="number">0.099883</span>  <span class="number">10.224100</span>   <span class="number">0.576367</span> </div><div class="line"><span class="number">25</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-26</span> <span class="number">-2.866354</span> <span class="number">-0.772702</span>  <span class="number">11.812000</span>   <span class="number">1.671981</span> </div><div class="line"><span class="number">26</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-27</span> <span class="number">-1.764316</span> <span class="number">-2.534161</span>  <span class="number">11.634361</span>   <span class="number">1.638750</span> </div><div class="line"><span class="number">27</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-28</span> <span class="number">-3.220852</span> <span class="number">-3.353006</span>  <span class="number">11.399995</span>  <span class="number">-0.562762</span> </div><div class="line"><span class="number">28</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-29</span> <span class="number">-0.889241</span> <span class="number">-2.794083</span>  <span class="number">10.445614</span>   <span class="number">0.473105</span> </div><div class="line"><span class="number">29</span>   <span class="number">2000</span><span class="number">-01</span><span class="number">-30</span>  <span class="number">0.428342</span> <span class="number">-3.857681</span>  <span class="number">10.930199</span>  <span class="number">-0.118981</span> </div><div class="line">..          ...       ...       ...        ...        ... </div><div class="line"><span class="number">970</span>  <span class="number">2002</span><span class="number">-08</span><span class="number">-28</span> <span class="number">-2.853884</span> <span class="number">-2.041226</span>  <span class="number">28.387424</span>  <span class="number">17.129529</span> </div><div class="line"><span class="number">971</span>  <span class="number">2002</span><span class="number">-08</span><span class="number">-29</span> <span class="number">-5.058352</span>  <span class="number">0.041153</span>  <span class="number">28.095666</span>  <span class="number">16.654813</span> </div><div class="line"><span class="number">972</span>  <span class="number">2002</span><span class="number">-08</span><span class="number">-30</span> <span class="number">-4.478272</span> <span class="number">-1.613275</span>  <span class="number">26.989764</span>  <span class="number">17.653338</span> </div><div class="line"><span class="number">973</span>  <span class="number">2002</span><span class="number">-08</span><span class="number">-31</span> <span class="number">-2.815382</span> <span class="number">-2.764649</span>  <span class="number">26.197949</span>  <span class="number">16.442647</span> </div><div class="line"><span class="number">974</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-01</span> <span class="number">-2.621575</span> <span class="number">-2.785604</span>  <span class="number">28.007243</span>  <span class="number">14.962121</span> </div><div class="line"><span class="number">975</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-02</span> <span class="number">-2.476145</span> <span class="number">-3.128888</span>  <span class="number">27.541079</span>  <span class="number">12.853070</span> </div><div class="line"><span class="number">976</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-03</span> <span class="number">-0.483923</span> <span class="number">-3.061629</span>  <span class="number">27.130099</span>  <span class="number">13.401077</span> </div><div class="line"><span class="number">977</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-04</span> <span class="number">-0.885055</span> <span class="number">-2.059356</span>  <span class="number">26.139260</span>  <span class="number">12.725815</span> </div><div class="line"><span class="number">978</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-05</span> <span class="number">-3.438688</span> <span class="number">-3.060238</span>  <span class="number">26.267361</span>  <span class="number">13.601928</span> </div><div class="line"><span class="number">979</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-06</span> <span class="number">-3.646110</span> <span class="number">-2.908451</span>  <span class="number">27.639157</span>  <span class="number">13.749199</span> </div><div class="line"><span class="number">980</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-07</span> <span class="number">-3.742097</span> <span class="number">-5.843492</span>  <span class="number">27.138204</span>  <span class="number">14.621900</span> </div><div class="line"><span class="number">981</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-08</span> <span class="number">-4.367495</span> <span class="number">-5.523435</span>  <span class="number">26.429433</span>  <span class="number">14.372776</span> </div><div class="line"><span class="number">982</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-09</span> <span class="number">-6.481100</span> <span class="number">-7.691100</span>  <span class="number">26.325775</span>  <span class="number">14.060133</span> </div><div class="line"><span class="number">983</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-10</span> <span class="number">-4.406432</span> <span class="number">-5.925796</span>  <span class="number">25.808105</span>  <span class="number">13.717117</span> </div><div class="line"><span class="number">984</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-11</span> <span class="number">-5.747746</span> <span class="number">-6.226884</span>  <span class="number">26.334882</span>  <span class="number">13.539911</span> </div><div class="line"><span class="number">985</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-12</span> <span class="number">-5.075507</span> <span class="number">-5.976265</span>  <span class="number">25.582403</span>  <span class="number">13.955776</span> </div><div class="line"><span class="number">986</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-13</span> <span class="number">-5.957833</span> <span class="number">-4.514403</span>  <span class="number">26.154568</span>  <span class="number">15.948706</span> </div><div class="line"><span class="number">987</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-14</span> <span class="number">-4.822016</span> <span class="number">-3.510714</span>  <span class="number">26.770429</span>  <span class="number">14.903106</span> </div><div class="line"><span class="number">988</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-15</span> <span class="number">-5.413908</span> <span class="number">-3.678965</span>  <span class="number">29.255640</span>  <span class="number">15.903795</span> </div><div class="line"><span class="number">989</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-16</span> <span class="number">-7.305733</span> <span class="number">-4.970404</span>  <span class="number">30.726133</span>  <span class="number">17.075891</span> </div><div class="line"><span class="number">990</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-17</span> <span class="number">-6.921962</span> <span class="number">-3.342561</span>  <span class="number">32.499852</span>  <span class="number">15.309124</span> </div><div class="line"><span class="number">991</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-18</span> <span class="number">-7.650811</span> <span class="number">-3.539989</span>  <span class="number">31.823857</span>  <span class="number">15.100428</span> </div><div class="line"><span class="number">992</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-19</span> <span class="number">-7.680999</span> <span class="number">-2.289270</span>  <span class="number">31.098525</span>  <span class="number">12.891011</span> </div><div class="line"><span class="number">993</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-20</span> <span class="number">-7.849671</span> <span class="number">-1.712562</span>  <span class="number">31.364746</span>  <span class="number">13.909086</span> </div><div class="line"><span class="number">994</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-21</span> <span class="number">-8.739466</span> <span class="number">-2.122690</span>  <span class="number">32.004201</span>  <span class="number">14.095981</span> </div><div class="line"><span class="number">995</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-22</span> <span class="number">-8.740361</span> <span class="number">-0.656488</span>  <span class="number">29.674406</span>  <span class="number">12.590248</span> </div><div class="line"><span class="number">996</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-23</span> <span class="number">-6.309331</span> <span class="number">-0.986256</span>  <span class="number">30.370786</span>  <span class="number">13.450941</span> </div><div class="line"><span class="number">997</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-24</span> <span class="number">-6.205371</span> <span class="number">-0.419119</span>  <span class="number">30.260205</span>  <span class="number">12.028273</span> </div><div class="line"><span class="number">998</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-25</span> <span class="number">-7.573782</span> <span class="number">-2.492400</span>  <span class="number">31.063298</span>  <span class="number">12.361099</span> </div><div class="line"><span class="number">999</span>  <span class="number">2002</span><span class="number">-09</span><span class="number">-26</span> <span class="number">-7.317950</span> <span class="number">-2.840246</span>  <span class="number">31.560766</span>  <span class="number">12.502660</span></div></pre></td></tr></table></figure>
<h4 id="HDF5"><a href="#HDF5" class="headerlink" title="HDF5"></a>HDF5</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">129</span>]: df.to_hdf(<span class="string">'foo.h5'</span>,<span class="string">'df'</span>)</div><div class="line"></div><div class="line">In [<span class="number">130</span>]: pd.read_hdf(<span class="string">'foo.h5'</span>,<span class="string">'df'</span>)</div></pre></td></tr></table></figure>
<h4 id="Excel"><a href="#Excel" class="headerlink" title="Excel"></a>Excel</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">131</span>]: df.to_excel(<span class="string">'foo.xlsx'</span>, sheet_name=<span class="string">'Sheet1'</span>)</div><div class="line"></div><div class="line">In [<span class="number">132</span>]: pd.read_excel(<span class="string">'foo.xlsx'</span>, <span class="string">'Sheet1'</span>, index_col=<span class="keyword">None</span>, na_values=[<span class="string">'NA'</span>])</div></pre></td></tr></table></figure>
<h3 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h3><p>如下，不能直接把返回值当作布尔值。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">131</span>]: <span class="keyword">if</span> pd.Series([<span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">False</span>]):</div><div class="line">     ...:     print(<span class="string">'I was true'</span>)</div><div class="line">     ...:</div><div class="line">---------------------------------------------------------------------------</div><div class="line">ValueError                                Traceback (most recent call last)</div><div class="line">&lt;ipython-input<span class="number">-131</span>-ec15f6b92216&gt; <span class="keyword">in</span> &lt;module&gt;()</div><div class="line">----&gt; 1 if pd.Series([False, True, False]):</div><div class="line">      <span class="number">2</span>     print(<span class="string">'I was true'</span>)</div><div class="line">      <span class="number">3</span></div><div class="line"></div><div class="line">c:\python34\lib\site-packages\pandas\core\generic.py <span class="keyword">in</span> __nonzero__(self)</div><div class="line">    <span class="number">953</span>         <span class="keyword">raise</span> ValueError(<span class="string">"The truth value of a &#123;0&#125; is ambiguous. "</span></div><div class="line">    <span class="number">954</span>                          <span class="string">"Use a.empty, a.bool(), a.item(), a.any() or a.all()."</span></div><div class="line">--&gt; 955                          .format(self.__class__.__name__))</div><div class="line">    <span class="number">956</span></div><div class="line">    <span class="number">957</span>     __bool__ = __nonzero__</div><div class="line"></div><div class="line">ValueError: The truth value of a Series <span class="keyword">is</span> ambiguous. Use a.empty, a.bool(), a.item(), a.any() <span class="keyword">or</span> a.all().</div></pre></td></tr></table></figure></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://pandas.pydata.org/pandas-docs/stable/10min.html" target="_blank" rel="external">pandas十分钟入门</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://arvin-he.github.io/2017/06/08/python-numpy-2017-06-08/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arvin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple & Freedom">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/08/python-numpy-2017-06-08/" itemprop="url">Python之Numpy使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-08T09:34:41+08:00">
                2017-06-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Numpy相关介绍"><a href="#Numpy相关介绍" class="headerlink" title="Numpy相关介绍"></a>Numpy相关介绍</h3><p>NumPy 是一个 Python 包。 它代表 “Numeric Python”。 它是一个由多维数组对象和用于处理数组的例程集合组成的库。<br>使用NumPy，开发人员可以执行以下操作：</p>
<ul>
<li>数组的算数和逻辑运算。</li>
<li>傅立叶变换和用于图形操作的例程。</li>
<li>与线性代数有关的操作, NumPy 拥有线性代数和随机数生成的内置函数。</li>
</ul>
<p>NumPy 通常与 SciPy（Scientific Python）和 Matplotlib（绘图库）一起使用。 这种组合广泛用于替代 MatLab，是一个流行的技术计算平台, 此外NumPy 是开源的.</p>
<h3 id="Numpy安装"><a href="#Numpy安装" class="headerlink" title="Numpy安装"></a>Numpy安装</h3><p>在命令行窗口,输入:<code>pip install numpy</code>, 回车后就自动安装.</p>
<h3 id="NumPy-之-Ndarray-对象"><a href="#NumPy-之-Ndarray-对象" class="headerlink" title="NumPy 之 Ndarray 对象"></a>NumPy 之 Ndarray 对象</h3><p>NumPy 中定义的最重要的对象是称为 ndarray 的 N 维数组类型。<br>它描述相同类型的元素集合。 可以使用基于零的索引访问集合中的项目。<br>基本的ndarray是使用 NumPy 中的数组函数创建的, ndarray 对象由计算机内存中的一维连续区域组成，带有将每个元素映射到内存块中某个位置的索引方案。 内存块以按行（C 风格）或按列（FORTRAN 或 MatLab 风格）的方式保存元素。</p>
<p><code>numpy.array(object, dtype = None, copy = True, order = None, subok = False, ndmin = 0)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">object 任何暴露数组接口方法的对象都会返回一个数组或任何（嵌套）序列。</div><div class="line">dtype 数组的所需数据类型，可选。</div><div class="line">copy 可选，默认为true，对象是否被复制。</div><div class="line">order C（按行）、F（按列）或A（任意，默认）。</div><div class="line">subok 默认情况下，返回的数组被强制为基类数组。 如果为true，则返回子类。</div><div class="line">ndimin 指定返回数组的最小维数。</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 最小维度  </span></div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np </div><div class="line">a = np.array([<span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>], ndmin =  <span class="number">2</span>)</div><div class="line">b = np.array([<span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>], dtype = complex)  </div><div class="line">print(a)</div><div class="line">print(b)</div><div class="line"></div><div class="line">[[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]]</div><div class="line">[ <span class="number">1.</span>+<span class="number">0.j</span>,  <span class="number">2.</span>+<span class="number">0.j</span>,  <span class="number">3.</span>+<span class="number">0.j</span>]</div></pre></td></tr></table></figure>
<h3 id="NumPy的数据类型"><a href="#NumPy的数据类型" class="headerlink" title="NumPy的数据类型"></a>NumPy的数据类型</h3><p>NumPy 支持比 Python 更多种类的数值类型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">bool_ 存储为一个字节的布尔值（真或假）</div><div class="line">int_ 默认整数，相当于 C 的long，通常为int32或int64</div><div class="line">intc 相当于 C 的int，通常为int32或int64</div><div class="line">intp 用于索引的整数，相当于 C 的size_t，通常为int32或int64</div><div class="line">int8 字节（-128 ~ 127）</div><div class="line">int16 16 位整数（-32768 ~ 32767）</div><div class="line">int32 32 位整数（-2147483648 ~ 2147483647）</div><div class="line">int64 64 位整数（-9223372036854775808 ~ 9223372036854775807）</div><div class="line">uint8 8 位无符号整数（0 ~ 255）</div><div class="line">uint16 16 位无符号整数（0 ~ 65535）</div><div class="line">uint32 32 位无符号整数（0 ~ 4294967295）</div><div class="line">uint64 64 位无符号整数（0 ~ 18446744073709551615）</div><div class="line">float_ float64的简写</div><div class="line">float16 半精度浮点：符号位，5 位指数，10 位尾数</div><div class="line">float32 单精度浮点：符号位，8 位指数，23 位尾数</div><div class="line">float64 双精度浮点：符号位，11 位指数，52 位尾数</div><div class="line">complex_ complex128的简写</div><div class="line">complex64 复数，由两个 32 位浮点表示（实部和虚部）</div><div class="line">complex128 复数，由两个 64 位浮点表示（实部和虚部）</div></pre></td></tr></table></figure></p>
<h3 id="数据类型对象-dtype"><a href="#数据类型对象-dtype" class="headerlink" title="数据类型对象 (dtype)"></a>数据类型对象 (dtype)</h3><p>数据类型对象描述了对应于数组的固定内存块的解释，取决于以下方面：</p>
<ul>
<li>数据类型（整数、浮点或者 Python 对象）</li>
<li>数据大小</li>
<li>字节序（小端或大端）</li>
<li>在结构化类型的情况下，字段的名称，每个字段的数据类型，和每个字段占用的内存块部分。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">numpy.dtype(object, align, copy)</div><div class="line">Object：被转换为数据类型的对象。</div><div class="line">Align：如果为true，则向字段添加间隔，使其类似 C 的结构体。</div><div class="line">Copy ? 生成dtype对象的新副本，如果为flase，结果是内建数据类型对象的引用。</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 使用数组标量类型  </span></div><div class="line"><span class="comment">#int8，int16，int32，int64 可替换为等价的字符串 'i1'，'i2'，'i4'，以及其他。  </span></div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np </div><div class="line">dt = np.dtype(np.int32)  </div><div class="line">dt2 = np.dtype(<span class="string">'i4'</span>) </div><div class="line"><span class="comment"># 使用端号标记</span></div><div class="line">dt3 = np.dtype(<span class="string">'&gt;i4'</span>)  </div><div class="line">print(dt)</div><div class="line">print(dt2)</div><div class="line">print(dt3)</div><div class="line"></div><div class="line">int32</div><div class="line">int32</div><div class="line">&gt;i4</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 首先创建结构化数据类型。  </span></div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np </div><div class="line">dt = np.dtype([(<span class="string">'age'</span>,np.int8)])</div><div class="line"><span class="comment"># 将其应用于 ndarray 对象  </span></div><div class="line">a = np.array([(<span class="number">10</span>,),(<span class="number">20</span>,),(<span class="number">30</span>,)], dtype = dt) </div><div class="line"></div><div class="line">student = np.dtype([(<span class="string">'name'</span>,<span class="string">'S20'</span>),  (<span class="string">'age'</span>,  <span class="string">'i1'</span>),  (<span class="string">'marks'</span>,  <span class="string">'f4'</span>)]) </div><div class="line">stu = np.array([(<span class="string">'abc'</span>,  <span class="number">21</span>,  <span class="number">50</span>),(<span class="string">'xyz'</span>,  <span class="number">18</span>,  <span class="number">75</span>)], dtype = student)  </div><div class="line"></div><div class="line">print(dt)</div><div class="line">print(a)</div><div class="line"><span class="comment"># 名称可用于访问 age 列的内容  </span></div><div class="line">print(a[<span class="string">'age'</span>])</div><div class="line">print(stu)</div><div class="line"></div><div class="line"><span class="comment"># 输出结果</span></div><div class="line">[(<span class="string">'age'</span>, <span class="string">'i1'</span>)]</div><div class="line">[(<span class="number">10</span>,) (<span class="number">20</span>,) (<span class="number">30</span>,)]</div><div class="line">[<span class="number">10</span> <span class="number">20</span> <span class="number">30</span>]</div><div class="line">[(<span class="string">'abc'</span>, <span class="number">21</span>, <span class="number">50.0</span>), (<span class="string">'xyz'</span>, <span class="number">18</span>, <span class="number">75.0</span>)]</div></pre></td></tr></table></figure>
<p>每个内建类型都有一个唯一定义它的字符代码：<br>‘b’：布尔值<br>‘i’：符号整数<br>‘u’：无符号整数<br>‘f’：浮点<br>‘c’：复数浮点<br>‘m’：时间间隔<br>‘M’：日期时间<br>‘O’：Python 对象<br>‘S’, ‘a’：字节串<br>‘U’：Unicode<br>‘V’：原始数据（void）</p>
<h3 id="NumPy-数组属性"><a href="#NumPy-数组属性" class="headerlink" title="NumPy - 数组属性"></a>NumPy - 数组属性</h3><p>ndarray.shape : 返回一个包含数组维度的元组，可以用于调整数组大小<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np </div><div class="line">a = np.array([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]])  </div><div class="line"></div><div class="line">b = np.array([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]]) </div><div class="line"><span class="comment"># 调整数组大小 </span></div><div class="line">b.shape = (<span class="number">3</span>,<span class="number">2</span>)</div><div class="line">c = a.reshape(<span class="number">3</span>,<span class="number">2</span>)</div><div class="line">print(a.shape)</div><div class="line">print(b)</div><div class="line">print(c)</div><div class="line"><span class="comment"># 输出</span></div><div class="line">(<span class="number">2</span>, <span class="number">3</span>)</div><div class="line"></div><div class="line">[[<span class="number">1</span>, <span class="number">2</span>] </div><div class="line"> [<span class="number">3</span>, <span class="number">4</span>] </div><div class="line"> [<span class="number">5</span>, <span class="number">6</span>]]</div><div class="line"></div><div class="line">[[<span class="number">1</span>, <span class="number">2</span>] </div><div class="line"> [<span class="number">3</span>, <span class="number">4</span>] </div><div class="line"> [<span class="number">5</span>, <span class="number">6</span>]]</div></pre></td></tr></table></figure></p>
<p>ndarray.ndim<br>返回数组的维数。<br>numpy.itemsize<br>返回数组中每个元素的字节单位长度。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line">In [<span class="number">5</span>]: b = np.arange(<span class="number">24</span>)                                                </div><div class="line">                                                                         </div><div class="line">In [<span class="number">6</span>]: print(b)                                                         </div><div class="line">[ <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">16</span> <span class="number">17</span> <span class="number">18</span> <span class="number">19</span> <span class="number">20</span> <span class="number">21</span> <span class="number">22</span> <span class="number">23</span>]</div><div class="line">                                                                         </div><div class="line">In [<span class="number">7</span>]: c = b.reshape(<span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>)                                           </div><div class="line">                                                                         </div><div class="line">In [<span class="number">8</span>]: print(c)                                                         </div><div class="line">[[[ <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span>]                                                             </div><div class="line">  [ <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>]                                                             </div><div class="line">  [ <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>]                                                             </div><div class="line">  [ <span class="number">9</span> <span class="number">10</span> <span class="number">11</span>]]                                                            </div><div class="line">                                                                         </div><div class="line"> [[<span class="number">12</span> <span class="number">13</span> <span class="number">14</span>]                                                             </div><div class="line">  [<span class="number">15</span> <span class="number">16</span> <span class="number">17</span>]                                                             </div><div class="line">  [<span class="number">18</span> <span class="number">19</span> <span class="number">20</span>]                                                             </div><div class="line">  [<span class="number">21</span> <span class="number">22</span> <span class="number">23</span>]]]                                                           </div><div class="line">                                                                         </div><div class="line">In [<span class="number">9</span>]: print(c.ndim)                                                    </div><div class="line"><span class="number">3</span>    </div><div class="line"></div><div class="line">In [<span class="number">10</span>]: x = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>], dtype = np.int8)</div><div class="line"></div><div class="line">In [<span class="number">11</span>]: print(x.itemsize)</div><div class="line"><span class="number">1</span></div></pre></td></tr></table></figure>
<p>numpy.flags: 返回了它们的当前标志</p>
<ol>
<li>C_CONTIGUOUS (C) 数组位于单一的、C 风格的连续区段内</li>
<li>F_CONTIGUOUS (F) 数组位于单一的、Fortran 风格的连续区段内</li>
<li>OWNDATA (O) 数组的内存从其它对象处借用</li>
<li>WRITEABLE (W) 数据区域可写入。 将它设置为flase会锁定数据，使其只读</li>
<li>ALIGNED (A) 数据和任何元素会为硬件适当对齐</li>
<li>UPDATEIFCOPY (U) 这个数组是另一数组的副本。当这个数组释放时，源数组会由这个数组中的元素更新</li>
</ol>
<h3 id="NumPy-数组创建例程"><a href="#NumPy-数组创建例程" class="headerlink" title="NumPy - 数组创建例程"></a>NumPy - 数组创建例程</h3><p>numpy.empty<br>它创建指定形状和dtype的未初始化数组。 它使用以下构造函数：<code>numpy.empty(shape, dtype = float, order = &#39;C&#39;)</code><br><strong>注意：</strong>数组元素为随机值，因为它们未初始化。<br>numpy.zeros<br>返回特定大小，以 0 填充的新数组。 <code>numpy.zeros(shape, dtype = float, order = &#39;C&#39;)</code><br>numpy.ones<br>返回特定大小，以 1 填充的新数组。 <code>numpy.ones(shape, dtype = None, order = &#39;C&#39;)</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">In [<span class="number">2</span>]: x = np.empty([<span class="number">3</span>,<span class="number">2</span>], dtype=int)</div><div class="line"></div><div class="line">In [<span class="number">3</span>]: print(x)</div><div class="line">[[<span class="number">64618546</span> <span class="number">64654448</span>]</div><div class="line"> [<span class="number">64655120</span> <span class="number">64654288</span>]</div><div class="line"> [<span class="number">64654960</span> <span class="number">64654864</span>]]</div><div class="line"></div><div class="line">In [<span class="number">4</span>]: y = np.zeros(<span class="number">5</span>)</div><div class="line"></div><div class="line">In [<span class="number">5</span>]: print(y)</div><div class="line">[ <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>  <span class="number">0.</span>]</div><div class="line"></div><div class="line"><span class="comment"># 自定义类型</span></div><div class="line">In [<span class="number">6</span>]: a = np.zeros((<span class="number">2</span>,<span class="number">2</span>), dtype =  [(<span class="string">'x'</span>,  <span class="string">'i4'</span>),  (<span class="string">'y'</span>,  <span class="string">'i4'</span>)])</div><div class="line"></div><div class="line">In [<span class="number">7</span>]: print(a)</div><div class="line">[[(<span class="number">0</span>, <span class="number">0</span>) (<span class="number">0</span>, <span class="number">0</span>)]</div><div class="line"> [(<span class="number">0</span>, <span class="number">0</span>) (<span class="number">0</span>, <span class="number">0</span>)]]</div><div class="line"></div><div class="line">In [<span class="number">8</span>]: b = np.ones(<span class="number">5</span>)</div><div class="line"></div><div class="line">In [<span class="number">9</span>]: print(b)</div><div class="line">[ <span class="number">1.</span>  <span class="number">1.</span>  <span class="number">1.</span>  <span class="number">1.</span>  <span class="number">1.</span>]</div></pre></td></tr></table></figure></p>
<h3 id="NumPy来自现有数据的数组"><a href="#NumPy来自现有数据的数组" class="headerlink" title="NumPy来自现有数据的数组"></a>NumPy来自现有数据的数组</h3><p>numpy.asarray<br>将 Python 序列转换为ndarray。 <code>numpy.asarray(a, dtype = None, order = None)</code><br>其中: a 任意形式的输入参数，比如列表、列表的元组、元组、元组的元组、元组的列表<br>numpy.frombuffer<br>此函数将缓冲区解释为一维数组。 暴露缓冲区接口的任何对象都用作参数来返回ndarray。<code>numpy.frombuffer(buffer, dtype = float, count = -1, offset = 0)</code></p>
<ol>
<li>buffer 任何暴露缓冲区接口的对象</li>
<li>dtype 返回数组的数据类型，默认为float</li>
<li>count 需要读取的数据数量，默认为-1，读取所有数据</li>
<li>offset 需要读取的起始位置，默认为0</li>
</ol>
<p>numpy.fromiter<br>从任何可迭代对象构建一个ndarray对象，返回一个新的一维数组。numpy.fromiter(iterable, dtype, count = -1)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">12</span>]: s = <span class="string">'Hello World'</span></div><div class="line"></div><div class="line">In [<span class="number">13</span>]: c = np.frombuffer(s, dtype=<span class="string">'S1'</span>)</div><div class="line">---------------------------------------------------------------------------</div><div class="line">AttributeError                            Traceback (most recent call last)</div><div class="line">&lt;ipython-input<span class="number">-13</span>-e77d207ef97e&gt; <span class="keyword">in</span> &lt;module&gt;()</div><div class="line">----&gt; 1 c = np.frombuffer(s, dtype='S1')</div><div class="line"></div><div class="line">AttributeError: <span class="string">'str'</span> object has no attribute <span class="string">'__buffer__'</span></div><div class="line"></div><div class="line">In [<span class="number">15</span>]: c = np.fromiter(s, dtype=<span class="string">'S1'</span>)</div><div class="line"></div><div class="line">In [<span class="number">16</span>]: print(c)</div><div class="line">[<span class="string">b'H'</span> <span class="string">b'e'</span> <span class="string">b'l'</span> <span class="string">b'l'</span> <span class="string">b'o'</span> <span class="string">b' '</span> <span class="string">b'W'</span> <span class="string">b'o'</span> <span class="string">b'r'</span> <span class="string">b'l'</span> <span class="string">b'd'</span>]</div></pre></td></tr></table></figure></p>
<h3 id="NumPy来自数值范围的数组"><a href="#NumPy来自数值范围的数组" class="headerlink" title="NumPy来自数值范围的数组"></a>NumPy来自数值范围的数组</h3><p>numpy.arange<br>返回ndarray对象，包含给定范围内的等间隔值。<code>numpy.arange(start, stop, step, dtype)</code><br>numpy.linspace<br>指定了范围之间的均匀间隔数量，而不是步长. <code>numpy.linspace(start, stop, num, endpoint, retstep, dtype)</code></p>
<ol>
<li>start 序列的起始值</li>
<li>stop 序列的终止值，如果endpoint为true，该值包含于序列中</li>
<li>num 要生成的等间隔样例数量，默认为50</li>
<li>endpoint 序列中是否包含stop值，默认为ture</li>
<li>retstep 如果为true，返回样例，以及连续数字之间的步长</li>
<li>dtype 输出ndarray的数据类型</li>
</ol>
<p>numpy.logspace<br>返回一个ndarray对象，其中包含在对数刻度上均匀分布的数字。 刻度的开始和结束端点是某个底数的幂，通常为 10。<code>numpy.logscale(start, stop, num, endpoint, base, dtype)</code></p>
<ol>
<li>start 起始值是base ** start</li>
<li>stop 终止值是base ** stop</li>
<li>num 范围内的数值数量，默认为50</li>
<li>endpoint 如果为true，终止值包含在输出数组当中</li>
<li>base 对数空间的底数，默认为10</li>
<li>dtype 输出数组的数据类型，如果没有提供，则取决于其它参数</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">17</span>]: d = np.linspace(<span class="number">10</span>, <span class="number">20</span>, <span class="number">5</span>)</div><div class="line">In [<span class="number">18</span>]: print(d)</div><div class="line">[ <span class="number">10.</span>   <span class="number">12.5</span>  <span class="number">15.</span>   <span class="number">17.5</span>  <span class="number">20.</span> ]</div><div class="line"></div><div class="line">In [<span class="number">19</span>]: e = np.linspace(<span class="number">10</span>, <span class="number">20</span>, <span class="number">5</span>, endpoint=<span class="keyword">False</span>)</div><div class="line">In [<span class="number">20</span>]: print(e)</div><div class="line">[ <span class="number">10.</span>  <span class="number">12.</span>  <span class="number">14.</span>  <span class="number">16.</span>  <span class="number">18.</span>]</div><div class="line"></div><div class="line">In [<span class="number">22</span>]: f = np.linspace(<span class="number">10</span>, <span class="number">20</span>, <span class="number">5</span>, retstep=<span class="keyword">True</span>)</div><div class="line">In [<span class="number">23</span>]: print(f)</div><div class="line">(array([ <span class="number">10.</span> ,  <span class="number">12.5</span>,  <span class="number">15.</span> ,  <span class="number">17.5</span>,  <span class="number">20.</span> ]), <span class="number">2.5</span>)</div><div class="line"></div><div class="line"><span class="comment"># 默认底数是 10</span></div><div class="line">In [<span class="number">25</span>]: g = np.logspace(<span class="number">1.0</span>, <span class="number">2.0</span>, num=<span class="number">10</span>)</div><div class="line">In [<span class="number">26</span>]: print(g)</div><div class="line">[  <span class="number">10.</span>           <span class="number">12.91549665</span>   <span class="number">16.68100537</span>   <span class="number">21.5443469</span>    <span class="number">27.82559402</span></div><div class="line">   <span class="number">35.93813664</span>   <span class="number">46.41588834</span>   <span class="number">59.94842503</span>   <span class="number">77.42636827</span>  <span class="number">100.</span>        ]</div><div class="line"></div><div class="line"><span class="comment"># 将对数空间的底数设置为 2</span></div><div class="line">In [<span class="number">29</span>]: a = np.logspace(<span class="number">1</span>, <span class="number">6</span>, num=<span class="number">10</span>, base=<span class="number">2</span>)</div><div class="line">In [<span class="number">30</span>]: print(a)</div><div class="line">[  <span class="number">2.</span>           <span class="number">2.93946898</span>   <span class="number">4.32023896</span>   <span class="number">6.34960421</span>   <span class="number">9.33223232</span></div><div class="line">  <span class="number">13.71590373</span>  <span class="number">20.1587368</span>   <span class="number">29.62799079</span>  <span class="number">43.54528001</span>  <span class="number">64.</span>        ]</div></pre></td></tr></table></figure>
<h3 id="NumPy-切片和索引"><a href="#NumPy-切片和索引" class="headerlink" title="NumPy - 切片和索引"></a>NumPy - 切片和索引</h3><p>单维数组切片和list的切片一样, 下面主要介绍多维数组的切片和索引<br>切片还可以使用省略号（…），来使选择元组的长度与数组的维度相同。 如果在行位置使用省略号，它将返回包含行中元素的ndarray。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">31</span>]: b = np.array([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]])</div><div class="line"></div><div class="line">In [<span class="number">32</span>]: print(b[<span class="number">1</span>:])</div><div class="line">[[<span class="number">4</span> <span class="number">5</span> <span class="number">6</span>]</div><div class="line"> [<span class="number">7</span> <span class="number">8</span> <span class="number">9</span>]]</div><div class="line"></div><div class="line"><span class="comment"># 返回第二列元素的数组</span></div><div class="line">In [<span class="number">33</span>]: print(b[..., <span class="number">1</span>])</div><div class="line">[<span class="number">2</span> <span class="number">5</span> <span class="number">8</span>]</div><div class="line"><span class="comment"># 返回第二行元素的数组</span></div><div class="line">In [<span class="number">34</span>]: print(b[<span class="number">1</span>, ...])</div><div class="line">[<span class="number">4</span> <span class="number">5</span> <span class="number">6</span>]</div><div class="line"><span class="comment"># 返回从第二列向后切片所有元素：</span></div><div class="line">In [<span class="number">36</span>]: print(b[..., <span class="number">1</span>:])</div><div class="line">[[<span class="number">2</span> <span class="number">3</span>]</div><div class="line"> [<span class="number">5</span> <span class="number">6</span>]</div><div class="line"> [<span class="number">8</span> <span class="number">9</span>]]</div></pre></td></tr></table></figure></p>
<h3 id="Numpy高级索引"><a href="#Numpy高级索引" class="headerlink" title="Numpy高级索引"></a>Numpy高级索引</h3><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://blog.csdn.net/wizardforcel/article/details/53932970" target="_blank" rel="external">TutorialsPoint NumPy 教程</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://arvin-he.github.io/2017/06/06/python-asyncio-2017-06-06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arvin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple & Freedom">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/06/python-asyncio-2017-06-06/" itemprop="url">Python之asyncio使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-06T16:00:58+08:00">
                2017-06-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="asyncio简介"><a href="#asyncio简介" class="headerlink" title="asyncio简介"></a>asyncio简介</h3><p>asyncio是Python 3.4版本引入的标准库，直接内置了对异步IO的支持。<br>asyncio的编程模型就是一个消息循环。我们从asyncio模块中直接获取一个EventLoop的引用，然后把需要执行的协程扔到EventLoop中执行，就实现了异步IO。</p>
<p>到了Python 3.5添加了async和await两个关键字，分别用来替换asyncio.coroutine和yield from。自此，协程成为新的语法，而不再是一种生成器类型了。此外,事件循环与协程的引入，可以极大提高高负载下程序的I/O性能。除此之外还增加了async with(异步上下文管理)、async for(异步迭代器)语法。还有在新发布的Python 3.6里面可以用异步生成器了.</p>
<p>当给一个函数添加了async关键字，就会把它变成一个异步函数。<br>async/await是Python提供的异步编程API，而asyncio只是一个利用 async/await API进行异步编程的框架.<br>现存的一些库其实并不能原生的支持asyncio（因为会发生阻塞或者功能不可用），比如requests，<br>如果要写爬虫，配合asyncio的应该用aiohttp，其他的如数据库驱动等各种Python对应的库也都得使用对应的aioXXX版本了。</p>
<p>需要进行协程切换的地方，就需要使用await关键字</p>
<h3 id="同步与异步-阻塞与非阻塞概念"><a href="#同步与异步-阻塞与非阻塞概念" class="headerlink" title="同步与异步/阻塞与非阻塞概念"></a>同步与异步/阻塞与非阻塞概念</h3><h4 id="同步与异步"><a href="#同步与异步" class="headerlink" title="同步与异步"></a>同步与异步</h4><p>同步和异步关注的是消息通信机制 (synchronous communication/ asynchronous communication)<br>所谓同步，就是在发出一个调用时，在没有得到结果之前，该调用就不返回。但是一旦调用返回，就得到返回值了。<br>换句话说，就是由调用者主动等待这个调用的结果。<br>而异步则是相反，调用在发出之后，这个调用就直接返回了，所以没有返回结果。换句话说，当一个异步过程调用发出后，调用者不会立刻得到结果。而是在调用发出后，被调用者通过状态、通知来通知调用者，或通过回调函数处理这个调用。<br>典型的异步编程模型比如Node.js，举个通俗的例子：<br>你打电话问书店老板有没有《分布式系统》这本书，如果是同步通信机制，书店老板会说，你稍等，”我查一下”，然后开始查啊查，等查好了（可能是5秒，也可能是一天）告诉你结果（返回结果）。<br>而异步通信机制，书店老板直接告诉你我查一下啊，查好了打电话给你，然后直接挂电话了（不返回结果）。然后查好了，他会主动打电话给你。在这里老板通过“回电”这种方式来回调。</p>
<h4 id="阻塞与非阻塞"><a href="#阻塞与非阻塞" class="headerlink" title="阻塞与非阻塞"></a>阻塞与非阻塞</h4><p>阻塞和非阻塞关注的是程序在等待调用结果（消息，返回值）时的状态.<br>阻塞调用是指调用结果返回之前，当前线程会被挂起。调用线程只有在得到结果之后才会返回。<br>非阻塞调用指在不能立刻得到结果之前，该调用不会阻塞当前线程。<br>还是上面的例子，<br>你打电话问书店老板有没有《分布式系统》这本书，你如果是阻塞式调用，你会一直把自己“挂起”，直到得到这本书有没有的结果，如果是非阻塞式调用，你不管老板有没有告诉你，你自己先一边去玩了， 当然你也要偶尔过几分钟check一下老板有没有返回结果。<br>在这里阻塞与非阻塞与是否同步异步无关。跟老板通过什么方式回答你结果无关。</p>
<h3 id="asyncio使用"><a href="#asyncio使用" class="headerlink" title="asyncio使用"></a>asyncio使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> asyncio</div><div class="line"><span class="comment"># 将heloo</span></div><div class="line"><span class="meta">@asyncio.coroutine</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">"Hello world!"</span>)</div><div class="line">    <span class="comment"># 异步调用asyncio.sleep(1):</span></div><div class="line">    r = <span class="keyword">yield</span> <span class="keyword">from</span> asyncio.sleep(<span class="number">1</span>)</div><div class="line">    print(<span class="string">"Hello again!"</span>)</div><div class="line"></div><div class="line"><span class="comment"># 获取EventLoop:</span></div><div class="line">loop = asyncio.get_event_loop()</div><div class="line"><span class="comment"># 执行coroutine</span></div><div class="line">loop.run_until_complete(hello())</div><div class="line">loop.close()</div></pre></td></tr></table></figure>
<p><code>@asyncio.coroutine</code>把一个generator标记为coroutine类型，然后，我们就把这个coroutine扔到EventLoop中执行。</p>
<p><code>hello()</code>会首先打印出Hello world!，然后，<code>yield from</code>语法可以让我们方便地调用另一个generator。由于<code>asyncio.sleep()</code>也是一个coroutine，所以线程不会等待<code>asyncio.sleep()</code>，而是直接中断并执行下一个消息循环。当<code>asyncio.sleep()</code>返回时，线程就可以从yield from拿到返回值（此处是None），然后接着执行下一行语句。</p>
<p>把asyncio.sleep(1)看成是一个耗时1秒的IO操作，在此期间，主线程并未等待，而是去执行EventLoop中其他可以执行的coroutine了，因此可以实现并发执行。</p>
<p>我们用Task封装两个coroutine试试：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> threading</div><div class="line"><span class="keyword">import</span> asyncio</div><div class="line"></div><div class="line"><span class="meta">@asyncio.coroutine</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello1</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">'Hello 1 in! (%s)'</span> % threading.currentThread())</div><div class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> asyncio.sleep(<span class="number">1</span>)</div><div class="line">    print(<span class="string">'Hello 1 out! (%s)'</span> % threading.currentThread())</div><div class="line"></div><div class="line">    </div><div class="line"><span class="meta">@asyncio.coroutine</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello2</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">'Hello 2 in! (%s)'</span> % threading.currentThread())</div><div class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> asyncio.sleep(<span class="number">1</span>)</div><div class="line">    print(<span class="string">'Hello 2 out! (%s)'</span> % threading.currentThread())</div><div class="line"></div><div class="line">loop = asyncio.get_event_loop()</div><div class="line">tasks = [hello1(), hello2()]</div><div class="line">loop.run_until_complete(asyncio.wait(tasks))</div><div class="line">loop.close()</div><div class="line"></div><div class="line"></div><div class="line">Hello <span class="number">1</span> <span class="keyword">in</span>! (&lt;_MainThread(MainThread, started <span class="number">6620</span>)&gt;)</div><div class="line">Hello <span class="number">2</span> <span class="keyword">in</span>! (&lt;_MainThread(MainThread, started <span class="number">6620</span>)&gt;)</div><div class="line">Hello <span class="number">1</span> out! (&lt;_MainThread(MainThread, started <span class="number">6620</span>)&gt;)</div><div class="line">Hello <span class="number">2</span> out! (&lt;_MainThread(MainThread, started <span class="number">6620</span>)&gt;)</div></pre></td></tr></table></figure></p>
<p>由打印的当前线程名称可以看出，两个coroutine是由同一个线程并发执行的。<br>如果把asyncio.sleep()换成真正的IO操作，则多个coroutine就可以由一个线程并发执行。</p>
<h3 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h3><p>Python 3.5开始引入了新的语法async和await，可以让coroutine的代码更简洁易读。<br><strong>请注意:</strong>async和await是针对coroutine的新语法,要使用新语法,只需要做两步简单的替换：</p>
<ol>
<li>把@asyncio.coroutine替换为async；</li>
<li>把yield from替换为await。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@asyncio.coroutine</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">"Hello world!"</span>)</div><div class="line">    r = <span class="keyword">yield</span> <span class="keyword">from</span> asyncio.sleep(<span class="number">1</span>)</div><div class="line">    print(<span class="string">"Hello again!"</span>)</div></pre></td></tr></table></figure>
<p>async/await新语法<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">"Hello world!"</span>)</div><div class="line">    r = <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</div><div class="line">    print(<span class="string">"Hello again!"</span>)</div></pre></td></tr></table></figure></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://juejin.im/post/5857b8a98e450a006cb060fc" target="_blank" rel="external">https://juejin.im/post/5857b8a98e450a006cb060fc</a></li>
<li><a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/00144661533005329786387b5684be385062a121e834ac7000" target="_blank" rel="external">廖雪峰教程</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://arvin-he.github.io/2017/06/06/python-gevent-2017-06-06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arvin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple & Freedom">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/06/python-gevent-2017-06-06/" itemprop="url">Python之gevent使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-06T13:08:03+08:00">
                2017-06-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Greenlets"><a href="#Greenlets" class="headerlink" title="Greenlets"></a>Greenlets</h3><p>在gevent中用到的主要模式是Greenlet, 它是以C扩展模块形式接入Python的轻量级协程。 Greenlet全部运行在主程序操作系统进程的内部，但它们被协作式地调度。<strong>在任何时刻，只有一个协程在运行。</strong> 在gevent里面，上下文切换是通过yielding来完成的. 当我们在受限于网络或IO的函数中使用gevent，这些函数会被协作式的调度， gevent的真正能力会得到发挥。Gevent处理了所有的细节， 来保证你的网络库会在可能的时候，隐式交出greenlet上下文的执行权。<br>greenlet具有确定性。在相同配置相同输入的情况下，它们总是 会产生相同的输出。<br>即使gevent通常带有确定性，当开始与如socket或文件等外部服务交互时， 不确定性也可能溜进你的程序中。因此尽管gevent线程是一种“确定的并发”形式， 使用它仍然可能会遇到像使用POSIX线程或进程时遇到的那些问题。涉及并发长期存在的问题就是竞争条件(race condition)。简单来说， 当两个并发线程/进程都依赖于某个共享资源同时都尝试去修改它的时候， 就会出现竞争条件。这会导致资源修改的结果状态依赖于时间和执行顺序。 这是个问题，我们一般会做很多努力尝试避免竞争条件， 因为它会导致整个程序行为变得不确定。最好的办法是始终避免所有全局的状态。全局状态和导入时(import-time)副作用总是会 反咬你一口！</p>
<h3 id="创建Greenlets"><a href="#创建Greenlets" class="headerlink" title="创建Greenlets"></a>创建Greenlets</h3><p>gevent对Greenlet初始化提供了一些封装，最常用的使用模板之一有<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> gevent</div><div class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> Greenlet</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(message, n)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    Each thread will be passed the message, and n arguments</span></div><div class="line"><span class="string">    in its initialization.</span></div><div class="line"><span class="string">    """</span></div><div class="line">    gevent.sleep(n)</div><div class="line">    print(message)</div><div class="line"></div><div class="line"><span class="comment"># Initialize a new Greenlet instance running the named function foo</span></div><div class="line">thread1 = Greenlet.spawn(foo, <span class="string">"Hello"</span>, <span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="comment"># Wrapper for creating and running a new Greenlet from the named</span></div><div class="line"><span class="comment"># function foo, with the passed arguments</span></div><div class="line">thread2 = gevent.spawn(foo, <span class="string">"I live!"</span>, <span class="number">2</span>)</div><div class="line"></div><div class="line"><span class="comment"># Lambda expressions</span></div><div class="line">thread3 = gevent.spawn(<span class="keyword">lambda</span> x: (x+<span class="number">1</span>), <span class="number">2</span>)</div><div class="line"></div><div class="line">threads = [thread1, thread2, thread3]</div><div class="line"></div><div class="line"><span class="comment"># Block until all threads complete.</span></div><div class="line">gevent.joinall(threads)</div><div class="line"></div><div class="line"></div><div class="line">Hello</div><div class="line">I live!</div></pre></td></tr></table></figure></p>
<p>除使用基本的Greenlet类之外，你也可以子类化Greenlet类，重载它的_run方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> gevent</div><div class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> Greenlet</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyGreenlet</span><span class="params">(Greenlet)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, message, n)</span>:</span></div><div class="line">        Greenlet.__init__(self)</div><div class="line">        self.message = message</div><div class="line">        self.n = n</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_run</span><span class="params">(self)</span>:</span></div><div class="line">        print(self.message)</div><div class="line">        gevent.sleep(self.n)</div><div class="line"></div><div class="line">g = MyGreenlet(<span class="string">"Hi there!"</span>, <span class="number">3</span>)</div><div class="line">g.start()</div><div class="line">g.join()</div><div class="line"></div><div class="line">Hi there!</div></pre></td></tr></table></figure>
<h3 id="Greenlet状态"><a href="#Greenlet状态" class="headerlink" title="Greenlet状态"></a>Greenlet状态</h3><p>就像任何其他成段代码，Greenlet也可能以不同的方式运行失败。 Greenlet可能未能成功抛出异常，不能停止运行，或消耗了太多的系统资源。</p>
<p>一个greenlet的状态通常是一个依赖于时间的参数。在greenlet中有一些标志， 让你可以监视它的线程内部状态：</p>
<p>started – Boolean, 指示此Greenlet是否已经启动<br>ready() – Boolean, 指示此Greenlet是否已经停止<br>successful() – Boolean, 指示此Greenlet是否已经停止而且没抛异常<br>value – 任意值, 此Greenlet代码返回的值<br>exception – 异常, 此Greenlet内抛出的未捕获异常</p>
<h3 id="程序停止"><a href="#程序停止" class="headerlink" title="程序停止"></a>程序停止</h3><p>当主程序(main program)收到一个SIGQUIT信号时，不能成功做yield操作的 Greenlet可能会令意外地挂起程序的执行。这导致了所谓的僵尸进程， 它需要在Python解释器之外被kill掉。对此，一个通用的处理模式就是在主程序中监听SIGQUIT信号，在程序退出 调用gevent.shutdown。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> gevent</div><div class="line"><span class="keyword">import</span> signal</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_forever</span><span class="params">()</span>:</span></div><div class="line">    gevent.sleep(<span class="number">1000</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    gevent.signal(signal.SIGQUIT, gevent.shutdown)</div><div class="line">    thread = gevent.spawn(run_forever)</div><div class="line">    thread.join()</div></pre></td></tr></table></figure></p>
<h3 id="超时"><a href="#超时" class="headerlink" title="超时"></a>超时</h3><p>超时是一种对一块代码或一个Greenlet的运行时间的约束。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> gevent</div><div class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> Timeout</div><div class="line"></div><div class="line">seconds = <span class="number">10</span></div><div class="line"></div><div class="line">timeout = Timeout(seconds)</div><div class="line">timeout.start()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">wait</span><span class="params">()</span>:</span></div><div class="line">    gevent.sleep(<span class="number">10</span>)</div><div class="line"></div><div class="line"><span class="keyword">try</span>:</div><div class="line">    gevent.spawn(wait).join()</div><div class="line"><span class="keyword">except</span> Timeout:</div><div class="line">    print(<span class="string">'Could not complete'</span>)</div></pre></td></tr></table></figure></p>
<p>超时类也可以用在上下文管理器(context manager)中, 也就是with语句内。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> gevent</div><div class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> Timeout</div><div class="line"></div><div class="line">time_to_wait = <span class="number">5</span> <span class="comment"># seconds</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TooLong</span><span class="params">(Exception)</span>:</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="keyword">with</span> Timeout(time_to_wait, TooLong):</div><div class="line">    gevent.sleep(<span class="number">10</span>)</div></pre></td></tr></table></figure></p>
<h3 id="猴子补丁-Monkey-patching"><a href="#猴子补丁-Monkey-patching" class="headerlink" title="猴子补丁(Monkey patching)"></a>猴子补丁(Monkey patching)</h3><p>我们现在来到gevent的死角了. 在此之前，我已经避免提到猴子补丁(monkey patching) 以尝试使gevent这个强大的协程模型变得生动有趣，但现在到了讨论猴子补丁的黑色艺术 的时候了。你之前可能注意到我们提到了monkey.patch_socket()这个命令，这个 纯粹副作用命令是用来改变标准socket库的。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> socket</div><div class="line">print(socket.socket)</div><div class="line"></div><div class="line">print(<span class="string">"After monkey patch"</span>)</div><div class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</div><div class="line">monkey.patch_socket()</div><div class="line">print(socket.socket)</div><div class="line"></div><div class="line"><span class="keyword">import</span> select</div><div class="line">print(select.select)</div><div class="line">monkey.patch_select()</div><div class="line">print(<span class="string">"After monkey patch"</span>)</div><div class="line">print(select.select)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> '<span class="title">socket</span>.<span class="title">socket</span>'</span></div><div class="line"><span class="class"><span class="title">After</span> <span class="title">monkey</span> <span class="title">patch</span></span></div><div class="line"><span class="class"><span class="title">class</span> '<span class="title">gevent</span>.<span class="title">socket</span>.<span class="title">socket</span>'</span></div><div class="line"><span class="class"></span></div><div class="line"><span class="class"><span class="title">built</span>-<span class="title">in</span> <span class="title">function</span> <span class="title">select</span></span></div><div class="line"><span class="class"><span class="title">After</span> <span class="title">monkey</span> <span class="title">patch</span></span></div><div class="line"><span class="class"><span class="title">function</span> <span class="title">select</span> <span class="title">at</span> 0<span class="title">x1924de8</span></span></div></pre></td></tr></table></figure></p>
<p>Python的运行环境允许我们在运行时修改大部分的对象，包括模块，类甚至函数。 这是个一般说来令人惊奇的坏主意，因为它创造了“隐式的副作用”，如果出现问题 它很多时候是极难调试的。虽然如此，在极端情况下当一个库需要修改Python本身 的基础行为的时候，猴子补丁就派上用场了。在这种情况下，gevent能够 修改标准库里面大部分的阻塞式系统调用，包括socket、ssl、threading和 select等模块，而变为协作式运行。</p>
<p>例如，Redis的python绑定一般使用常规的tcp socket来与redis-server实例通信。 通过简单地调用gevent.monkey.patch_all()，可以使得redis的绑定协作式的调度 请求，与gevent栈的其它部分一起工作。</p>
<p>这让我们可以将一般不能与gevent共同工作的库结合起来，而不用写哪怕一行代码。 虽然猴子补丁仍然是邪恶的(evil)，但在这种情况下它是“有用的邪恶(useful evil)”。</p>
<h3 id="真实世界的应用"><a href="#真实世界的应用" class="headerlink" title="真实世界的应用"></a>真实世界的应用</h3><p>Gevent ZeroMQ<br>ZeroMQ 被它的作者描述为 “一个表现得像一个并发框架的socket库”。 它是一个非常强大的，为构建并发和分布式应用的消息传递层。</p>
<p>ZeroMQ提供了各种各样的socket原语。最简单的是请求-应答socket对 (Request-Response socket pair)。一个socket有两个方法send和recv， 两者一般都是阻塞操作。但是Travis Cline 的一个杰出的库弥补了这一点，这个库使用gevent.socket来以非阻塞的方式 轮询ZereMQ socket。通过命令：</p>
<p>pip install gevent-zeromq</p>
<p>你可以从PyPi安装gevent-zeremq。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Note: Remember to ``pip install pyzmq gevent_zeromq``</span></div><div class="line"><span class="keyword">import</span> gevent</div><div class="line"><span class="keyword">from</span> gevent_zeromq <span class="keyword">import</span> zmq</div><div class="line"></div><div class="line"><span class="comment"># Global Context</span></div><div class="line">context = zmq.Context()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">server</span><span class="params">()</span>:</span></div><div class="line">    server_socket = context.socket(zmq.REQ)</div><div class="line">    server_socket.bind(<span class="string">"tcp://127.0.0.1:5000"</span>)</div><div class="line"></div><div class="line">    <span class="keyword">for</span> request <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">10</span>):</div><div class="line">        server_socket.send(<span class="string">"Hello"</span>)</div><div class="line">        print(<span class="string">'Switched to Server for %s'</span> % request)</div><div class="line">        <span class="comment"># Implicit context switch occurs here</span></div><div class="line">        server_socket.recv()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">client</span><span class="params">()</span>:</span></div><div class="line">    client_socket = context.socket(zmq.REP)</div><div class="line">    client_socket.connect(<span class="string">"tcp://127.0.0.1:5000"</span>)</div><div class="line"></div><div class="line">    <span class="keyword">for</span> request <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">10</span>):</div><div class="line"></div><div class="line">        client_socket.recv()</div><div class="line">        print(<span class="string">'Switched to Client for %s'</span> % request)</div><div class="line">        <span class="comment"># Implicit context switch occurs here</span></div><div class="line">        client_socket.send(<span class="string">"World"</span>)</div><div class="line"></div><div class="line">publisher = gevent.spawn(server)</div><div class="line">client    = gevent.spawn(client)</div><div class="line"></div><div class="line">gevent.joinall([publisher, client])</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">Switched to Server <span class="keyword">for</span> <span class="number">1</span></div><div class="line">Switched to Client <span class="keyword">for</span> <span class="number">1</span></div><div class="line">Switched to Server <span class="keyword">for</span> <span class="number">2</span></div><div class="line">Switched to Client <span class="keyword">for</span> <span class="number">2</span></div><div class="line">Switched to Server <span class="keyword">for</span> <span class="number">3</span></div><div class="line">Switched to Client <span class="keyword">for</span> <span class="number">3</span></div><div class="line">Switched to Server <span class="keyword">for</span> <span class="number">4</span></div><div class="line">Switched to Client <span class="keyword">for</span> <span class="number">4</span></div><div class="line">Switched to Server <span class="keyword">for</span> <span class="number">5</span></div><div class="line">Switched to Client <span class="keyword">for</span> <span class="number">5</span></div><div class="line">Switched to Server <span class="keyword">for</span> <span class="number">6</span></div><div class="line">Switched to Client <span class="keyword">for</span> <span class="number">6</span></div><div class="line">Switched to Server <span class="keyword">for</span> <span class="number">7</span></div><div class="line">Switched to Client <span class="keyword">for</span> <span class="number">7</span></div><div class="line">Switched to Server <span class="keyword">for</span> <span class="number">8</span></div><div class="line">Switched to Client <span class="keyword">for</span> <span class="number">8</span></div><div class="line">Switched to Server <span class="keyword">for</span> <span class="number">9</span></div><div class="line">Switched to Client <span class="keyword">for</span> <span class="number">9</span></div></pre></td></tr></table></figure>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://xlambda.com/gevent-tutorial/" target="_blank" rel="external">Gevent指南</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://arvin-he.github.io/2017/06/06/node-practice-2017-06-06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arvin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple & Freedom">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/06/node-practice-2017-06-06/" itemprop="url">Node最佳实践1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-06T08:36:55+08:00">
                2017-06-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="编码规范"><a href="#编码规范" class="headerlink" title="编码规范"></a>编码规范</h2><h3 id="回调惯例"><a href="#回调惯例" class="headerlink" title="回调惯例"></a>回调惯例</h3><p>模块应该公开一个错误优先（error-first）的回调接口。<br>就像下面这样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">dragonName, callback</span>) </span>&#123; </div><div class="line">     <span class="comment">// 这里做一些处理工作  </span></div><div class="line">     <span class="keyword">var</span> dragon = createDragon(dragonName);</div><div class="line">     <span class="comment">// 注意, callback第一个参数是 error</span></div><div class="line">     <span class="comment">// 这里传入null</span></div><div class="line">     <span class="comment">// 如果出错则传入错误信息</span></div><div class="line">     <span class="keyword">return</span> callback(<span class="literal">null</span>, dragon);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>确保在回调中检查错误信息, 要更好地弄明白为什么必须这样做，先想办法创建一个会挂掉的例子，然后修复它。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 这个例子是会挂掉的, 我们很快会修复 :)</span></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">readJSON</span>(<span class="params">filePath, callback</span>)</span>&#123;</div><div class="line">     fs.readFile(filePath, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</div><div class="line">          callback(<span class="built_in">JSON</span>.parse(data));</div><div class="line">     &#125;);</div><div class="line">&#125;</div><div class="line">readJSON(<span class="string">'./package.json'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, pkg</span>) </span>&#123; ... &#125;</div></pre></td></tr></table></figure></p>
<p>首要问题是 readJSON函数，在执行过程中出现了错误，而这个函数却没有做任何错误检查。你务必要先做错误检查。<br>改进方案：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 这个例子还是会挂掉 , 很快会修复!</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">readJSON</span>(<span class="params">filePath, callback</span>) </span>&#123;</div><div class="line">    fs.readFile(filePath, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</div><div class="line">     <span class="comment">// 这里我们先判断是否有错误发生    </span></div><div class="line">     <span class="keyword">if</span> (err) &#123;     </div><div class="line">          <span class="comment">// 出现错误，将错误传入回调函数     </span></div><div class="line">          <span class="comment">// 记住: 错误优先（error-first） 回调</span></div><div class="line">          callback(err);    </div><div class="line">     &#125;   </div><div class="line">     <span class="comment">// 如果没有错误则传入null和JSON</span></div><div class="line">     callback(<span class="literal">null</span>, <span class="built_in">JSON</span>.parse(data));</div><div class="line">&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="将回调函数返回"><a href="#将回调函数返回" class="headerlink" title="将回调函数返回"></a>将回调函数返回</h3><p>上面的例子还是存在一个错误，就是如果错误发生了，if  中的表达式不会停止运行，而是继续运行下去。这会导致很多未知的错误。长话短说，务必通过回调函数返回。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 这个例子仍旧会挂掉, 马上修复!</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">readJSON</span>(<span class="params">filePath, callback</span>) </span>&#123;</div><div class="line">    fs.readFile(filePath, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) &#123;</div><div class="line">          <span class="keyword">return</span> callback(err);    </div><div class="line">     &#125;    </div><div class="line"> </div><div class="line">     <span class="keyword">return</span> callback(<span class="literal">null</span>, <span class="built_in">JSON</span>.parse(data));</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="仅在同步代码中使用try-catch"><a href="#仅在同步代码中使用try-catch" class="headerlink" title="仅在同步代码中使用try-catch"></a>仅在同步代码中使用try-catch</h3><p>几乎完美了！但还有一件事，我们必须要小心 JSON.parse。调用JSON.parse 时，如果传入的字符串无法解析成JSON格式，会抛出异常。<br>由于JSON.parse是同步发生的，我们可以用try-catch包装起来。<strong>请注意:</strong>你只能对同步代码块做此操作，对回调函数是不起作用的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 这个例子终于可以正常工作啦 :)</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">readJSON</span>(<span class="params">filePath, callback</span>) </span>&#123;</div><div class="line">fs.readFile(filePath, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</div><div class="line">     <span class="keyword">var</span> parsedJson;</div><div class="line">     <span class="comment">// 处理错误</span></div><div class="line">     <span class="keyword">if</span> (err) &#123;</div><div class="line">          <span class="keyword">return</span> callback(err);</div><div class="line">     &#125;</div><div class="line">     <span class="comment">// 解析JSON</span></div><div class="line">     <span class="keyword">try</span> &#123;</div><div class="line">          parsedJson = <span class="built_in">JSON</span>.parse(data);</div><div class="line">     &#125; <span class="keyword">catch</span> (exception)&#123;</div><div class="line">          <span class="keyword">return</span> callback(exception);</div><div class="line">     &#125;</div><div class="line">     <span class="comment">// 一切工作正常</span></div><div class="line">     <span class="keyword">return</span> callback(<span class="literal">null</span>, parsedJson);</div><div class="line">&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="尽量避免-this-和-new-关键字"><a href="#尽量避免-this-和-new-关键字" class="headerlink" title="尽量避免 this 和 new 关键字"></a>尽量避免 this 和 new 关键字</h3><p>由于Node涉及了大量的回调操作，并且重度使用高阶函数控制流程，因此在Node中绑定一个具体的上下文并不总是行之有效。使用函数式编程风格能避免不少麻烦。<br>当然，在某些情况下原型（prototype）可能更高效，不过只要可能，还是尽量避免它们。</p>
<h3 id="创建微模块"><a href="#创建微模块" class="headerlink" title="创建微模块"></a>创建微模块</h3><p>用unix的方式：</p>
<blockquote>
<p>开发者构建一个程序时应该将其分成很多简单的模块，各部分由定义良好的接口整合,所以问题是局部的，并且能通过替换程序部件的方式在将来的版中加入新特性。<br>不要创建怪兽般的代码，保持简洁，一个模块就只做一件事，但是要做到极致。</p>
</blockquote>
<h3 id="使用良好的异步模式"><a href="#使用良好的异步模式" class="headerlink" title="使用良好的异步模式"></a>使用良好的异步模式</h3><p>使用async异步处理模块。</p>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><p>错误可以分为两部分，操作错误和编程错误。</p>
<p>操作错误<br>精心编写的应用程序中也一样会出现操作错误。因为这些不是 bug ，而是由于操作系统或远程服务导致的，例如：<br>请求超时, 系统内存不足, 远程连接失败, </p>
<p>处理操作错误<br>根据不同运行错误的类型，你可以采用下面的方式处理：<br>尝试解决错误——如果文件丢失，你可以提前创建一个。<br>当处理网络通信时，可以重试操作。<br>把问题告诉客户，表示有些功能不能正常工作——可以用于处理用户输入。<br>如果错误无法在当前条件下解决，终止进程，例如应用程序无法读取它的配置文件。<br>还有，上述的所有处理方式都应该记录日志。</p>
<p>编程错误<br>编程错误都算是bug。下面所列的几条你应该避免，例如：<br>调用异步函数时没有回调。<br>不能读取未定义（undefined）的属性</p>
<p>处理编程错误<br>如果错误属于bug，立刻终止程序，你并不知道应用当前的运行状态。当错误发生时，进程控制系统应该会重启应用程序，例如：supervisord 或者 monit。</p>
<h2 id="工作流技巧"><a href="#工作流技巧" class="headerlink" title="工作流技巧"></a>工作流技巧</h2><h3 id="使用-npm-init-创建新项目"><a href="#使用-npm-init-创建新项目" class="headerlink" title="使用 npm init 创建新项目"></a>使用 npm init 创建新项目</h3><p>init 命令可以帮助你创建应用程序的 package.json 配置文件。文件设置了一些默认配置，之后可以修改。<br>创建一个优秀的项目应该这样开始：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir my-awesome-new-project </div><div class="line">cd my-awesome-new-project </div><div class="line">npm init</div></pre></td></tr></table></figure></p>
<p>指定开始和测试脚本。<br>在你的 package.son 文件中，你可以在 scripts 部分中设置脚本。npm init  默认会创建两个，start 和 test 脚本。可以通过 npm start 和 npm test 命令运行。还有，作为加分项：你可以在这里加入自定义脚本，通过 npm run-script <script_name> 来运行。<br>注意，NPM 会通过设置 $PATH 来扫描 node_modules/.bin 下的所有可执行脚本。这样可以避免安装全局的 NPM 模块。</script_name></p>
<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><p>生产部署和演示部署都应该由环境变量来实现。最主流的实现方式是同时在生产和演示中设置 NODE_ENV变量。<br>根据你设置的环境变量，你可以使用 nconf 模块来加载配置信息。<br>当然，你也可以在你的Node.js 应用中使用其它环境变量设置 process.env，这是一个包含了用户环境的对象。</p>
<h3 id="不要重新发明轮子"><a href="#不要重新发明轮子" class="headerlink" title="不要重新发明轮子"></a>不要重新发明轮子</h3><p>务必优先寻找现成的解决方案。NPM 的库超级多，涵盖了你平时需要的大部分功能。</p>
<h3 id="使用风格指南"><a href="#使用风格指南" class="headerlink" title="使用风格指南"></a>使用风格指南</h3><p>所有的代码都保持统一风格有助于理解大型代码库。其中应该包含缩进、变量命名、最佳实践以及其他方面。<br>如果想看一个实际的例子，请查看  RisingStack 编写的 <a href="https://github.com/RisingStack/node-style-guide" target="_blank" rel="external">Node.js 风格指南</a>。</p>
<h3 id="保持风格一致"><a href="#保持风格一致" class="headerlink" title="保持风格一致"></a>保持风格一致</h3><p>JSCS 是一个JavaScript 编码风格检查工具。将JSCS加入项目对你来说小菜一碟：<code>npm install jscs --save-dev</code>, 你需要做的下一步关键就是在 package.json 文件中加入下面的代码来开启它：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">scripts: &#123;  </div><div class="line">    &quot;jscs&quot;: &quot;jscs index.js&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当然，你也可以加入多个文件、目录检查。但为什么我们仅仅在 package.json 文件中创建了一个自定义的脚本呢？我们是以本地的方式安装 jscs 的，所以在一个系统中可以有多个不同版本。这样还能正常工作是因为NPM 执行时会将 <code>node_modules/.bin</code>  设置到 PATH上。</p>
<p>你可以在<code>.jscsrc</code> 文件中定义验证规则，或者使用预设规则。从这里可以查看可用的预设，通过 <code>--preset=[PRESET_NAME]</code>来应用。</p>
<p>执行 JSHint、JSCS 规则<br>你的构建过程还应该包含 JSHint 和 JSCS，不过在开发者的电脑上运行 <code>pre-commit checks</code> 或许是个不错的主意。<br>要实现这个很简单，你可以使用 pre-commit NPM 库：<code>npm install --save-dev pre-commit</code>, 然后在 package.json 文件中作如下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pre-commit&quot;: [  </div><div class="line">    &quot;jshint&quot;,</div><div class="line">    &quot;jscs&quot;</div><div class="line">],</div></pre></td></tr></table></figure></p>
<p>注意，pre-commit 将会扫描 package.json中script里的所有脚本。开启以后，每次提交时都会自动进行检查。</p>
<h3 id="用JS替换JSON做配置"><a href="#用JS替换JSON做配置" class="headerlink" title="用JS替换JSON做配置"></a>用JS替换JSON做配置</h3><p>我们看到大量的项目都是使用JSON文件做配置的。这是目前最普遍的做法，JS配置文件则能够提供更大的灵活度。所以我们推荐你使用 config.js 文件：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> url =<span class="built_in">require</span>(<span class="string">'url'</span>);</div><div class="line"><span class="keyword">var</span> config = <span class="built_in">module</span>.exports = &#123;&#125;;</div><div class="line"><span class="keyword">var</span> redisToGoConfig;</div><div class="line"> </div><div class="line">config.server = &#123;</div><div class="line">  host: <span class="string">'0.0.0.0'</span>,</div><div class="line">  port: process.env.PORT || <span class="number">3000</span></div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">// look, a comment in the config file!</span></div><div class="line"><span class="comment">// would be tricky in a JSON ;)</span></div><div class="line">config.redis = &#123;</div><div class="line">  host: <span class="string">'localhost'</span>,</div><div class="line">  port: <span class="number">6379</span>,</div><div class="line">  options: &#123;</div><div class="line"> </div><div class="line">&#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="keyword">if</span> (process.env.REDISTOGO_URL) &#123;</div><div class="line">  redisToGoConfig = url.parse(process.env.REDISTOGO_URL);</div><div class="line">  config.redis.port = redisToGoConfig.port;</div><div class="line">  config.redis.host = redisToGoConfig.hostname;</div><div class="line">  config.redis.options.auth_pass = redisToGoConfig.auth.split(<span class="string">':'</span>)[<span class="number">1</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="使用-NODE-PATH"><a href="#使用-NODE-PATH" class="headerlink" title="使用 NODE_PATH"></a>使用 NODE_PATH</h3><p>你是否曾经碰到过下面这种情况？<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myModule = <span class="built_in">require</span>(<span class="string">'../../../../lib/myModule'</span>);</div><div class="line"> </div><div class="line">myModule.doSomething(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>当你的项目结构变得错综复杂，模块依赖会非常麻烦。要解决这个问题有两个办法：</p>
<ol>
<li>把你的模块软链接到node_modules目录下。</li>
<li>使用 NODE_PATH。<br>在RisingStack我们使用 <code>NODE_PATH</code> 的方式，因为将所有相关文件软链接到 node_modules目录需要大量额外的工作，并且在很多操作系统下都不适用。</li>
</ol>
<p>设置 NODE_PATH<br>假设你的项目结构是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">--lib</div><div class="line">  --model</div><div class="line">    --car.js</div><div class="line">  --index.js</div><div class="line">  --package.json</div></pre></td></tr></table></figure></p>
<p>我们可以使用 指向 lib 目录的<code>NODE_PATH</code>，而不是使用相对路径。在我们的package.json 的 <code>start script</code>部分，我们使用<code>NODE_PATH</code>设置并且用<code>npm start</code>运行项目。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Car = <span class="built_in">require</span>(<span class="string">'model/Car'</span>);</div><div class="line"> </div><div class="line"> <span class="built_in">console</span>.log(<span class="string">'I am a Car!'</span>);</div><div class="line"> </div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span>: <span class="string">"node_path"</span>,</div><div class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</div><div class="line">  <span class="string">"description"</span>: <span class="string">""</span>,</div><div class="line">  <span class="string">"main"</span>: <span class="string">"index.js"</span>,</div><div class="line">  <span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"start"</span>: <span class="string">"NODE_PATH=lib node index.js"</span></div><div class="line">&#125;,</div><div class="line">  <span class="string">"author"</span>: <span class="string">""</span>,</div><div class="line">  <span class="string">"license"</span>: <span class="string">"ISC"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h3><p>依赖注入是一种软件设计模式，是指将一到多个依赖（或服务）注入或通过引用的方式引入到需要依赖的对象。 依赖注入在测试中非常有用。使用这个模式你可以轻松模拟模块间的依赖关系。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">userModel</span> (<span class="params">options</span>) </span>&#123;</div><div class="line"><span class="keyword">var</span> db;</div><div class="line"><span class="keyword">if</span> (!options.db) &#123;</div><div class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Options.db is required'</span>);</div><div class="line">&#125;</div><div class="line">db = options.db;</div><div class="line"><span class="keyword">return</span> &#123;</div><div class="line">  create: <span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>&#123;</div><div class="line">    db.query(<span class="string">'INSERT ...'</span>, done);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="built_in">module</span>.exports = userModel;</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> db = <span class="built_in">require</span>(<span class="string">'db'</span>);</div><div class="line"><span class="comment">// do some init here, or connect</span></div><div class="line">db.init();</div><div class="line"> </div><div class="line"><span class="keyword">var</span> userModel = <span class="built_in">require</span>(<span class="string">'User'</span>)(&#123;</div><div class="line">db: db</div><div class="line">&#125;);</div><div class="line"> </div><div class="line">userModel.create(<span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> test = <span class="built_in">require</span>(<span class="string">'tape'</span>);</div><div class="line"><span class="keyword">var</span> userModel = <span class="built_in">require</span>(<span class="string">'User'</span>);</div><div class="line"> </div><div class="line">test(<span class="string">'it creates a user with id'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">t</span>) </span>&#123;</div><div class="line"><span class="keyword">var</span> user = &#123;</div><div class="line">id: <span class="number">1</span></div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> fakeDb = &#123;</div><div class="line">query: <span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>&#123;</div><div class="line">done(<span class="literal">null</span>, user);</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">userModel(&#123;</div><div class="line">db: fakeDb</div><div class="line">&#125;).create(<span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</div><div class="line">t.equal(user.id, <span class="number">1</span>, <span class="string">'User id should match'</span>);</div><div class="line">t.end();</div><div class="line">&#125;)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面的例子中我们有两个不同的 db。在 index.js 文件中是“真实的” db 模块，而第二段代码中我们只是简单地创建了一个模拟的db模块。</p>
<p>这样我们在测试时就可以轻松地将模拟的依赖引入模块。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://web.jobbole.com/84401/" target="_blank" rel="external">NodeJS 最佳实践</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/15/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><a class="extend next" rel="next" href="/page/17/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Arvin</p>
              <p class="site-description motion-element" itemprop="description">Learn and live.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">141</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Arvin</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  

  

  

</body>
</html>
