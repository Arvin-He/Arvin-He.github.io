<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Simple & Freedom" type="application/atom+xml" />






<meta name="description" content="Learn and live.">
<meta property="og:type" content="website">
<meta property="og:title" content="Simple &amp; Freedom">
<meta property="og:url" content="http://arvin-he.github.io/page/6/index.html">
<meta property="og:site_name" content="Simple &amp; Freedom">
<meta property="og:description" content="Learn and live.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Simple &amp; Freedom">
<meta name="twitter:description" content="Learn and live.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://arvin-he.github.io/page/6/"/>





  <title>Simple & Freedom</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Simple & Freedom</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Learn and live.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://arvin-he.github.io/2017/08/12/pyqt-loadui-2017-08-12/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arvin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple & Freedom">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/12/pyqt-loadui-2017-08-12/" itemprop="url">PyQt5加载ui的几种方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-12T10:52:06+08:00">
                2017-08-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>一般界面的创建有两种方式:</p>
<ol>
<li>使用纯代码实现</li>
<li>使用designer来拖拽控件<br>两种方式各有各自的好处,视具体的使用场景来选择.</li>
</ol>
<p>使用纯代码实现时一些属性需要在代码中指定, 或者继承某个控件类并定制添加一些属性和功能.这种方式比较灵活.但是控件太多且是不同种类的控件的话就有点繁琐了.</p>
<p>使用designer的方式是直观,快速,属性可视化,可添加动态属性,这也是使用比较多的方式.在designer中设计好界面后,保存为一个后缀为ui的文件,用文本编辑器打开是一个xml格式的文件,里面指明控件的各个属性.</p>
<p>下面就讲述在代码中加载ui的几种方式.</p>
<h3 id="PyQt5中加载ui的方式"><a href="#PyQt5中加载ui的方式" class="headerlink" title="PyQt5中加载ui的方式"></a>PyQt5中加载ui的方式</h3><p>PyQt5中加载ui的方式主要有3种:</p>
<ol>
<li>直接加载ui文件</li>
<li>将ui文件转成py文件加载</li>
<li>将所有的资源文件(包括ui,图片等)编译成内容是字节的py文件加载</li>
</ol>
<h3 id="直接加载ui文件"><a href="#直接加载ui文件" class="headerlink" title="直接加载ui文件"></a>直接加载ui文件</h3><p>使用uic加载ui文件,看下面代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> PyQt5 <span class="keyword">import</span> QtWidgets, uic, QtCore</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDialog</span><span class="params">(QtWidgets.QDialog)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        super(MyDialog, self).__init__()</div><div class="line">        uic.loadUi(os.path.join(os.path.dirname(__file__), <span class="string">"yourDialog.ui"</span>), self)</div><div class="line">        self.initUI()</div></pre></td></tr></table></figure></p>
<p>ui的控件直接通过<code>self</code>来获取访问,比如<code>self.mylabel.setText(&quot;xxx&quot;)</code>,这是最直接的方式.<br>适用于简单的界面设计.</p>
<h3 id="将ui文件转成py文件加载"><a href="#将ui文件转成py文件加载" class="headerlink" title="将ui文件转成py文件加载"></a>将ui文件转成py文件加载</h3><p>Qt Designer默认继承的object类，但不提供show()显示方法.<br>如何将ui文件转为py文件?<br>使用pyqt5中自带的工具pyuic5,pyuic5是一个可执行文件,在控制台可作为命令使用,具体使用参考下面的脚本<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> subprocess</div><div class="line"></div><div class="line">inputFile = os.path.abspath(os.path.join(<span class="string">"../res"</span>, <span class="string">"serialCom.ui"</span>))</div><div class="line">print(<span class="string">"input file =&#123;&#125;"</span>.format(inputFile))</div><div class="line">outputFile = os.path.abspath(<span class="string">"../serialCom_ui.py"</span>)</div><div class="line">print(<span class="string">"output file =&#123;&#125;"</span>.format(outputFile))</div><div class="line"><span class="keyword">try</span>:</div><div class="line">    <span class="comment"># py3.4.3</span></div><div class="line">    subprocess.call([<span class="string">"pyuic5.bat"</span>, inputFile, <span class="string">"-o"</span>, outputFile])</div><div class="line"><span class="keyword">except</span>:</div><div class="line">    <span class="comment"># py3.6</span></div><div class="line">    subprocess.call([<span class="string">"pyuic5"</span>, inputFile, <span class="string">"-o"</span>, outputFile])</div><div class="line">print(<span class="string">"build ui done."</span>)</div></pre></td></tr></table></figure></p>
<p>根据上面的脚本会根据ui文件生成一个py文件,那么这个py文件有哪些内容呢?<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> PyQt5 <span class="keyword">import</span> QtCore, QtGui, QtWidgets</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ui_serialDlg</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setupUi</span><span class="params">(self, serialDlg)</span>:</span></div><div class="line">        serialDlg.setObjectName(<span class="string">"serialDlg"</span>)</div><div class="line">        serialDlg.resize(<span class="number">1024</span>, <span class="number">768</span>)</div><div class="line">        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Fixed, QtWidgets.QSizePolicy.Fixed)</div><div class="line">        <span class="comment"># 这里省略了ui控件的属性设定</span></div><div class="line">        ...</div><div class="line">        self.retranslateUi(serialDlg)</div><div class="line">        QtCore.QMetaObject.connectSlotsByName(serialDlg)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">retranslateUi</span><span class="params">(self, serialDlg)</span>:</span></div><div class="line">        _translate = QtCore.QCoreApplication.translate</div><div class="line">        <span class="comment"># 这里略去了各种翻译的内容</span></div><div class="line">        ...</div></pre></td></tr></table></figure></p>
<p>从这个py看出,这个py文件生成了一个类,里面有2个函数,分别是<code>setupUi</code>和<code>retranslateUi</code>.<br>setupUi中主要是控件的各个属性设置, retranslateUi主要是翻译的内容<br>下面如何在你的代码中加载这个py文件呢?<br>有两种方式<br>第一种: 直接继承这个类, python中支持多继承<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> serialCom_ui <span class="keyword">import</span> Ui_serialDlg <span class="keyword">as</span> serialDlg</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainWindow</span><span class="params">(QDialog, serialDlg)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        super(MainWindow, self).__init__()</div><div class="line">        self.setupUi(self)</div></pre></td></tr></table></figure></p>
<p>第二种: 在你的代码中实例化<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> serialCom_ui <span class="keyword">import</span> Ui_serialDlg <span class="keyword">as</span> serialDlg</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainWindow</span><span class="params">(QDialog)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        super(MainWindow, self).__init__()</div><div class="line">        self.serial_dlg=serialDlg()  </div><div class="line">        self.serial_dlg.setupUi(self)</div></pre></td></tr></table></figure></p>
<p>为什么要生成py文件呢?主要是为了实现代码与界面分离。<br>缺点:ui文件有了更改,必须要再次生成对应的py文件,如果你忘记生成了,就会造成ui不同步.<br>优点:不再需要这个ui文件了.这就相当于使用纯代码的实现方式了.但这样的方式显然比纯代码要快,而且能做到<br>逻辑代码和界面代码分离.</p>
<h3 id="生成qrc文件编译资源文件生成py文件加载"><a href="#生成qrc文件编译资源文件生成py文件加载" class="headerlink" title="生成qrc文件编译资源文件生成py文件加载"></a>生成qrc文件编译资源文件生成py文件加载</h3><p>当有ui文件还有图片等资源文件时,怎么办呢?当图片重命名了怎么办? 当然是利用Qt的资源系统来整合这些资源文件了.<br>Qt 资源系统是一个跨平台的资源机制，用于将程序运行时所需要的资源以二进制的形式存储于可执行文件内部。<br>如果你的程序需要加载特定的资源（图标、文本翻译等），那么，将其放置在资源文件中，就再也不需要担心这些文件的丢失。<br>也就是说，如果你将资源以资源文件形式存储，它是会编译到可执行文件内部。<br>怎么做呢?<br>一般把用到的资源文件放到一个文件夹中,如res/,然后创建一个资源文件*.qrc,该文件生成在res文件夹中<br>qrc文件的内容有,如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;RCC&gt;&lt;qresource prefix=&quot;..&quot;&gt;</div><div class="line">  &lt;file mtime=&quot;1502414194.7463503&quot;&gt;favor.ico&lt;/file&gt;</div><div class="line">  &lt;file mtime=&quot;1494807198.7998164&quot;&gt;favor.png&lt;/file&gt;</div><div class="line">  &lt;file mtime=&quot;1502505175.56&quot;&gt;serialCom.ui&lt;/file&gt;</div><div class="line">  &lt;file mtime=&quot;1502414207.032053&quot;&gt;uninst.ico&lt;/file&gt;</div><div class="line">&lt;/qresource&gt;&lt;/RCC&gt;</div></pre></td></tr></table></figure></p>
<p>python中创建qrc文件,然后通过pyrcc5将资源文件编译到py文件中去<br>这里不仅仅生成qrc文件,还对qrc文件记录了资源文件最后的修改时间,并做了修改时间对比,<br>一旦有ui文件被修改了,就会重新编译生成res_rc.py文件.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 自动编译加载资源</span></div><div class="line">_res_path = os.path.abspath(<span class="string">'res'</span>)</div><div class="line">RCC = <span class="string">"""&lt;RCC&gt;&lt;qresource prefix="&#123;&#125;"&gt;\n&#123;&#125;&lt;/qresource&gt;&lt;/RCC&gt;"""</span></div><div class="line">FILE = <span class="string">"""  &lt;file mtime="&#123;&#125;"&gt;&#123;&#125;&lt;/file&gt;\n"""</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_loadRes</span><span class="params">(res, root)</span>:</span></div><div class="line">    <span class="comment"># res文件夹的路径</span></div><div class="line">    package = os.path.dirname(res)</div><div class="line">    <span class="comment"># 生成资源清单数据</span></div><div class="line">    res_files = []</div><div class="line">    <span class="keyword">for</span> a, _, files <span class="keyword">in</span> os.walk(res):</div><div class="line">        <span class="keyword">for</span> f <span class="keyword">in</span> files:</div><div class="line">            <span class="keyword">if</span> f == <span class="string">"res.qrc"</span> <span class="keyword">or</span> f.endswith(<span class="string">".ts"</span>):</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            ff = os.path.join(a, f)</div><div class="line">            res_files.append((os.path.getmtime(ff), os.path.relpath(</div><div class="line">                ff, res).replace(os.path.sep, <span class="string">"/"</span>)))</div><div class="line"></div><div class="line">    res_qrc_data = RCC.format(</div><div class="line">        os.path.relpath(package, root).replace(os.path.sep, <span class="string">"/"</span>),</div><div class="line">        <span class="string">""</span>.join([FILE.format(*x) <span class="keyword">for</span> x <span class="keyword">in</span> res_files]))</div><div class="line"></div><div class="line">    <span class="comment"># 更新资源清单</span></div><div class="line">    res_qrc = os.path.join(res, <span class="string">"res.qrc"</span>)</div><div class="line">    res_updated = <span class="keyword">False</span></div><div class="line"></div><div class="line">    <span class="comment"># 检查现有资源清单是否已是最新</span></div><div class="line">    <span class="keyword">if</span> os.path.exists(res_qrc):</div><div class="line">        <span class="keyword">with</span> open(res_qrc, <span class="string">"r"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</div><div class="line">            res_updated = f.read() == res_qrc_data</div><div class="line"></div><div class="line">    <span class="comment"># 更新资源清单</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> res_updated:</div><div class="line">        <span class="keyword">with</span> open(res_qrc, <span class="string">"w"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</div><div class="line">            f.write(res_qrc_data)</div><div class="line"></div><div class="line">    <span class="comment"># 编译资源清单</span></div><div class="line">    res_rc_py = os.path.join(package, <span class="string">"res_rc.py"</span>)</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(res_rc_py) <span class="keyword">or</span> \</div><div class="line">            os.path.getmtime(res_rc_py) &lt; os.path.getmtime(res_qrc):</div><div class="line">        <span class="comment"># 通过指定 `cwd` 解决 win32 下 pyrcc5 不支持中文路径的问题</span></div><div class="line">        rel_res_rc_py = os.path.relpath(res_rc_py, package)</div><div class="line">        rel_res_qrc = os.path.relpath(res_qrc, package)</div><div class="line"></div><div class="line">        subprocess.check_call(</div><div class="line">            [<span class="string">"pyrcc5"</span>, <span class="string">"-o"</span>, rel_res_rc_py, rel_res_qrc], cwd=package)</div><div class="line"></div><div class="line"><span class="comment"># 加载资源</span></div><div class="line"><span class="keyword">for</span> path, b, c <span class="keyword">in</span> os.walk(_res_path):</div><div class="line">    <span class="keyword">if</span> path.endswith(os.path.sep + <span class="string">"res"</span>):</div><div class="line">        _loadRes(path, _res_path)</div></pre></td></tr></table></figure></p>
<p>有了<code>res_rc.py</code>文件,然后将<code>res_rc.py</code>文件import进来,然后让问资源文件通过指定路径访问.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> PyQt5 <span class="keyword">import</span> QtCore</div><div class="line"></div><div class="line"><span class="keyword">import</span> res_rc</div><div class="line"><span class="comment"># :不能少, 路径就是qrc里的prefix+资源文件名</span></div><div class="line">pixmap = QPixamp(<span class="string">":/prefix/download.jpeg"</span>)</div></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadUi</span><span class="params">(widget, uiFileName)</span>:</span></div><div class="line">    <span class="string">"""加载 ui. 从 uiFileName 指定的 ui 文件加载."""</span></div><div class="line">    f = QtCore.QFile(uiFileName)</div><div class="line">    f.open(QtCore.QFile.ReadOnly | QtCore.QFile.Text)</div><div class="line">    <span class="keyword">assert</span> f.isOpen()</div><div class="line">    ts = QtCore.QTextStream(f)</div><div class="line">    ts.setCodec(<span class="string">"utf-8"</span>)</div><div class="line">    code_string = io.StringIO()</div><div class="line">    winfo = uic.compiler.UICompiler().compileUi(ts, code_string, <span class="keyword">True</span>, <span class="string">"_rc"</span>)</div><div class="line">    ui_globals = &#123;<span class="string">"__name__"</span>: widget.__module__&#125;</div><div class="line">    exec(code_string.getvalue(), ui_globals)</div><div class="line">    Ui = ui_globals[winfo[<span class="string">"uiclass"</span>]]</div><div class="line">    ui = Ui()</div><div class="line">    ui.setupUi(widget)</div><div class="line">    <span class="keyword">return</span> ui</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainWindow</span><span class="params">(QDialog, serialDlg)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        super(MainWindow, self).__init__()</div><div class="line">        self.ui = loadUi(self, <span class="string">":../serialCom.ui"</span>)</div></pre></td></tr></table></figure></p>
<p>然后所有ui里的控件对象都可以使用self.ui来访问了.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://arvin-he.github.io/2017/08/11/py-codestruct-2017-08-11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arvin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple & Freedom">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/11/py-codestruct-2017-08-11/" itemprop="url">Python代码结构</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-11T17:00:33+08:00">
                2017-08-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="构造项目层次结构文件夹的最佳方式是什么？"><a href="#构造项目层次结构文件夹的最佳方式是什么？" class="headerlink" title="构造项目层次结构文件夹的最佳方式是什么？"></a>构造项目层次结构文件夹的最佳方式是什么？</h3><p>理想的特性是易于维护，IDE-friendliness，源代码管理分支/合并的适用性，以及易于生成的软件包。<br>特别是：</p>
<ol>
<li>在哪里放置源代码？</li>
<li>在哪里放置应用程序启动脚本？</li>
<li>将IDE项目放在哪里？</li>
<li>在哪里放置单元/验收测试？</li>
<li>在哪里放置non-Python数据如配置文件？</li>
<li>在哪里放置non-Python源(如 C++) 用于 pyd/二进制扩展模块？</li>
</ol>
<h3 id="文件系统-python-项目的结构"><a href="#文件系统-python-项目的结构" class="headerlink" title="文件系统 python 项目的结构"></a>文件系统 python 项目的结构</h3><p>执行：</p>
<ul>
<li><p>命名与你的项目相关的目录。 例如如果你的项目名为”Twisted”，则为它的源文件命名为<code>top-level</code>目录 Twisted 。 当你发布时，应该包含版本号后缀： <code>Twisted-2.5</code> 。</p>
</li>
<li><p>创建一个目录 <code>Twisted/bin</code> 并将你的可执行文件放在那里，如果你有任何不给他们一个 .py 扩展，即使它们是 python 源文件。 不要将任何代码放入其中，除非导入和调用在你的项目中定义的主函数。 ( 轻微皱纹：在 Windows 上，解释器是由文件扩展名选择的，你的Windows 用户实际上想要<code>. py</code>扩展。 因此，当你为 Windows 打包时，你可能想要添加它。 不幸的是，我不知道如何让这个过程自动化。 考虑到在POSIX上，<code>. py</code> 扩展是一个惟一的缺点，而在 Windows 上，缺少的是一个实际的Bug，如果你的userbase包含 Windows 用户，那么你可能想要选择<code>. py</code> 扩展。)</p>
</li>
<li><p>如果你的项目是作为单个 python expressable源文件,然后把它放到目录和名称与你的项目相关的东西。 例如 Twisted/twisted.py 。如果你需要多个源文件，请创建一个软件包，并将源文件放入其中。 例如 Twisted/twisted/internet.py 。</p>
</li>
<li><p>把你的单元测试的sub-package ( 注意:这意味着单一 python 源文件选项上面是一个技巧——你总是需要至少一个其他文件为你的单元测试) 你的包。 例如 Twisted/twisted/test/ 。当然，让它成为一个带有 <code>Twisted/twisted/test/__init__.p</code>y的包。 将测试放在文件中 <code>Twisted/twisted/test/test_internet.py</code></p>
</li>
<li>添加 Twisted/README 和 Twisted/setup.py 来解释并安装你的软件，如果你觉得不错的话。</li>
</ul>
<p>不要：</p>
<ul>
<li>将你的源放在一个名为 src 或者 lib的目录中。 这使得没有安装就很难运行。</li>
<li>将测试放在 python 软件包之外。 这使得对已经安装版本运行测试变得困难。</li>
<li>创建一个包,只有 <code>__init__.py</code> 然后把所有代码放进 <code>__init__.py</code> 。 只是做一个模块而不是一个包，它更简单。</li>
<li>试图让 python 能够导入你的模块或者包，而不让用户将包含它的目录添加到导入路径( 或者通过PYTHONPATH或者其他的机制) 。 你不将正确处理所有情况下,用户会生气你当你的软件并不在他们的环境中工作。</li>
</ul>
<h3 id="一个项目目录组织方式"><a href="#一个项目目录组织方式" class="headerlink" title="一个项目目录组织方式"></a>一个项目目录组织方式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Project/</div><div class="line">|-- bin/</div><div class="line">|   |-- project</div><div class="line">|</div><div class="line">|-- project/</div><div class="line">|   |-- test/</div><div class="line">|   |   |-- __init__.py</div><div class="line">|   |   |-- test_main.py</div><div class="line">|   |   </div><div class="line">|   |-- __init__.py</div><div class="line">|   |-- main.py</div><div class="line">|</div><div class="line">|-- setup.py</div><div class="line">|-- README</div></pre></td></tr></table></figure>
<h3 id="另一个项目目录组织方式"><a href="#另一个项目目录组织方式" class="headerlink" title="另一个项目目录组织方式"></a>另一个项目目录组织方式</h3><p>当设置一个项目时，( 或者目录结构)的布局是很重要的。 合理的布局意味着潜在的贡献者不必花费大量的时间去寻找一段代码；文件位置是直观的。 因为我们正在处理一个现有项目，这意味着你可能需要移动一些东西。<br>让我们从头开始。 大多数项目有许多top-level文件( 像 setup.py, README.md，requirements.txt, 等) 。 然后，每个项目都应该有三个目录：<br>包含项目文档的文档目录<br>名为项目名称的目录，它存储实际的python 包<br>在两个位置中的一个测试目录<br>在包含测试代码和资源的软件包目录下<br>作为一个独立的顶级目录，可以更好地了解你的文件如何组织，下面是一个对我的项目的布局的简化快照，sandman:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">$ pwd</div><div class="line">~/code/sandman</div><div class="line">$ tree</div><div class="line">.</div><div class="line">|- LICENSE</div><div class="line">|- README.md</div><div class="line">|- TODO.md</div><div class="line">|- docs</div><div class="line">| |-- conf.py</div><div class="line">| |-- generated</div><div class="line">| |-- index.rst</div><div class="line">| |-- installation.rst</div><div class="line">| |-- modules.rst</div><div class="line">| |-- quickstart.rst</div><div class="line">| |-- sandman.rst</div><div class="line">|- requirements.txt</div><div class="line">|- sandman</div><div class="line">| |-- __init__.py</div><div class="line">| |-- exception.py</div><div class="line">| |-- model.py</div><div class="line">| |-- sandman.py</div><div class="line">| |-- test</div><div class="line">| |-- models.py</div><div class="line">| |-- test_sandman.py</div><div class="line">|- setup.py</div></pre></td></tr></table></figure></p>
<p>你可以看到，有一些顶级文件，一个文档目录( 生成的是一个空目录，sphinx将在其中放置生成的文档)，一个sandman目录和一个在sandman下的测试目录。</p>
<h3 id="再一个项目目录组织方式"><a href="#再一个项目目录组织方式" class="headerlink" title="再一个项目目录组织方式"></a>再一个项目目录组织方式</h3><p>假设你的项目名为foo, 我比较建议的最方便快捷目录结构这样就足够了:</p>
<pre><code>Foo/
|-- bin/
|   |-- foo
|
|-- foo/
|   |-- tests/
|   |   |-- __init__.py
|   |   |-- test_main.py
|   |
|   |-- __init__.py
|   |-- main.py
|
|-- docs/
|   |-- conf.py
|   |-- abc.rst
|
|-- setup.py
|-- requirements.txt
|-- README
</code></pre><p>简要解释一下:</p>
<p>bin/: 存放项目的一些可执行文件，当然你可以起名script/之类的也行。<br>foo/: 存放项目的所有源代码。(1) 源代码中的所有模块、包都应该放在此目录。不要置于顶层目录。(2) 其子目录tests/存放单元测试代码； (3) 程序的入口最好命名为main.py。<br>docs/: 存放一些文档。<br>setup.py: 安装、部署、打包的脚本。<br>requirements.txt: 存放软件依赖的外部Python包列表。<br>README: 项目说明文件。<br>除此之外，有一些方案给出了更加多的内容。比如LICENSE.txt,ChangeLog.txt文件等，我没有列在这里，因为这些东西主要是项目开源的时候需要用到。如果你想写一个开源软件，目录该如何组织，可以参考<a href="https://jeffknupp.com/blog/2013/08/16/open-sourcing-a-python-project-the-right-way/" target="_blank" rel="external">这篇文章</a>。</p>
<p>下面，再简单讲一下我对这些目录的理解和个人要求吧。</p>
<h3 id="关于README的内容"><a href="#关于README的内容" class="headerlink" title="关于README的内容"></a>关于README的内容</h3><p>这个我觉得是每个项目都应该有的一个文件，目的是能简要描述该项目的信息，让读者快速了解这个项目。<br>它需要说明以下几个事项:</p>
<ul>
<li>软件定位，软件的基本功能。</li>
<li>运行代码的方法: 安装环境、启动命令等。</li>
<li>简要的使用说明。</li>
<li>代码目录结构说明，更详细点可以说明软件的基本原理。</li>
<li>常见问题说明。</li>
</ul>
<p>我觉得有以上几点是比较好的一个README。在软件开发初期，由于开发过程中以上内容可能不明确或者发生变化，并不是一定要在一开始就将所有信息都补全。但是在项目完结的时候，是需要撰写这样的一个文档的。<br>可以参考Redis源码中<a href="https://github.com/antirez/redis#what-is-redis" target="_blank" rel="external">Readme</a>的写法，这里面简洁但是清晰的描述了Redis功能和源码结构。</p>
<h3 id="关于requirements-txt和setup-py"><a href="#关于requirements-txt和setup-py" class="headerlink" title="关于requirements.txt和setup.py"></a>关于requirements.txt和setup.py</h3><h4 id="setup-py"><a href="#setup-py" class="headerlink" title="setup.py"></a>setup.py</h4><p>一般来说，用setup.py来管理代码的打包、安装、部署问题。业界标准的写法是用Python流行的打包工具setuptools来管理这些事情。这种方式普遍应用于开源项目中。不过这里的核心思想不是用标准化的工具来解决这些问题，而是说，<strong>一个项目一定要有一个安装部署工具</strong>，能快速便捷的在一台新机器上将环境装好、代码部署好和将程序运行起来。</p>
<p>这个我是踩过坑的。</p>
<p>我刚开始接触Python写项目的时候，安装环境、部署代码、运行程序这个过程全是手动完成，遇到过以下问题:</p>
<ol>
<li>安装环境时经常忘了最近又添加了一个新的Python包，结果一到线上运行，程序就出错了。</li>
<li>Python包的版本依赖问题，有时候我们程序中使用的是一个版本的Python包，但是官方的已经是最新的包了，通过手动安装就可能装错了。</li>
<li>如果依赖的包很多的话，一个一个安装这些依赖是很费时的事情。</li>
<li>新同学开始写项目的时候，将程序跑起来非常麻烦，因为可能经常忘了要怎么安装各种依赖。</li>
</ol>
<p>setup.py可以将这些事情自动化起来，提高效率、减少出错的概率。”复杂的东西自动化，能自动化的东西一定要自动化。”是一个非常好的习惯。</p>
<p>setuptools的文档比较庞大，刚接触的话，可能不太好找到切入点。学习技术的方式就是看他人是怎么用的，可以参考一下Python的一个Web框架，flask是如何写的: <a href="https://github.com/pallets/flask/blob/master/setup.py" target="_blank" rel="external">setup.py</a></p>
<p>当然，简单点自己写个安装脚本（deploy.sh）替代setup.py也未尝不可。</p>
<h4 id="requirements-txt"><a href="#requirements-txt" class="headerlink" title="requirements.txt"></a>requirements.txt</h4><p>这个文件存在的目的是:</p>
<ol>
<li>方便开发者维护软件的包依赖。将开发过程中新增的包添加进这个列表中，避免在setup.py安装依赖时漏掉软件包。</li>
<li>方便读者明确项目使用了哪些Python包。<br>这个文件的格式是每一行包含一个包依赖的说明，通常是flask&gt;=0.10这种格式，要求是这个格式能被pip识别，这样就可以简单的通过 <code>pip install -r requirements.txt</code>来把所有Python包依赖都装好了。具体格式说明： <a href="https://pip.readthedocs.io/en/1.1/requirements.html" target="_blank" rel="external">点这里</a>。</li>
</ol>
<h3 id="关于配置文件的使用方法"><a href="#关于配置文件的使用方法" class="headerlink" title="关于配置文件的使用方法"></a>关于配置文件的使用方法</h3><p>注意，在上面的目录结构中，没有将conf.py放在源码目录下，而是放在docs/目录下。</p>
<p>很多项目对配置文件的使用做法是:</p>
<ol>
<li>配置文件写在一个或多个python文件中，比如此处的conf.py。</li>
<li>项目中哪个模块用到这个配置文件就直接通过import conf这种形式来在代码中使用配置。</li>
</ol>
<p>这种做法我不太赞同:</p>
<ol>
<li>这让单元测试变得困难（因为模块内部依赖了外部配置）</li>
<li>另一方面配置文件作为用户控制程序的接口，应当可以由用户自由指定该文件的路径。</li>
<li>程序组件可复用性太差，因为这种贯穿所有模块的代码硬编码方式，使得大部分模块都依赖conf.py这个文件。</li>
</ol>
<p>所以，我认为配置的使用，更好的方式是，<br>模块的配置都是可以灵活配置的，不受外部配置文件的影响。<br>程序的配置也是可以灵活控制的。<br>能够佐证这个思想的是，用过nginx和mysql的同学都知道，nginx、mysql这些程序都可以自由的指定用户配置。</p>
<p>所以，不应当在代码中直接import conf来使用配置文件。上面目录结构中的conf.py，是给出的一个配置样例，不是在写死在程序中直接引用的配置文件。可以通过给main.py启动参数指定配置路径的方式来让程序读取配置内容。当然，这里的conf.py你可以换个类似的名字，比如settings.py。或者你也可以使用其他格式的内容来编写配置文件，比如settings.yaml之类的。</p>
<p>对于文档的态度<br>目录结构中有设docs/这个目录，用于存放代码文档。实际过程中，据我观察，80%以上的程序员都没有单独写文档的习惯。一般文档写得比较好的，都是一些开源项目。</p>
<p>在普通的项目中，确实没必要写非常详细的文档，我更赞同的是现在的一种流行的风格: “在代码中写文档”。即在写代码的时候，在代码文件里把软件/模块的简要用法写明。简单有用。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://monklof.com/post/19/" target="_blank" rel="external">如何设计结构清晰的目录结构</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://arvin-he.github.io/2017/08/11/py-relativeimport-2017-08-11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arvin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple & Freedom">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/11/py-relativeimport-2017-08-11/" itemprop="url">Python模块和包导入机制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-11T15:53:58+08:00">
                2017-08-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="将代码封装成包"><a href="#将代码封装成包" class="headerlink" title="将代码封装成包"></a>将代码封装成包</h3><p>在文件系统上组织你的代码，并确保每个目录都定义了一个<code>__init__.py</code>文件,</p>
<h3 id="关于相对导入"><a href="#关于相对导入" class="headerlink" title="关于相对导入"></a>关于相对导入</h3><p>当导入模块时,报错:python systemerror parent module ‘’ not loaded cannot perform relative import,这就是相对导入的问题了.</p>
<p>涉及到相对导入时，package所对应的文件夹必须正确的被python解释器视作package，而不是普通文件夹。<br>否则由于不被视作package，无法利用package之间的嵌套关系实现python中包的相对导入。</p>
<p>文件夹被python解释器视作package需要满足两个条件：</p>
<ol>
<li>文件夹中必须有<code>__init__.py</code>文件，该文件可以为空，但必须存在该文件。</li>
<li>不能作为顶层模块来执行该文件夹中的py文件（即不能作为主函数的入口）。</li>
</ol>
<p>补充：在”from YY import XX”这样的代码中，无论是XX还是YY，只要被python解释器视作package，就会首先调用该package的<code>__init__.py</code>文件。<br>如果都是package，则调用顺序是YY，XX。</p>
<h3 id="一个问题"><a href="#一个问题" class="headerlink" title="一个问题"></a>一个问题</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">test</div><div class="line">|-- a.py</div><div class="line">|-- b.py</div><div class="line">`-- __init__.py</div><div class="line"></div><div class="line"><span class="comment"># a.py</span></div><div class="line"><span class="keyword">from</span> test.b <span class="keyword">import</span> c</div><div class="line">print(c)</div><div class="line"><span class="comment"># b.py</span></div><div class="line">c = <span class="string">"test"</span></div><div class="line"></div><div class="line"><span class="comment">#运行 a.py</span></div><div class="line">python3 a.py</div><div class="line"></div><div class="line">Traceback (most recent call last):</div><div class="line">File <span class="string">"a.py"</span>, line <span class="number">1</span>, <span class="keyword">in</span> <span class="keyword">from</span> test.b <span class="keyword">import</span> c</div><div class="line">ImportError: No module named <span class="string">'test.b'</span></div></pre></td></tr></table></figure>
<p>test 的上级目录不在 sys.path 中。<br>还有，不要直接执行一个包里边的文件。如果真需要执行一个包里的模块（而又不使用 distribute 提供的 entry point 安装配置），<br>请使用 <code>python3 -m test.a</code> 这样子。</p>
<h3 id="将文件夹加入到-sys-path"><a href="#将文件夹加入到-sys-path" class="headerlink" title="将文件夹加入到 sys.path"></a>将文件夹加入到 sys.path</h3><p>你无法导入你的 Python 代码因为它所在的目录不在 sys.path 里。你想将添加新目录到 Python 路径，但是不想硬链接到你的代码。<br>有两种常用的方式将新目录添加到 sys.path:</p>
<ol>
<li>使用 PYTHONPATH环境变量来添加</li>
<li>第二种方法是创建一个.pth 文件，将目录列举出来<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># myapplication.pth</div><div class="line">/some/dir</div><div class="line">/other/dir</div></pre></td></tr></table></figure>
</li>
</ol>
<p>这个<code>.pth</code> 文件需要放在某个 Python 的 <code>site-packages</code> 目录，通常位于<code>/usr/local/lib/python3.3/site-packages</code> 或者 <code>˜/.local/lib/python3.3/sitepackages</code>。当解释器启动<br>时，<code>.pth</code> 文件里列举出来的存在于文件系统的目录将被添加到 <code>sys.path</code>。安装一个<code>.pth</code>文件可能需要管理员权限，如果它被添加到系统级的 Python 解释器。</p>
<h3 id="import的几种方式"><a href="#import的几种方式" class="headerlink" title="import的几种方式"></a>import的几种方式</h3><ol>
<li><p>常规导入和重命名导入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys <span class="keyword">as</span> system</div></pre></td></tr></table></figure>
</li>
<li><p>使用from语句导入<br>只想要导入一个模块或库中的某个部分:<br><code>from functools import lru_cache</code><br>从一个包中导入多个项：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path, walk, unlink</div><div class="line"><span class="keyword">from</span> os <span class="keyword">import</span> uname, remove</div></pre></td></tr></table></figure>
</li>
</ol>
<p>上面是通过多次从同一个模块中导入实现的。当然，你也可以使用圆括号一次性导入多个项<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> os <span class="keyword">import</span> (path, walk, unlink, uname, </div><div class="line">                remove, rename)</div><div class="line">```                </div><div class="line"></div><div class="line">也可以这样</div><div class="line">```python</div><div class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path, walk, unlink, uname, \</div><div class="line">                remove, rename</div></pre></td></tr></table></figure></p>
<ol>
<li>相对导入<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">my_package/</div><div class="line">    __init__.py</div><div class="line">    subpackage1/</div><div class="line">        __init__.py</div><div class="line">        module_x.py</div><div class="line">        module_y.py</div><div class="line">    subpackage2/</div><div class="line">        __init__.py</div><div class="line">        module_z.py</div><div class="line">    module_a.py</div></pre></td></tr></table></figure>
</li>
</ol>
<p>在顶层的<code>__init__.py</code>文件中，输入以下代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> . <span class="keyword">import</span> subpackage1</div><div class="line"><span class="keyword">from</span> . <span class="keyword">import</span> subpackage2</div></pre></td></tr></table></figure></p>
<p>然后进入subpackage1文件夹，编辑其中的<code>__init__.py</code>文件，输入以下代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> . <span class="keyword">import</span> module_x</div><div class="line"><span class="keyword">from</span> . <span class="keyword">import</span> module_y</div></pre></td></tr></table></figure></p>
<p>编辑<code>module_x.py</code>文件，输入以下代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> .module_y <span class="keyword">import</span> spam <span class="keyword">as</span> ham</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    ham()</div></pre></td></tr></table></figure></p>
<p>编辑module_y.py文件，输入以下代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">spam</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">'spam '</span> * <span class="number">3</span>)</div></pre></td></tr></table></figure></p>
<p>打开终端，cd至<code>my_package</code>包所在的文件夹，但<strong>不要进入</strong>my_package。在这个文件夹下运行Python解释器。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> my_package</div><div class="line"></div><div class="line">In [<span class="number">2</span>]: my_package.subpackage1.module_x</div><div class="line">Out[<span class="number">2</span>]: </div><div class="line"></div><div class="line">In [<span class="number">3</span>]: my_package.subpackage1.module_x.main()</div><div class="line">spam spam spam</div></pre></td></tr></table></figure></p>
<p><strong>注意:</strong> 如果你想要跨越多个文件层级进行导入，只需要使用多个句点即可。不过，PEP 328建议<strong>相对导入的层级不要超过两层</strong>。<br>还要注意一点，如果你往module_x.py文件中添加了<code>if __name__ == &#39;__main__&#39;:</code>，然后试图运行这个文件，<br>你会碰到一个很难理解的错误。编辑一下文件，试试看吧！<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> . module_y <span class="keyword">import</span> spam <span class="keyword">as</span> ham</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    ham()</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    <span class="comment"># This won't work!</span></div><div class="line">    main()</div></pre></td></tr></table></figure></p>
<p>从终端进入subpackage1文件夹，执行以下命令：<br>使用的是Python 2，你应该会看到下面的错误信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;module_x.py&quot;, line 1, in </div><div class="line">    from . module_y import spam as ham</div><div class="line">ValueError: Attempted relative import in non-package</div></pre></td></tr></table></figure></p>
<p>使用的是Python 3，错误信息是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;module_x.py&quot;, line 1, in </div><div class="line">    from . module_y import spam as ham</div><div class="line">SystemError: Parent module &apos;&apos; not loaded, cannot perform relative import</div></pre></td></tr></table></figure></p>
<p>这指的是，module_x.py是某个包中的一个模块，而你试图以脚本模式执行，但是这种模式不支持相对导入。<br>如果你想在自己的代码中使用这个模块，那么你必须将其添加至Python的导入检索路径（import search path）。最简单的做法如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sys</div><div class="line">sys.path.append(<span class="string">'/path/to/folder/containing/my_package'</span>)</div><div class="line"><span class="keyword">import</span> my_package</div></pre></td></tr></table></figure></p>
<p>注意，你需要添加的是<code>my_package</code>的上一层文件夹路径，而不是<code>my_package</code>本身。原因是<code>my_package</code>就是我们想要使用的包，<br>所以如果你添加它的路径，那么将无法使用这个包。</p>
<ol>
<li>可选导入（Optional imports）<br>希望优先使用某个模块或包，但是同时也想在没有这个模块或包的情况下有备选，你就可以使用可选导入这种方式。<br>正如下面示例所示，可选导入的使用很常见，是一个值得掌握的技巧。这样做可以导入支持某个软件的多种版本或者实现性能提升。以github2包中的代码为例：<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span>:</div><div class="line">    <span class="comment"># For Python 3</span></div><div class="line">    <span class="keyword">from</span> http.client <span class="keyword">import</span> responses</div><div class="line"><span class="keyword">except</span> ImportError:  <span class="comment"># For Python 2.5-2.7</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        <span class="keyword">from</span> httplib <span class="keyword">import</span> responses  <span class="comment"># NOQA</span></div><div class="line">    <span class="keyword">except</span> ImportError:  <span class="comment"># For Python 2.4</span></div><div class="line">        <span class="keyword">from</span> BaseHTTPServer <span class="keyword">import</span> BaseHTTPRequestHandler <span class="keyword">as</span> _BHRH</div><div class="line">        responses = dict([(k, v[<span class="number">0</span>]) <span class="keyword">for</span> k, v <span class="keyword">in</span> _BHRH.responses.items()])</div></pre></td></tr></table></figure>
</li>
</ol>
<p>lxml包也有使用可选导入方式：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span>:</div><div class="line">    <span class="keyword">from</span> urlparse <span class="keyword">import</span> urljoin</div><div class="line">    <span class="keyword">from</span> urllib2 <span class="keyword">import</span> urlopen</div><div class="line"><span class="keyword">except</span> ImportError:</div><div class="line">    <span class="comment"># Python 3</span></div><div class="line">    <span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin</div><div class="line">    <span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</div></pre></td></tr></table></figure></p>
<ol>
<li>局部导入<br>当你在局部作用域中导入模块时，你执行的就是局部导入。如果你在Python脚本文件的顶部导入一个模块，那么你就是在将该模块导入至全局作用域，这意味着之后的任何函数或方法都可能访问该模块。<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sys  <span class="comment"># global scope</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">square_root</span><span class="params">(a)</span>:</span></div><div class="line">    <span class="comment"># This import is into the square_root functions local scope</span></div><div class="line">    <span class="keyword">import</span> math</div><div class="line">    <span class="keyword">return</span> math.sqrt(a)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_pow</span><span class="params">(base_num, power)</span>:</span></div><div class="line">    <span class="keyword">return</span> math.pow(base_num, power)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    print(square_root(<span class="number">49</span>))</div><div class="line">    print(my_pow(<span class="number">2</span>, <span class="number">3</span>))</div></pre></td></tr></table></figure>
</li>
</ol>
<p>我们将sys模块导入至全局作用域，但我们并没有使用这个模块。<br>然后，在<code>square_root</code>函数中，我们将math模块导入至该函数的局部作用域，这意味着math模块只能在<code>square_root</code>函数内部使用。<br>如果我们试图在<code>my_pow</code>函数中使用math，会引发NameError.</p>
<p>使用局部作用域的好处之一，是你使用的模块可能需要很长时间才能导入，如果是这样的话，将其放在某个不经常调用的函数中或许更加合理，而不是直接在全局作用域中导入。老实说，我几乎从没有使用过局部导入，主要是因为如果模块内部到处都有导入语句，会很难分辨出这样做的原因和用途。<strong>根据约定，所有的导入语句都应该位于模块的顶部</strong>。<br>或者有的函数你只需使用一次可以选择局部导入.</p>
<h3 id="导入注意事项"><a href="#导入注意事项" class="headerlink" title="导入注意事项"></a>导入注意事项</h3><p>在导入模块方面，有几个程序员常犯的错误。这里介绍两个:</p>
<ul>
<li>循环导入（circular imports）</li>
<li>覆盖导入（Shadowed imports，暂时翻译为覆盖导入）</li>
</ul>
<h4 id="循环导入"><a href="#循环导入" class="headerlink" title="循环导入"></a>循环导入</h4><p>如果你创建两个模块，二者相互导入对方，那么就会出现循环导入。例如：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># a.py</span></div><div class="line"><span class="keyword">import</span> b</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_test</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">"in a_test"</span>)</div><div class="line">    b.b_test()</div><div class="line"></div><div class="line">a_test()</div></pre></td></tr></table></figure></p>
<p>然后在同个文件夹中创建另一个模块，将其命名为b.py。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> a</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">b_test</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">'In test_b"'</span>)</div><div class="line">    a.a_test()</div><div class="line"></div><div class="line">b_test()</div></pre></td></tr></table></figure></p>
<p>如果你运行任意一个模块，都会引发AttributeError。这是因为这两个模块都在试图导入对方。简单来说，模块a想要导入模块b，但是因为模块b也在试图导入模块a（这时正在执行），模块a将无法完成模块b的导入。一般来说，<strong>你应该做的是重构代码，避免发生这种情况</strong>。</p>
<h4 id="覆盖导入"><a href="#覆盖导入" class="headerlink" title="覆盖导入"></a>覆盖导入</h4><p>当你创建的模块与标准库中的模块同名时，如果你导入这个模块，就会出现覆盖导入。举个例子，创建一个名叫math.py的文件，在其中写入如下代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> math</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">square_root</span><span class="params">(number)</span>:</span></div><div class="line">    <span class="keyword">return</span> math.sqrt(number)</div><div class="line"></div><div class="line">square_root(<span class="number">72</span>)</div></pre></td></tr></table></figure></p>
<p>现在打开终端，试着运行这个文件，你会得到以下回溯信息（traceback）：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"math.py"</span>, line <span class="number">1</span>, <span class="keyword">in</span> </div><div class="line">    <span class="keyword">import</span> math</div><div class="line">  File <span class="string">"/Users/michael/Desktop/math.py"</span>, line <span class="number">6</span>, <span class="keyword">in</span> </div><div class="line">    square_root(<span class="number">72</span>)</div><div class="line">  File <span class="string">"/Users/michael/Desktop/math.py"</span>, line <span class="number">4</span>, <span class="keyword">in</span> square_root</div><div class="line">    <span class="keyword">return</span> math.sqrt(number)</div><div class="line">AttributeError: module <span class="string">'math'</span> has no attribute <span class="string">'sqrt'</span></div></pre></td></tr></table></figure></p>
<p>这到底是怎么回事？其实，你运行这个文件的时候，Python解释器首先在当前运行脚本所处的的文件夹中查找名叫math的模块。在这个例子中，解释器找到了我们正在执行的模块，试图导入它。但是我们的模块中并没有叫sqrt的函数或属性，所以就抛出了AttributeError。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://juejin.im/entry/570c6b6771cfe40067310370" target="_blank" rel="external">https://juejin.im/entry/570c6b6771cfe40067310370</a></li>
<li>[cookbook]</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://arvin-he.github.io/2017/08/10/pyqt-somequestions-2017-08-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arvin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple & Freedom">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/10/pyqt-somequestions-2017-08-10/" itemprop="url">PyQt5遇到的一些问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-10T13:09:10+08:00">
                2017-08-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="关于QButtonGroup的问题"><a href="#关于QButtonGroup的问题" class="headerlink" title="关于QButtonGroup的问题"></a>关于QButtonGroup的问题</h3><p>在循环中对按钮做属性修改,比如setchecked属性.<br>之前将所有的button对象放到QButtonGroup中,然后在循环中设置属性,代码如下:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> btn <span class="keyword">in</span> self.buttonGroup.buttons():</div><div class="line">    btn.setCheckable(<span class="keyword">True</span>)</div><div class="line">    btn.setChecked(<span class="keyword">True</span>)</div></pre></td></tr></table></figure></p>
<p>最后结果是在groupbutton中的最后一个button会被设置为checked状态,其他的按钮都没有被设置为checked状态.</p>
<p>解决办法:将按钮对象放在一个list里,然后遍历list里的按钮对象就行了.后来查了文档,放在QButtonGroup中的按钮对象,在放入QButtonGroup之前必须具有SetCheckabled为true这个属性.否则无法设置setchecked这个属性.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://arvin-he.github.io/2017/08/08/pyqt-stackedwidget-2017-08-08/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Arvin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple & Freedom">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/08/pyqt-stackedwidget-2017-08-08/" itemprop="url">PyQt5使用QStackedwidget</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-08T17:14:14+08:00">
                2017-08-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>QListWidget和QStackedWidget在ui文件中.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> functools</div><div class="line"><span class="keyword">from</span> PyQt5 <span class="keyword">import</span> uic</div><div class="line"><span class="keyword">from</span> PyQt5 <span class="keyword">import</span> QtWidgets</div><div class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> loadJson</div><div class="line"><span class="keyword">from</span> page1 <span class="keyword">import</span> ControlPanel</div><div class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> loadJson</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ControlPanel2</span><span class="params">(QtWidgets.QWidget)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, parent=None)</span>:</span></div><div class="line">        super(ControlPanel2, self).__init__(parent)</div><div class="line">        self._config = loadJson()</div><div class="line">        self.ctrlpanelWidth = self._config[<span class="string">'controlpanel'</span>][<span class="string">'width'</span>]</div><div class="line">        self.ctrlpanelHeight = self._config[<span class="string">'controlpanel'</span>][<span class="string">'height'</span>]</div><div class="line">        self.ctrl_panel = ControlPanel()</div><div class="line">        self.initUI()</div><div class="line">        </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">initUI</span><span class="params">(self)</span>:</span></div><div class="line">        self.ui = uic.loadUi(os.path.join(</div><div class="line">            os.path.dirname(__file__), <span class="string">"res/ctrlpanel.ui"</span>), self)</div><div class="line">        self.setFixedSize(self.ctrlpanelWidth, self.ctrlpanelHeight)</div><div class="line">        <span class="keyword">for</span> i, key <span class="keyword">in</span> enumerate(sorted(self._config[<span class="string">"panels"</span>].keys())):</div><div class="line">            item = QtWidgets.QListWidgetItem(self.ui.panellist)</div><div class="line">            item.setText(key)</div><div class="line">            self.ui.panellist.insertItem(i, item)</div><div class="line">            self.ui.stackedWidget.insertWidget(i, QtWidgets.QLabel(<span class="string">"&#123;&#125;"</span>.format(key)))  </div><div class="line">        <span class="comment"># 设置qss</span></div><div class="line">        self.setStyleSheet(</div><div class="line">            <span class="string">"QListWidget::item&#123;width: 65px; height: 35px; text-align: center;&#125;"</span>)</div><div class="line">        self.ui.panellist.setCurrentRow(<span class="number">0</span>)</div><div class="line">        self.ui.stackedWidget.setCurrentIndex(<span class="number">0</span>)</div><div class="line">        self.ui.panellist.currentRowChanged.connect(self.on_showPage)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_showPage</span><span class="params">(self, index)</span>:</span></div><div class="line">        <span class="comment"># index = self.ui.panellist.currentIndex()</span></div><div class="line">        print(<span class="string">"current index ="</span>, index)</div><div class="line">        self.ui.stackedWidget.setCurrentIndex(index)</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Arvin</p>
              <p class="site-description motion-element" itemprop="description">Learn and live.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">141</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Arvin</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  

  

  

</body>
</html>
