<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Learn and live."><title>全站爬虫 | Simple &amp; Freedom</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">全站爬虫</h1><a id="logo" href="/.">Simple &amp; Freedom</a><p class="description">Learn and live.</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/404.html"><i class="fa fa-heartbeat"> 公益404</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">全站爬虫</h1><div class="post-meta">Feb 1, 2018<span> | </span><span class="category"><a href="/categories/python/">python</a></span></div><div class="post-content"><h2 id="全站爬虫简介"><a href="#全站爬虫简介" class="headerlink" title="全站爬虫简介"></a>全站爬虫简介</h2><p>python version: 3.6, 爬取全站url,并保存html到mongodb.</p>
<h2 id="爬虫功能"><a href="#爬虫功能" class="headerlink" title="爬虫功能"></a>爬虫功能</h2><ul>
<li>生产者消费者模式</li>
<li>支持协程并发</li>
<li>爬取深度可配置</li>
<li>爬取总量可配置</li>
<li>自动过滤无关URL</li>
</ul>
<h2 id="相关代码段"><a href="#相关代码段" class="headerlink" title="相关代码段"></a>相关代码段</h2><p>allsitepider.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">import</span> chardet</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> requests.exceptions</div><div class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</div><div class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</div><div class="line"><span class="keyword">import</span> asyncio</div><div class="line"><span class="keyword">import</span> traceback</div><div class="line"></div><div class="line"><span class="keyword">try</span>:</div><div class="line">    <span class="keyword">from</span> .config <span class="keyword">import</span> get_header, func_timer, connect_mongo</div><div class="line">    <span class="keyword">from</span> .config <span class="keyword">import</span> TIMEOUT, DEPTH, MONGODB, AMOUNTS, CONTENT_LENGTH, DELAY, QUEUE_SIZE</div><div class="line">    <span class="keyword">from</span> .logger <span class="keyword">import</span> Logging</div><div class="line"><span class="keyword">except</span> ImportError:</div><div class="line">    <span class="keyword">from</span> config <span class="keyword">import</span> get_header, func_timer, connect_mongo</div><div class="line">    <span class="keyword">from</span> config <span class="keyword">import</span> TIMEOUT, DEPTH, MONGODB, AMOUNTS, CONTENT_LENGTH, DELAY, QUEUE_SIZE</div><div class="line">    <span class="keyword">from</span> logger <span class="keyword">import</span> Logging</div><div class="line"></div><div class="line">_logger = Logging(os.path.splitext(os.path.basename(__file__))[<span class="number">0</span>]).logObject</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Url</span><span class="params">(object)</span>:</span></div><div class="line">    url = <span class="string">''</span></div><div class="line">    end_type = <span class="string">'WEB'</span></div><div class="line">    parent_url = <span class="string">''</span></div><div class="line">    depth = <span class="number">0</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, url, end_type, parent_url_obj=None)</span>:</span></div><div class="line">        self.url = url</div><div class="line">        self.end_type = end_type</div><div class="line">        <span class="keyword">if</span> parent_url_obj:</div><div class="line">            self.parent_url = parent_url_obj.url</div><div class="line">            self.depth = parent_url_obj.depth + <span class="number">1</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AllSiteSpider</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.client = connect_mongo(MONGODB)</div><div class="line">        self.movie = self.client[MONGODB[<span class="string">'collection'</span>]]</div><div class="line">        self.filter_set = set()</div><div class="line">        self.q = asyncio.Queue(maxsize=QUEUE_SIZE)</div><div class="line">        self.consume_num = <span class="number">0</span></div><div class="line">        self.produce_num = <span class="number">0</span></div><div class="line">        self.stop_extract_links = <span class="keyword">False</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_crawl</span><span class="params">(self, start_url, end_type)</span>:</span></div><div class="line">        self.domain = getattr(urlparse(start_url), <span class="string">'netloc'</span>, <span class="string">''</span>)</div><div class="line">        self.end_type = end_type</div><div class="line">        url = start_url.strip()</div><div class="line">        <span class="keyword">if</span> url.endswith(<span class="string">'/'</span>):</div><div class="line">            url = url[:<span class="number">-1</span>]</div><div class="line">        self.filter_set.add(url)</div><div class="line">        start_url_obj = Url(url, self.end_type)</div><div class="line">        self.q.put_nowait(start_url_obj)</div><div class="line">        event_loop = asyncio.get_event_loop()</div><div class="line">        _logger.info(<span class="string">'开始全站爬取:start_url=[&#123;&#125;], Depth=&#123;&#125;, end_type=&#123;&#125;, parent_url=None'</span>.format(</div><div class="line">            start_url_obj.url, start_url_obj.depth, start_url_obj.end_type))</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            event_loop.run_until_complete(self.run(event_loop))</div><div class="line">        <span class="keyword">finally</span>:</div><div class="line">            event_loop.close()</div><div class="line"></div><div class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self, loop)</span>:</span></div><div class="line">        consumers = [loop.create_task(self.consumer(i)) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)]</div><div class="line">        <span class="keyword">await</span> asyncio.wait(consumers)</div><div class="line"></div><div class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">consumer</span><span class="params">(self, num)</span>:</span></div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                url_obj = <span class="keyword">await</span> self.q.get()</div><div class="line">                self.consume_num += <span class="number">1</span></div><div class="line">                _logger.info(<span class="string">'消费者&#123;&#125;:开始消耗第 &#123;&#125; 个, QSize=&#123;&#125;, Depth=&#123;&#125;, URL=[&#123;&#125;]'</span>.format(</div><div class="line">                    num, self.consume_num, self.q.qsize(), url_obj.depth, url_obj.url))</div><div class="line">                self.q.task_done()</div><div class="line">                <span class="keyword">await</span> self.producer(url_obj)</div><div class="line">            <span class="keyword">finally</span>:</div><div class="line">                <span class="keyword">if</span> self.q.empty():</div><div class="line">                    _logger.info(<span class="string">'队列已空,任务结束,退出EventLoop.'</span>)</div><div class="line">                    <span class="keyword">break</span></div><div class="line">        <span class="keyword">await</span> self.q.join()</div><div class="line"></div><div class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">producer</span><span class="params">(self, url_obj)</span>:</span></div><div class="line">        self.produce_num += <span class="number">1</span></div><div class="line">        _logger.info(<span class="string">'生产者:开始生产第 &#123;&#125; 个, QSize=&#123;&#125;, Depth=&#123;&#125;, URL=[&#123;&#125;]'</span>.format(</div><div class="line">            self.produce_num, self.q.qsize(), url_obj.depth, url_obj.url))</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            response = self.download_html(url_obj.url)</div><div class="line">            self.save_html(response)</div><div class="line">            <span class="keyword">await</span> asyncio.sleep(DELAY)</div><div class="line">            <span class="keyword">if</span> url_obj.depth &lt; DEPTH:</div><div class="line">                <span class="keyword">if</span> <span class="keyword">not</span> self.stop_extract_links:</div><div class="line">                    links = self.extract_links(response, url_obj)</div><div class="line">                    <span class="keyword">if</span> (self.consume_num+self.q.qsize()) &lt; AMOUNTS:</div><div class="line">                        <span class="keyword">for</span> url_obj <span class="keyword">in</span> links:</div><div class="line">                            <span class="keyword">await</span> self.q.put(url_obj)</div><div class="line">                        _logger.info(<span class="string">'向当前队列Put &#123;&#125; 个url, 当前队列QSize=&#123;&#125;'</span>.format(len(links) <span class="keyword">if</span> links <span class="keyword">else</span> <span class="number">0</span>, self.q.qsize()))</div><div class="line">                    <span class="keyword">else</span>:</div><div class="line">                        _logger.info(<span class="string">'当前已消耗URL + 当前队列QSize为&#123;&#125;,大于全站爬取最大限制数目&#123;&#125;,停止向队列Put URL,丢弃提取的 &#123;&#125; 个url,并停止解析提取之后的所有页面链接'</span>.format(</div><div class="line">                            self.consume_num+self.q.qsize(), AMOUNTS, len(links) <span class="keyword">if</span> links <span class="keyword">else</span> <span class="number">0</span>))</div><div class="line">                        self.stop_extract_links = <span class="keyword">True</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                _logger.warning(<span class="string">'当前URL深度为 &#123;&#125;, 达到最大深度限制,不再提取页面URL,当前URL=[&#123;&#125;]'</span>.format(url_obj.depth, url_obj.url))</div><div class="line">            _logger.info(<span class="string">'当前全局set共有 &#123;&#125; 个url'</span>.format(len(self.filter_set)))</div><div class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">            _logger.error(<span class="string">'生产者异常:&#123;&#125;'</span>.format(traceback.format_exc()))</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">download_html</span><span class="params">(self, url, retry=<span class="number">2</span>)</span>:</span></div><div class="line">        _logger.info(<span class="string">'下载页面:开始下载HTML页面...'</span>)</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            response = requests.get(url, headers=get_header(self.end_type), stream=<span class="keyword">True</span>, timeout=TIMEOUT)</div><div class="line">            <span class="keyword">if</span> int(response.headers.get(<span class="string">'Content-Length'</span>, <span class="number">0</span>)) &lt; CONTENT_LENGTH:</div><div class="line">                response.encoding = chardet.detect(response.content)[<span class="string">'encoding'</span>]</div><div class="line">                <span class="keyword">return</span> response</div><div class="line">        <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</div><div class="line">            _logger.error(<span class="string">'访问链接失败: &#123;&#125;, ERROR: &#123;&#125;'</span>.format(url, e))</div><div class="line">            <span class="keyword">if</span> retry &gt; <span class="number">0</span>:</div><div class="line">                _logger.info(<span class="string">'链接: &#123;&#125; 准备重试倒数第 &#123;&#125; 次'</span>.format(url, retry+<span class="number">1</span>))</div><div class="line">                self.download_html(url, retry<span class="number">-1</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save_html</span><span class="params">(self, response)</span>:</span></div><div class="line">        doc = &#123;&#125;</div><div class="line">        <span class="keyword">if</span> response <span class="keyword">and</span> response.status_code <span class="keyword">not</span> <span class="keyword">in</span> range(<span class="number">400</span>, <span class="number">600</span>):</div><div class="line">            doc[<span class="string">'request'</span>] = &#123;</div><div class="line">                <span class="string">'url'</span>: response.url,</div><div class="line">                <span class="string">'headers'</span>: response.request.headers,</div><div class="line">                <span class="string">'method'</span>: response.request.method</div><div class="line">            &#125;</div><div class="line">            doc[<span class="string">'response'</span>] = &#123;</div><div class="line">                <span class="string">'headers'</span>: response.headers,</div><div class="line">                <span class="string">'content'</span>: response.content,</div><div class="line">                <span class="string">'status_code'</span>: response.status_code</div><div class="line">            &#125;</div><div class="line">            doc[<span class="string">'end_type'</span>] = self.end_type</div><div class="line">            doc[<span class="string">'domain'</span>] = getattr(urlparse(response.url), <span class="string">'netloc'</span>, <span class="string">''</span>)</div><div class="line">            doc[<span class="string">'insert_time'</span>] = format((time.time() * <span class="number">1000</span>), <span class="string">'0.0f'</span>)</div><div class="line"></div><div class="line">        <span class="keyword">if</span> doc:</div><div class="line">            _logger.info(<span class="string">'保存数据:解析并保存数据到MONGODB数据库...'</span>)</div><div class="line">            self.movie.insert(doc)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">if</span> response:</div><div class="line">                _logger.warning(<span class="string">'没有解析到数据, status_code=&#123;&#125;, url=&#123;&#125;'</span>.format(</div><div class="line">                    response.status_code, response.url))</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                _logger.warning(<span class="string">'没有解析到数据'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">record_urls</span><span class="params">(self, filename, url)</span>:</span></div><div class="line">        <span class="keyword">with</span> open(filename, <span class="string">'a'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</div><div class="line">            f.write(url + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">filter_url</span><span class="params">(self, url, parent_url_obj, filtered_num, record=False)</span>:</span></div><div class="line">        url_obj = <span class="keyword">None</span></div><div class="line">        new_url = url.strip()</div><div class="line">        <span class="keyword">if</span> new_url.endswith(<span class="string">'/'</span>):</div><div class="line">            new_url = new_url[:<span class="number">-1</span>]</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.filter_set.__contains__(new_url) <span class="keyword">and</span> self.domain <span class="keyword">in</span> new_url:</div><div class="line">            self.filter_set.add(new_url)</div><div class="line">            url_obj = Url(new_url, self.end_type, parent_url_obj)</div><div class="line">            <span class="keyword">if</span> record:</div><div class="line">                self.record_urls(<span class="string">'unique.txt'</span>, new_url)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            filtered_num += <span class="number">1</span></div><div class="line">            <span class="keyword">if</span> record:</div><div class="line">                self.record_urls(<span class="string">'filtered.txt'</span>, new_url)</div><div class="line">        <span class="keyword">return</span> url_obj, filtered_num</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_links</span><span class="params">(self, response, url_obj)</span>:</span></div><div class="line">        <span class="keyword">if</span> response:</div><div class="line">            link_list = []</div><div class="line">            filtered_num = <span class="number">0</span></div><div class="line">            parent_url_obj = url_obj</div><div class="line">            parent_url = parent_url_obj.url</div><div class="line">            soup = BeautifulSoup(response.text, <span class="string">'lxml'</span>)</div><div class="line">            tags = soup.find_all(<span class="keyword">True</span>)</div><div class="line">            <span class="keyword">for</span> tag <span class="keyword">in</span> tags:</div><div class="line">                url = tag.get(<span class="string">'href'</span>, <span class="keyword">None</span>)</div><div class="line">                <span class="keyword">if</span> url <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">                    <span class="keyword">if</span> url.startswith(<span class="string">'javascript'</span>) <span class="keyword">or</span> url.startswith(<span class="string">'index'</span>):</div><div class="line">                        <span class="keyword">continue</span></div><div class="line">                    <span class="keyword">elif</span> url.startswith(<span class="string">'//'</span>):</div><div class="line">                        url = <span class="string">'&#123;&#125;:&#123;&#125;'</span>.format(getattr(urlparse(parent_url), <span class="string">'scheme'</span>, <span class="string">''</span>), url)</div><div class="line">                    <span class="keyword">elif</span> url.startswith(<span class="string">'/'</span>):</div><div class="line">                        url = <span class="string">'&#123;&#125;://&#123;&#125;&#123;&#125;'</span>.format(getattr(urlparse(parent_url), <span class="string">'scheme'</span>, <span class="string">''</span>),</div><div class="line">                                                 getattr(urlparse(parent_url), <span class="string">'netloc'</span>, <span class="string">''</span>), url)</div><div class="line">                    url_obj, filtered_num = self.filter_url(url, parent_url_obj, filtered_num)</div><div class="line">                    <span class="keyword">if</span> url_obj:</div><div class="line">                        link_list.append(url_obj)</div><div class="line">            _logger.info(<span class="string">'提取Urls:该页面共提取 &#123;&#125; 个, 过滤 &#123;&#125; 个'</span>.format(len(link_list), filtered_num))</div><div class="line">            <span class="keyword">return</span> link_list</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            _logger.error(<span class="string">"该页面为None"</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># if __name__ == '__main__':</span></div><div class="line"><span class="comment">#     # start_url = 'http://www.tongfudun.com'</span></div><div class="line"><span class="comment">#     # start_url = 'https://www.baidu.com'</span></div><div class="line"><span class="comment">#     # start_url = 'http://www.tcnet.com.cn/'</span></div><div class="line"><span class="comment">#     start_url = 'https://www.douban.com'</span></div><div class="line"><span class="comment">#     allsiteSpider = AllSiteSpider()</span></div><div class="line"><span class="comment">#     allsiteSpider.start_crawl(start_url, 'WEB')</span></div></pre></td></tr></table></figure></p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>config.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</div><div class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</div><div class="line"></div><div class="line"><span class="comment"># 爬取深度</span></div><div class="line">DEPTH = <span class="number">3</span></div><div class="line"><span class="comment"># 单个HTML的Content-Length为1M</span></div><div class="line">CONTENT_LENGTH = <span class="number">1</span>*<span class="number">1024</span>*<span class="number">1024</span></div><div class="line"><span class="comment"># 整站爬取总量</span></div><div class="line">AMOUNTS = <span class="number">500</span></div><div class="line"><span class="comment"># 网络请求超时</span></div><div class="line">TIMEOUT = <span class="number">10</span></div><div class="line"><span class="comment"># 爬取延时</span></div><div class="line">DELAY = <span class="number">1</span></div><div class="line"><span class="comment"># 队列大小</span></div><div class="line">QUEUE_SIZE = <span class="number">500</span></div><div class="line"><span class="comment"># 域名允许控制</span></div><div class="line">ALLOWED_DOMAINS = [</div><div class="line"></div><div class="line">]</div><div class="line"><span class="comment"># MONGODB参数</span></div><div class="line">MONGODB = &#123;</div><div class="line">    <span class="string">"user"</span>: <span class="string">"Goshawk"</span>,</div><div class="line">    <span class="string">"passwd"</span>: <span class="string">"yYZmrjJ8xauAe#t7"</span>,</div><div class="line">    <span class="string">"host"</span>: <span class="string">"192.168.1.141:27017"</span>,</div><div class="line">    <span class="string">"dbname"</span>: <span class="string">"Goshawk"</span>,</div><div class="line">    <span class="string">"collection"</span>: <span class="string">"my_mainurls"</span></div><div class="line">&#125;</div><div class="line"><span class="comment"># WEB端user-agent代理头</span></div><div class="line">WEB_USER_AGENTS = [</div><div class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; AcooBrowser; .NET CLR 1.1.4322; .NET CLR 2.0.50727)"</span>,</div><div class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Acoo Browser; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.0.04506)"</span>,</div><div class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 7.0; AOL 9.5; AOLBuild 4337.35; Windows NT 5.1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US)"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 2.0.50727; Media Center PC 6.0)"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 1.0.3705; .NET CLR 1.1.4322)"</span>,</div><div class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 7.0b; Windows NT 5.2; .NET CLR 1.1.4322; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 3.0.04506.30)"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN) AppleWebKit/523.15 (KHTML, like Gecko, Safari/419.3) Arora/0.3 (Change: 287 c9dfb30)"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (X11; U; Linux; en-US) AppleWebKit/527+ (KHTML, like Gecko, Safari/419.3) Arora/0.6"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.2pre) Gecko/20070215 K-Ninja/2.1.1"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9) Gecko/20080705 Firefox/3.0 Kapiko/3.0"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (X11; Linux i686; U;) Gecko/20070322 Kazehakase/0.4.5"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.8) Gecko Fedora/1.9.0.8-1.fc10 Kazehakase/0.5.6"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/535.20 (KHTML, like Gecko) Chrome/19.0.1036.7 Safari/535.20"</span>,</div><div class="line">    <span class="string">"Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; fr) Presto/2.9.168 Version/11.52"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.11 TaoBrowser/2.0 Safari/536.11"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.71 Safari/537.1 LBBROWSER"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; LBBROWSER)"</span>,</div><div class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E; LBBROWSER)"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.84 Safari/535.11 LBBROWSER"</span>,</div><div class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; QQBrowser/7.0.3698.400)"</span>,</div><div class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)"</span>,</div><div class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; SV1; QQDownload 732; .NET4.0C; .NET4.0E; 360SE)"</span>,</div><div class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)"</span>,</div><div class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.89 Safari/537.1"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.89 Safari/537.1"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (iPad; U; CPU OS 4_2_1 like Mac OS X; zh-cn) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148 Safari/6533.18.5"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0b13pre) Gecko/20110307 Firefox/4.0b13pre"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:16.0) Gecko/20100101 Firefox/16.0"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11"</span>,</div><div class="line">    <span class="string">"Mozilla/5.0 (X11; U; Linux x86_64; zh-CN; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10"</span></div><div class="line">]</div><div class="line"><span class="comment"># 移动端user-agent代理头</span></div><div class="line">MOBILE_USER_AGENTS = [</div><div class="line"></div><div class="line">]</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_header</span><span class="params">(end_type)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    :param end_type: WEB/MOBILE</span></div><div class="line"><span class="string">    :return: header</span></div><div class="line"><span class="string">    """</span></div><div class="line">    <span class="keyword">if</span> end_type == <span class="string">'WEB'</span>:</div><div class="line">        user_agent = random.choice(WEB_USER_AGENTS)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        user_agent = random.choice(MOBILE_USER_AGENTS)</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="string">'User-Agent'</span>: user_agent,</div><div class="line">        <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span>,</div><div class="line">        <span class="string">'Accept-Language'</span>: <span class="string">'en-US,en;q=0.5'</span>,</div><div class="line">        <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>,</div><div class="line">        <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">func_timer</span><span class="params">(function)</span>:</span></div><div class="line"><span class="meta">    @wraps(function)</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">function_timer</span><span class="params">(*args, **kwargs)</span>:</span></div><div class="line">        print(<span class="string">'[Function: &#123;name&#125; start...]'</span>.format(name = function.__name__))</div><div class="line">        t0 = time.time()</div><div class="line">        result = function(*args, **kwargs)</div><div class="line">        t1 = time.time()</div><div class="line">        print(<span class="string">'[Function: &#123;name&#125; finished, spent time: &#123;time:.2f&#125;s]'</span>.format(name = function.__name__,time = t1 - t0))</div><div class="line">        <span class="keyword">return</span> result</div><div class="line">    <span class="keyword">return</span> function_timer</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">connect_mongo</span><span class="params">(MONGODB)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    :param MONGODB: dict type</span></div><div class="line"><span class="string">    :return: db object</span></div><div class="line"><span class="string">    """</span></div><div class="line">    client = MongoClient(</div><div class="line">        <span class="string">'mongodb://&#123;&#125;:&#123;&#125;@&#123;&#125;/&#123;&#125;'</span>.format(MONGODB[<span class="string">'user'</span>],</div><div class="line">                                       MONGODB[<span class="string">'passwd'</span>],</div><div class="line">                                       MONGODB[<span class="string">'host'</span>],</div><div class="line">                                       MONGODB[<span class="string">'dbname'</span>]))</div><div class="line">    <span class="keyword">return</span> client[MONGODB[<span class="string">'dbname'</span>]]</div></pre></td></tr></table></figure></p>
<h3 id="日志模块"><a href="#日志模块" class="headerlink" title="日志模块"></a>日志模块</h3><p>logger.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> logging</div><div class="line"><span class="keyword">import</span> logging.handlers</div><div class="line"></div><div class="line">LOG_FORMAT = <span class="string">"%(asctime)s [%(levelname)s] [%(filename)s] [line:%(lineno)d]: %(message)s"</span></div><div class="line">DATA_LOG_FORMAT = <span class="string">"%m/%d/%Y %H:%M:%S"</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 使用root_logger</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_root_logger_settings</span><span class="params">(logConsole=True)</span>:</span></div><div class="line">    formatter = logging.Formatter(fmt=LOG_FORMAT, datefmt=DATA_LOG_FORMAT)</div><div class="line">    log_dir = os.path.join(os.path.dirname(os.path.abspath(__file__)), <span class="string">"logs"</span>)</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(log_dir):</div><div class="line">        os.mkdir(log_dir)</div><div class="line">    logging.getLogger().setLevel(logging.INFO)</div><div class="line">    log_name = os.path.join(log_dir, __name__.replace(<span class="string">'_'</span>, <span class="string">''</span>) <span class="keyword">if</span> <span class="string">'_'</span> <span class="keyword">in</span> __name__ <span class="keyword">else</span> __name__)</div><div class="line">    <span class="comment"># 文件输出日志</span></div><div class="line">    fh = logging.handlers.TimedRotatingFileHandler(</div><div class="line">        filename=log_name, when=<span class="string">'midnight'</span>, interval=<span class="number">1</span>, encoding=<span class="string">'utf-8'</span>)</div><div class="line">    fh.setLevel(logging.INFO)</div><div class="line">    fh.suffix = <span class="string">"%Y-%m-%d.log"</span></div><div class="line">    fh.setFormatter(formatter)</div><div class="line">    logging.getLogger().addHandler(fh)</div><div class="line">    <span class="comment"># 控制台输出日志</span></div><div class="line">    <span class="keyword">if</span> logConsole:</div><div class="line">        ch = logging.StreamHandler()</div><div class="line">        ch.setLevel(logging.DEBUG)</div><div class="line">        ch.setFormatter(formatter)</div><div class="line">        logging.getLogger().addHandler(ch)</div><div class="line"></div><div class="line">      </div><div class="line"><span class="comment"># 生成指定名称的logger</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logging</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, log_name=None, log_level=<span class="string">"info"</span>, console=True)</span>:</span></div><div class="line">        log_dir = os.path.join(os.path.dirname((os.path.dirname(os.path.abspath(__file__)))), <span class="string">"logs"</span>)</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(log_dir):</div><div class="line">            os.mkdir(log_dir)</div><div class="line">        <span class="keyword">if</span> log_name <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            _log_name = os.path.join(log_dir, __name__.replace(<span class="string">'_'</span>, <span class="string">''</span>) <span class="keyword">if</span> <span class="string">'_'</span> <span class="keyword">in</span> __name__ <span class="keyword">else</span> __name__)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            _log_name = os.path.join(log_dir, log_name)</div><div class="line">        self.logObject = logging.getLogger(_log_name)</div><div class="line">        self._set_level(log_level)</div><div class="line">        <span class="comment"># 文件输出日志</span></div><div class="line">        fh = logging.handlers.TimedRotatingFileHandler(filename=_log_name,</div><div class="line">                                                       when=<span class="string">'midnight'</span>,</div><div class="line">                                                       interval=<span class="number">1</span>,</div><div class="line">                                                       encoding=<span class="string">'utf-8'</span>)</div><div class="line">        fh.suffix = <span class="string">"%Y-%m-%d.log"</span></div><div class="line">        formatter = logging.Formatter(fmt=LOG_FORMAT, datefmt=DATA_LOG_FORMAT)</div><div class="line">        fh.setLevel(logging.INFO)</div><div class="line">        fh.setFormatter(formatter)</div><div class="line">        self.logObject.addHandler(fh)</div><div class="line">        <span class="comment"># 控制台输出日志</span></div><div class="line">        <span class="keyword">if</span> console:</div><div class="line">            ch = logging.StreamHandler()</div><div class="line">            ch.setLevel(logging.DEBUG)</div><div class="line">            ch.setFormatter(formatter)</div><div class="line">            self.logObject.addHandler(ch)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_set_level</span><span class="params">(self, log_level)</span>:</span></div><div class="line">        <span class="keyword">if</span> log_level == <span class="string">"warning"</span>:</div><div class="line">            self.logObject.setLevel(logging.WARNING)</div><div class="line">        <span class="keyword">elif</span> log_level == <span class="string">"debug"</span>:</div><div class="line">            self.logObject.setLevel(logging.DEBUG)</div><div class="line">        <span class="keyword">elif</span> log_level == <span class="string">"error"</span>:</div><div class="line">            self.logObject.setLevel(logging.ERROR)</div><div class="line">        <span class="keyword">elif</span> log_level == <span class="string">"critical"</span>:</div><div class="line">            self.logObject.setLevel(logging.CRITICAL)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            self.logObject.setLevel(logging.INFO)</div></pre></td></tr></table></figure></p>
</div><div class="tags"><a href="/tags/爬虫/">爬虫</a></div><div class="post-nav"><a href="/2018/01/25/linux-crontab-2018-01-25/" class="next">linux之crontab使用</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/思想/">思想</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/方法/" style="font-size: 15px;">方法</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/计算机基础/" style="font-size: 15px;">计算机基础</a> <a href="/tags/谷歌/" style="font-size: 15px;">谷歌</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/OOP/" style="font-size: 15px;">OOP</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/flask/" style="font-size: 15px;">flask</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/NSIS/" style="font-size: 15px;">NSIS</a> <a href="/tags/scrapy/" style="font-size: 15px;">scrapy</a> <a href="/tags/PyQt5/" style="font-size: 15px;">PyQt5</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/RegExp/" style="font-size: 15px;">RegExp</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/SVN/" style="font-size: 15px;">SVN</a> <a href="/tags/tornado/" style="font-size: 15px;">tornado</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/02/01/spiderallsite-2018-02-01/">全站爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/25/linux-crontab-2018-01-25/">linux之crontab使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/16/py-scrapy2-2018-01-16/">scrapy笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/15/py-scrapy1-2018-01-15/">scrapy笔记-安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/15/py-pipcmds-2018-01-15/">python之pip常用命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/11/css-note1-2018-01-11/">css笔记1</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/11/selenium-phatomjs-2017-12-11/">selenium-phatomjs使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/08/jQuery-notes1-2017-12-08/">jQuery笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/08/js-dom-2017-12-08/">javascript之DOM操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/08/appium-notes1-2017-12-08/">Appium笔记</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Simple &amp; Freedom.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>