---
title: 正则表达式使用
date: 2017-03-30 13:58:36
tags: [Regular]
categories: 编程  
---
### 1. 常用元字符
|元字符|说明|
|:-------|:--------------------------|
|.      |匹配除换行符以外的任意字符|
|\w     |匹配字母或数字或下划线或汉字|
|\s     |匹配任意的空白符|
|\d     |匹配数字|
|\b	    |匹配单词的开始或结束|
|^      |匹配字符串的开始|
|$      |匹配字符串的结束|
<!--More-->
- \b 代表着单词的开头或结尾,即单词的分界处.通常英文的单词是由空格,标点符号或者换行来分隔的,
  但是\b并不匹配这些单词分隔字符中的任何一个,它只匹配一个**位置**. 
- \. 点号也是一个元字符,匹配除换行符意外的任意任意字符.
- \* 星号元字符,代表的不是字符,也不是位置,而是数量.它指定*前面的内容可以连续重复使用任意次数来使整个表达式得到匹配.
- .\* 则表示匹配任意数量的不包含换行的字符
- \d 元字符,匹配一位数字
- \s 匹配任意的空白符,包括空格,制表符(Tab),换行符,中文全角空格等.
- \w 匹配字母,数字,下划线或汉字等.
- \d+ 匹配1个或者更多连续的数字
- \+ 与 * 的区别:
- \* 匹配重复任意次,也可能是0次
- \+ 匹配重复1次或更多次

### 2. 字符转义
查找匹配.或*或\等字符就得使用\来取消这些字符的特殊意义,因为它们会被解释成别的意思。
因此，应该使用\.和\*和\\. 例如：C:\\Windows匹配C:\Windows。

### 3. 重复匹配次数的限定符
|代码/语法|说明|
|:---------|:---------|
|*	|重复零次或更多次|
|+	|重复一次或更多次|
|?	|重复零次或一次|
|{n}|重复n次|
|{n,}|重复n次或更多次|
|{n,m}|重复n到m次|

### 4. 指定匹配范围
匹配在指定字符范围或集合中的一个字符,用[指定你的字符范围或集合]
如[aeiou] 匹配任何一个英文元音字母
[.?!] 匹配标点符号(.或?或!)
[0-9]代表的含意与\d就是完全一致的：匹配一位数字

### 5. 多条件匹配
多条件匹配,如果满足其中任意一个匹配条件则匹配,多个匹配条件使用|将多个匹配条件隔开.
**注意:** 使用多条件匹配要注意各个条件的顺序,多条件匹配是从左到右地测试每个条件，如果满足了某个条件，就不会去再管其它的条件了。
例如:
\d{5}-\d{4}|\d{5}这个表达式用于匹配美国的邮政编码。美国邮编的规则是5位数字，或者用连字号间隔的9位数字。
如果你把它改成\d{5}|\d{5}-\d{4}的话，那么就只会匹配5位的邮编(以及9位邮编的前5位)。

### 6. 分组
重复单个字符: 直接在字符后面加上限定符
重复多个字符: 使用括号指定子表达式,再对这个子表达式加次数限定符
组号分配原则：
分组0对应整个正则表达式
实际上组号分配过程是要从左向右扫描两遍的：第一遍只给未命名组分配，第二遍只给命名组分配－－因此所有命名组的组号都大于未命名的组号
你可以使用(?:exp)这样的语法来剥夺一个分组对组号分配的参与权
例如:匹配IP
((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)
常用分组语法:

|分类|语法|说明|
|:------|:-----------|:-----------------------------|
|捕获|	  (exp)	        |匹配exp,并捕获文本到自动命名的组里|
|捕获|      (?<name>exp)	|匹配exp,并捕获文本到名称为name的组里，也可以写成(?'name'exp)|
|捕获|      (?:exp)	    |匹配exp,不捕获匹配的文本，也不给此分组分配组号|
|零宽断言|	(?=exp)	      |匹配exp前面的位置|
|零宽断言|  (?<=exp)	  |匹配 exp后面的位置|
|零宽断言|  (?!exp)	      |匹配后面跟的不是exp的位置|
|零宽断言|  (?<!exp)	  |匹配前面不是exp的位置|
|注释	   |  (?#comment)  |这种类型的分组不对正则表达式的处理产生任何影响，用于提供注释让人阅读|

第三个(?:exp)不会改变正则表达式的处理方式，只是这样的组匹配的内容不会像前两种那样被捕获到某个组里面，也不会拥有组号。

### 7. 反义
有时需要查找不属于某个能简单定义的字符类的字符。比如想查找除了数字以外，其它任意字符都行的情况.
常用到的反义：

|语法	|说明|
|:----------|:-----|
|\W	|匹配任意不是字母，数字，下划线，汉字的字符|
|\S	|匹配任意不是空白符的字符|
|\D	|匹配任意非数字的字符|
|\B	|匹配不是单词开头或结束的位置|

例如:
[^x]	匹配除了x以外的任意字符
[^aeiou]	匹配除了aeiou这几个字母以外的任意字符

### 8. 后向引用
使用小括号指定一个子表达式后，匹配这个子表达式的文本(也就是此分组捕获的内容)可以在表达式或其它程序中作进一步的处理。默认情况下，每个分组会自动拥有一个组号，规则是：从左向右，以分组的左括号为标志，第一个出现的分组的组号为1，第二个为2，以此类推。后向引用用于重复搜索前面某个分组匹配的文本。

你也可以自己指定子表达式的组名。指定一个子表达式的组名语法：
(?<Word>\w+)(或者把尖括号换成'也行：(?'Word'\w+)),这样就把\w+的组名指定为Word了。要反向引用这个分组捕获的内容，你可以使用\k<Word>,所以上一个例子也可以写成这样：\b(?<Word>\w+)\b\s+\k<Word>\b。

### 9. 注释
小括号的另一种用途是通过语法(?#comment)来包含注释

要包含注释的话，最好是启用“忽略模式里的空白符”选项，这样在编写表达式时能任意的添加空格，Tab，换行，而实际使用时这些都将被忽略。启用这个选项后，在#后面到这一行结束的所有文本都将被当成注释忽略掉。
例如，我们可以前面的一个表达式写成这样：
(?<=    # 断言要匹配的文本的前缀
<(\w+)> # 查找尖括号括起来的字母或数字(即HTML/XML标签)
)       # 前缀结束
.*      # 匹配任意文本
(?=     # 断言要匹配的文本的后缀
<\/\1>  # 查找尖括号括起来的内容：前面是一个"/"，后面是先前捕获的标签
)       # 后缀结束

### 10. 贪婪与懒惰
正则表达式通常的行为是贪婪匹配
贪婪匹配:一次匹配尽可能多的字符
懒惰匹配:一次匹配尽可能少的字符
贪婪匹配转懒惰匹配:只要在后面加上?
懒惰限定符:

|语法     |说明     |
|:--------|:------|
|*?	|重复任意次，但尽可能少重复|
|+?	|重复1次或更多次，但尽可能少重复|
|??	|重复0次或1次，但尽可能少重复|
|{n,m}?	|重复n到m次，但尽可能少重复|
|{n,}?	|重复n次以上，但尽可能少重复|

### 11. 处理选项
|名称	|说明|
|:-----|:-------|
|IgnoreCase(忽略大小写)	|匹配时不区分大小写。|
|Multiline(多行模式) |更改^和$的含义,使它们分别在任意一行的行首和行尾匹配,而不仅仅在整个字符串的开头和结尾匹配。(在此模式下,$的精确含意是:匹配\n之前的位置以及字符串结束前的位置.)|
|Singleline(单行模式)	|更改.的含义，使它与每一个字符匹配（包括换行符\n）。|
|IgnorePatternWhitespace(忽略空白)	|忽略表达式中的非转义空白并启用由#标记的注释。|
|ExplicitCapture(显式捕获)	|仅捕获已被显式命名的组。|

### 12. 递归匹配/平衡组
|语法          |说明     |
|:------------|:----------------|
|(?'group')             |把捕获的内容命名为group,并压入堆栈(Stack)|
|(?'-group')            |从堆栈上弹出最后压入堆栈的名为group的捕获内容，如果堆栈本来为空，则本分组的匹配失败|
|(?(group)yes&#124;no)  |如果堆栈上存在以名为group的捕获内容的话，继续匹配yes部分的表达式，否则继续匹配no部分|
|(?!)                   |零宽负向先行断言，由于没有后缀表达式，试图匹配总是失败|

我们需要做的是每碰到了左括号，就在压入一个"Open",每碰到一个右括号，就弹出一个，到了最后就看看堆栈是否为空－－如果不为空那就证明左括号比右括号多，那匹配就应该失败。正则表达式引擎会进行回溯(放弃最前面或最后面的一些字符)，尽量使整个表达式得到匹配。
```
<                         #最外层的左括号
    [^<>]*                #最外层的左括号后面的不是括号的内容
    (
        (
            (?'Open'<)    #碰到了左括号，在黑板上写一个"Open"
            [^<>]*       #匹配左括号后面的不是括号的内容
        )+
        (
            (?'-Open'>)   #碰到了右括号，擦掉一个"Open"
            [^<>]*        #匹配右括号后面不是括号的内容
        )+
    )*
    (?(Open)(?!))         #在遇到最外层的右括号前面，判断黑板上还有没有没擦掉的"Open"；如果还有，则匹配失败

>                         #最外层的右括号
```

平衡组的一个最常见的应用就是匹配HTML,下面这个例子可以匹配嵌套的<div>标签：
<div[^>]*>[^<>]*(((?'Open'<div[^>]*>)[^<>]*)+((?'-Open'</div>)[^<>]*)+)*(?(Open)(?!))</div>.


### 13. 未详细讨论的语法
|代码/语法	|说明|
|:----------|:---------|
|\a	|报警字符(打印它的效果是电脑嘀一声)|
|\b	|通常是单词分界位置，但如果在字符类里使用代表退格|
|\t	|制表符，Tab|
|\r	|回车|
|\v	|竖向制表符|
|\f	|换页符|
|\n	|换行符|
|\e	|Escape|
|\0nn	|ASCII代码中八进制代码为nn的字符|
|\xnn	|ASCII代码中十六进制代码为nn的字符|
|\unnnn	|Unicode代码中十六进制代码为nnnn的字符|
|\cN	|ASCII控制字符。比如\cC代表Ctrl+C|
|\A	|字符串开头(类似^，但不受处理多行选项的影响)|
|\Z	|字符串结尾或行尾(不受处理多行选项的影响)|
|\z	|字符串结尾(类似$，但不受处理多行选项的影响)|
|\G	|当前搜索的开头|
|\p{name}	|Unicode中命名为name的字符类，例如\p{IsGreek}|
|(?>exp)	|贪婪子表达式|
|(?\<x>-<y>exp)	|平衡组|
|(?im-nsx:exp)	|在子表达式exp中改变处理选项|
|(?im-nsx)	|为表达式后面的部分改变处理选项|
|(?(exp)yes\|no)	|把exp当作零宽正向先行断言，如果在这个位置能匹配，使用yes作为此组的表达式；否则使用no|
|(?(exp)yes)	|同上，只是使用空表达式作为no|
|(?(name)yes\|no)	|如果命名为name的组捕获到了内容，使用yes作为表达式；否则使用no|
|(?(name)yes)	|同上，只是使用空表达式作为no|

### 14. 常用正则表达式
**说明：**正则表达式通常用于两种任务：1.验证，2.搜索/替换。
用于验证时，通常需要在前后分别加上^和$，以匹配整个待验证字符串；
搜索/替换时是否加上此限定则根据搜索的要求而定，
此外，也有可能要在前后加上\b而不是^和$。
此表所列的常用正则表达式，除个别外均未在前后加上任何限定，请根据需要，自行处理。

|说明	|正则表达式|
|:----|:--------|
|网址（URL）|	[a-zA-z]+://[^\s]*|
|IP地址(IP Address)|	((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)|
|电子邮件(Email)	|\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*|
|QQ号码	|[1-9]\d{4,}|
|HTML标记(包含内容或自闭合)	|<(.*)(.*)>.*<\/\1>|<(.*) \/>|
|密码(由数字/大写字母/小写字母/标点符号组成，四种都必有，8位以上)	|(?=^.{8,}$)(?=.*\d)(?=.*\W+)(?=.*[A-Z])(?=.*[a-z])(?!.*\n).*$|
|日期(年-月-日)	|(\d{4}|\d{2})-((1[0-2])|(0?[1-9]))-(([12][0-9])|(3[01])|(0?[1-9]))|
|日期(月/日/年)	|((1[0-2])|(0?[1-9]))/(([12][0-9])|(3[01])|(0?[1-9]))/(\d{4}|\d{2})|
|时间(小时:分钟, 24小时制)	|((1|0?)[0-9]|2[0-3]):([0-5][0-9])|
|汉字(字符)	|[\u4e00-\u9fa5]|
|中文及全角标点符号(字符)	|[\u3000-\u301e\ufe10-\ufe19\ufe30-\ufe44\ufe50-\ufe6b\uff01-\uffee]|
|中国大陆固定电话号码	|(\d{4}-|\d{3}-)?(\d{8}|\d{7})|
|中国大陆手机号码	|1\d{10}|
|中国大陆邮政编码	|[1-9]\d{5}|
|中国大陆身份证号(15位或18位)	|\d{15}(\d\d[0-9xX])?|
|非负整数(正整数或零)	|\d+|
|正整数	|[0-9]*[1-9][0-9]*|
|负整数	|-[0-9]*[1-9][0-9]*|
|整数|	-?\d+|
|小数	|(-?\d+)(\.\d+)?|
|不包含abc的单词	|\b((?!abc)\w)+\b|

**说明:**该文章参考[正则表达式教程](http://deerchao.net/tutorials/regex/regex.htm)
